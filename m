Return-Path: <driverdev-devel-bounces@linuxdriverproject.org>
X-Original-To: lists+driverdev-devel@lfdr.de
Delivered-To: lists+driverdev-devel@lfdr.de
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
	by mail.lfdr.de (Postfix) with ESMTPS id 21AB632F8C
	for <lists+driverdev-devel@lfdr.de>; Mon,  3 Jun 2019 14:27:34 +0200 (CEST)
Received: from localhost (localhost [127.0.0.1])
	by fraxinus.osuosl.org (Postfix) with ESMTP id A1BE585CF2;
	Mon,  3 Jun 2019 12:27:32 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id WC9kxIbkX8a2; Mon,  3 Jun 2019 12:27:19 +0000 (UTC)
Received: from ash.osuosl.org (ash.osuosl.org [140.211.166.34])
	by fraxinus.osuosl.org (Postfix) with ESMTP id 2CCD485C67;
	Mon,  3 Jun 2019 12:27:11 +0000 (UTC)
X-Original-To: devel@linuxdriverproject.org
Delivered-To: driverdev-devel@osuosl.org
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
 by ash.osuosl.org (Postfix) with ESMTP id B787E1BF4E6
 for <devel@linuxdriverproject.org>; Mon,  3 Jun 2019 12:27:08 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by hemlock.osuosl.org (Postfix) with ESMTP id A2C27878F7
 for <devel@linuxdriverproject.org>; Mon,  3 Jun 2019 12:27:08 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id MIgy6Kx5KhPq for <devel@linuxdriverproject.org>;
 Mon,  3 Jun 2019 12:27:03 +0000 (UTC)
X-Greylist: delayed 00:05:22 by SQLgrey-1.7.6
Received: from mout.web.de (mout.web.de [212.227.17.12])
 by hemlock.osuosl.org (Postfix) with ESMTPS id 9EDFB878F1
 for <devel@driverdev.osuosl.org>; Mon,  3 Jun 2019 12:27:02 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=web.de;
 s=dbaedf251592; t=1559564820;
 bh=FJt45LzprmG8E5/01UN42K4QP8qUJ0s1fotVkKdERQo=;
 h=X-UI-Sender-Class:From:To:Cc:Subject:Date:In-Reply-To:References;
 b=c4phhgp3VYtZJRD8BV/Z4pSzdvtetUiiJVcUxyACtvfK0TM2ZhF6q3HYdJJOt1L/b
 brOzxPtQzA/YNyHYG2AFX1DmVMaR61l2FMqyXD+GC1HHty7mDnqVBNjGu5XZ+Wnpx3
 xMdx62NeuWGNUDFBMPpv1oZu6i8SJVeagclk0m8U=
X-UI-Sender-Class: c548c8c5-30a9-4db5-a2e7-cb6cb037b8f9
Received: from lab-pc08.sra.uni-hannover.de ([130.75.33.87]) by smtp.web.de
 (mrweb102 [213.165.67.124]) with ESMTPSA (Nemesis) id
 0M2dg1-1gfoOo0ffp-00sKYn; Mon, 03 Jun 2019 14:21:27 +0200
From: =?UTF-8?q?Christian=20M=C3=BCller?= <muellerch-privat@web.de>
To: gregkh@linuxfoundation.org
Subject: [PATCH 3/3] drivers/staging/rtl8192u: Fix of checkpatch-errors
Date: Mon,  3 Jun 2019 14:21:04 +0200
Message-Id: <20190603122104.2564-4-muellerch-privat@web.de>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190603122104.2564-1-muellerch-privat@web.de>
References: <20190603122104.2564-1-muellerch-privat@web.de>
MIME-Version: 1.0
X-Provags-ID: V03:K1:By9Fm88wNJf5cKmbZDWdjaWO3PAffXUDLYF83owXb/RaRY8DKvk
 9ceZFdsu+oaM+bYk83OzDWR7UEmNK5nZYsz+zlDGC7E2iCeSVOxsXtP3HDmlPMOq7JNbCPL
 y1W+uZerDkTet2FSpChF/ynu+J+NcO30GFnPBU/fu7EK6QF6azvWg8E7CNrF93IiZZTcfZX
 u5pVOWRVoRjFPiGIOlkCg==
X-UI-Out-Filterresults: notjunk:1;V03:K0:L/91obQT09k=:juek+hRzy+fAFKF109sh5D
 ytQsa1bXDGhBypKLdUGvksS8SavDkfExcRh6f1HkJUjrbu+kp4CBoDP1GZvyJLSoJlt4zVimo
 qdMInWJrirmOuQI8bumU4w02uI919Rn+XK4mefkVx1wqO66y2t477ejdHnHtUxHjPauJCRk9+
 6vAnByRPCHubawz7GLHH3cH0aO5V5LdMm/9/GJwDMPQ8YXm3PRms6egR5M6FO0VC8LLk9vKBq
 5mQReYDpejVn2dwftpYawobVgen/OzB6l1vZLSfMEzr9+WfSpir6I6i1uaf0DRQAjWm5s6ewB
 UaTg3yzJUNs/UraTTgXdXcuIunyrc/B2BDkQpK3+76Q5sXg0rTflfMHMG9mkPpTslsWa/ws9p
 Hue/PZKA+YFawerGyACwdSSSt5rRyXVa+gllG+LxHVWe743wmPwnXo9BYLAa8G5v4ChbzizLp
 hoQdyZAko6NE0sdLFBXq7kOJAer8vorOB5SqiTT83nCmn/l4xNYaRdup7YW+HIyWUsXSydTRI
 zQqZbBfv1yuCRI1DBBHETMHdmDA9rgjINB6aEZr+dO71OqcwibYKf0SyD/hoPQHbiHZFAWP52
 jr7e32NJafSu42UAZmoiGqJuCchHzYGc1i2hE3/clq8i+2gk6B+RgnIBFNC7ulyyeFlvfaZk8
 UVHHi7T6bKTFGvLR+rLkLqurOZyEY0///5F5VQJg2jxkT9WScExJHqa5RLBLMn4I/rbVa031F
 EP1LbHNcvcGnhBr7GjEZABUkOaAdcQy87wqAsVF0or77iuQ9QxSFnPxIOo83RKYnQi4u2YBuf
 6Q/P7eNzcEuwi7OkreVsxQjADnnkQW2dWAkJzGTOOoroQ0gZ6RL91ASFzIDphGxU3Atf/VpFH
 TrbrqgXV1Mat8Cd3VfK6tTsW/wHCD/HdE4yCRe6LMPZLLPdt/fnHCJW7SY3GLBUJrkp6ZIYiT
 v9Ehtb1B2Z9AHNt3YYQwuMdpPj7J6H4TKxWCvaWkMdp1ChSXVcwzt
X-BeenThere: driverdev-devel@linuxdriverproject.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Linux Driver Project Developer List
 <driverdev-devel.linuxdriverproject.org>
List-Unsubscribe: <http://driverdev.linuxdriverproject.org/mailman/options/driverdev-devel>, 
 <mailto:driverdev-devel-request@linuxdriverproject.org?subject=unsubscribe>
List-Archive: <http://driverdev.linuxdriverproject.org/pipermail/driverdev-devel/>
List-Post: <mailto:driverdev-devel@linuxdriverproject.org>
List-Help: <mailto:driverdev-devel-request@linuxdriverproject.org?subject=help>
List-Subscribe: <http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel>, 
 <mailto:driverdev-devel-request@linuxdriverproject.org?subject=subscribe>
Cc: devel@driverdev.osuosl.org, felix.trommer@hotmail.de,
 linux-kernel@i4.cs.fau.de, linux-kernel@vger.kernel.org,
 johnfwhitmore@gmail.com,
 =?UTF-8?q?Christian=20M=C3=BCller?= <muellerch-privat@web.de>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: driverdev-devel-bounces@linuxdriverproject.org
Sender: "devel" <driverdev-devel-bounces@linuxdriverproject.org>

Rml4IGlzc3VlcyB0aGF0IGxlYWQgdG8gbXVsdGlwbGUgY2hlY2twYXRjaCB3YXJuaW5ncyBhbmQg
ZXJyb3JzLCBtb3N0IG9mCnRoZW0gcmVnYXJkaW5nIGZvcm1hdHRpbmcgb2YgY29kZSBhbmQgY29t
bWVudHMuCkNvbW1lbnRzIHRoYXQgY29udGFpbiBvbmx5IGNvbW1lbnRlZCBvdXQgY29kZSBhcmUg
cmVtb3ZlZCBhcyB3ZWxsLgoKU2lnbmVkLW9mZi1ieTogRmVsaXggVHJvbW1lciA8ZmVsaXgudHJv
bW1lckBob3RtYWlsLmRlPgpTaWduZWQtb2ZmLWJ5OiBDaHJpc3RpYW4gTcO8bGxlciA8bXVlbGxl
cmNoLXByaXZhdEB3ZWIuZGU+Ci0tLQogLi4uL3N0YWdpbmcvcnRsODE5MnUvaWVlZTgwMjExL2ll
ZWU4MDIxMS5oICAgIHwgIDE4ICstCiAuLi4vcnRsODE5MnUvaWVlZTgwMjExL2llZWU4MDIxMV9t
b2R1bGUuYyAgICAgfCAgIDEgKwogLi4uL3N0YWdpbmcvcnRsODE5MnUvaWVlZTgwMjExL2llZWU4
MDIxMV9yeC5jIHwgNjUxICsrKysrKysrLS0tLS0tLS0tLQogLi4uL3J0bDgxOTJ1L2llZWU4MDIx
MS9pZWVlODAyMTFfc29mdG1hYy5jICAgIHwgIDQ4ICstCiAuLi4vc3RhZ2luZy9ydGw4MTkydS9p
ZWVlODAyMTEvaWVlZTgwMjExX3R4LmMgfCAyMDYgKysrLS0tCiAuLi4vc3RhZ2luZy9ydGw4MTky
dS9pZWVlODAyMTEvaWVlZTgwMjExX3d4LmMgfCAgNTkgKy0KIC4uLi9ydGw4MTkydS9pZWVlODAy
MTEvcnRsODE5eF9CQVByb2MuYyAgICAgICB8ICAxOCArLQogLi4uL3N0YWdpbmcvcnRsODE5MnUv
aWVlZTgwMjExL3J0bDgxOXhfSFQuaCAgIHwgIDE1ICstCiAuLi4vcnRsODE5MnUvaWVlZTgwMjEx
L3J0bDgxOXhfSFRQcm9jLmMgICAgICAgfCAgMTYgKy0KIC4uLi9ydGw4MTkydS9pZWVlODAyMTEv
cnRsODE5eF9UU1Byb2MuYyAgICAgICB8ICAxNCArLQogZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1
L3I4MTkyVV9kbS5jICAgICAgICAgIHwgIDUzICstCiBkcml2ZXJzL3N0YWdpbmcvcnRsODE5MnUv
cjgxOTJVX2h3LmggICAgICAgICAgfCAgMTYgKy0KIGRyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9y
ODE5MlVfd3guYyAgICAgICAgICB8ICAgMyArLQogZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L3I4
MTl4VV9maXJtd2FyZS5jICAgIHwgICAyICstCiAxNCBmaWxlcyBjaGFuZ2VkLCA0ODAgaW5zZXJ0
aW9ucygrKSwgNjQwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvc3RhZ2luZy9y
dGw4MTkydS9pZWVlODAyMTEvaWVlZTgwMjExLmggYi9kcml2ZXJzL3N0YWdpbmcvcnRsODE5MnUv
aWVlZTgwMjExL2llZWU4MDIxMS5oCmluZGV4IGQxMTBlOTMzMzc5OS4uYmFiOTc1Zjk2YTA5IDEw
MDY0NAotLS0gYS9kcml2ZXJzL3N0YWdpbmcvcnRsODE5MnUvaWVlZTgwMjExL2llZWU4MDIxMS5o
CisrKyBiL2RyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9pZWVlODAyMTEvaWVlZTgwMjExLmgKQEAg
LTQ0NiwyNiArNDQ2LDI2IEBAIHR5cGVkZWYgZW51bSBfSW5pdGlhbEdhaW5PcFR5cGUgewogZXh0
ZXJuIHUzMiBpZWVlODAyMTFfZGVidWdfbGV2ZWw7CiAjZGVmaW5lIElFRUU4MDIxMV9ERUJVRyhs
ZXZlbCwgZm10LCBhcmdzLi4uKSBcCiBkbyB7IGlmIChpZWVlODAyMTFfZGVidWdfbGV2ZWwgJiAo
bGV2ZWwpKSBcCi0gIHByaW50ayhLRVJOX0RFQlVHICJpZWVlODAyMTE6ICIgZm10LCAjIyBhcmdz
KTsgfSB3aGlsZSAoMCkKKwlwcmludGsoS0VSTl9ERUJVRyAiaWVlZTgwMjExOiAiIGZtdCwgIyMg
YXJncyk7IH0gd2hpbGUgKDApCiAvKiB3YiBhZGRlZCB0byBkZWJ1ZyBvdXQgZGF0YSBidWYgKi8K
IC8qIGlmIHlvdSB3YW50IHByaW50IERBVEEgYnVmZmVyIHJlbGF0ZWQgQkEsIHBsZWFzZSBzZXQg
aWVlZTgwMjExX2RlYnVnX2xldmVsIHRvIERBVEF8QkEgKi8KICNkZWZpbmUgSUVFRTgwMjExX0RF
QlVHX0RBVEEobGV2ZWwsIGRhdGEsIGRhdGFsZW4pCVwKLQlkbyB7IGlmICgoaWVlZTgwMjExX2Rl
YnVnX2xldmVsICYgKGxldmVsKSkgPT0gKGxldmVsKSkJXAotCQl7CVwKKwlkbyB7IFwKKwkJaWYg
KChpZWVlODAyMTFfZGVidWdfbGV2ZWwgJiAobGV2ZWwpKSA9PSAobGV2ZWwpKSB7CVwKIAkJCWlu
dCBpOwkJCQkJXAogCQkJdTggKnBkYXRhID0gKHU4ICopIGRhdGE7CQkJXAogCQkJcHJpbnRrKEtF
Uk5fREVCVUcgImllZWU4MDIxMTogJXMoKVxuIiwgX19mdW5jX18pOwlcCi0JCQlmb3IgKGkgPSAw
OyBpIDwgKGludCkoZGF0YWxlbik7IGkrKykJCQlcCi0JCQl7CQkJCQkJXAorCQkJZm9yIChpID0g
MDsgaSA8IChpbnQpKGRhdGFsZW4pOyBpKyspIHsJCVwKIAkJCQlwcmludGsoIiUyeCAiLCBwZGF0
YVtpXSk7CQlcCi0JCQkJaWYgKChpICsgMSkgJSAxNiA9PSAwKSBwcmludGsoIlxuIik7CVwKKwkJ
CQlpZiAoKGkgKyAxKSAlIDE2ID09IDApCVwKKwkJCQkJcHJpbnRrKCJcbiIpOwlcCiAJCQl9CQkJ
CVwKIAkJCXByaW50aygiXG4iKTsJCQlcCiAJCX0JCQkJCVwKIAl9IHdoaWxlICgwKQogI2Vsc2UK
LSNkZWZpbmUgSUVFRTgwMjExX0RFQlVHIChsZXZlbCwgZm10LCBhcmdzLi4uKSBkbyB7fSB3aGls
ZSAoMCkKLSNkZWZpbmUgSUVFRTgwMjExX0RFQlVHX0RBVEEgKGxldmVsLCBkYXRhLCBkYXRhbGVu
KSBkbyB7fSB3aGlsZSgwKQorI2RlZmluZSBJRUVFODAyMTFfREVCVUcgKChsZXZlbCwgZm10LCBh
cmdzLi4uKSBkbyB7fSB3aGlsZSAoMCkpCisjZGVmaW5lIElFRUU4MDIxMV9ERUJVR19EQVRBICgo
bGV2ZWwsIGRhdGEsIGRhdGFsZW4pIGRvIHt9IHdoaWxlICgwKSkKICNlbmRpZgkvKiBDT05GSUdf
SUVFRTgwMjExX0RFQlVHICovCgogLyogZGVidWcgbWFjcm9zIG5vdCBkZXBlbmRlbnQgb24gQ09O
RklHX0lFRUU4MDIxMV9ERUJVRyAqLwpAQCAtMTg3Niw3ICsxODc2LDcgQEAgc3RydWN0IGllZWU4
MDIxMV9kZXZpY2UgewogCXN0cnVjdCB3b3JrX3N0cnVjdCBhc3NvY2lhdGVfcHJvY2VkdXJlX3dx
OwogCXN0cnVjdCBkZWxheWVkX3dvcmsgc29mdG1hY19zY2FuX3dxOwogCXN0cnVjdCBkZWxheWVk
X3dvcmsgYXNzb2NpYXRlX3JldHJ5X3dxOwotCSBzdHJ1Y3QgZGVsYXllZF93b3JrIHN0YXJ0X2li
c3Nfd3E7CisJc3RydWN0IGRlbGF5ZWRfd29yayBzdGFydF9pYnNzX3dxOwogCXN0cnVjdCB3b3Jr
X3N0cnVjdCB3eF9zeW5jX3NjYW5fd3E7CiAJc3RydWN0IHdvcmtxdWV1ZV9zdHJ1Y3QgKndxOwog
CS8qIFFvcyByZWxhdGVkLiBBZGRlZCBieSBBbm5pZSwgMjAwNS0xMS0wMS4gKi8KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9pZWVlODAyMTEvaWVlZTgwMjExX21vZHVsZS5j
IGIvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L2llZWU4MDIxMS9pZWVlODAyMTFfbW9kdWxlLmMK
aW5kZXggOTU0ZTQzYWY0OTRiLi43Y2FkNTI3OGI4NjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvc3Rh
Z2luZy9ydGw4MTkydS9pZWVlODAyMTEvaWVlZTgwMjExX21vZHVsZS5jCisrKyBiL2RyaXZlcnMv
c3RhZ2luZy9ydGw4MTkydS9pZWVlODAyMTEvaWVlZTgwMjExX21vZHVsZS5jCkBAIC0xOTQsNiAr
MTk0LDcgQEAgdm9pZCBmcmVlX2llZWU4MDIxMShzdHJ1Y3QgbmV0X2RldmljZSAqZGV2KQogewog
CXN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlID0gbmV0ZGV2X3ByaXYoZGV2KTsKIAlpbnQg
aTsKKwogCWtmcmVlKGllZWUtPnBIVEluZm8pOwogCWllZWUtPnBIVEluZm8gPSBOVUxMOwogCVJl
bW92ZUFsbFRTKGllZWUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L2ll
ZWU4MDIxMS9pZWVlODAyMTFfcnguYyBiL2RyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9pZWVlODAy
MTEvaWVlZTgwMjExX3J4LmMKaW5kZXggYWY4NTQ2YWQxMmFmLi5iZTk3YWQ5M2VjYWMgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9pZWVlODAyMTEvaWVlZTgwMjExX3J4LmMK
KysrIGIvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L2llZWU4MDIxMS9pZWVlODAyMTFfcnguYwpA
QCAtMTAyLDE4ICsxMDIsMTggQEAgaWVlZTgwMjExX2ZyYWdfY2FjaGVfZ2V0KHN0cnVjdCBpZWVl
ODAyMTFfZGV2aWNlICppZWVlLAogCXN0cnVjdCBydGxfODAyMTFfaGRyXzRhZGRycW9zICpoZHJf
NGFkZHJxb3M7CiAJdTggdGlkOwoKLQlpZiAoKChmYyAmIElFRUU4MDIxMV9GQ1RMX0RTVE9EUykg
PT0gSUVFRTgwMjExX0ZDVExfRFNUT0RTKSYmSUVFRTgwMjExX1FPU19IQVNfU0VRKGZjKSkgewot
CSAgaGRyXzRhZGRycW9zID0gKHN0cnVjdCBydGxfODAyMTFfaGRyXzRhZGRycW9zICopaGRyOwot
CSAgdGlkID0gbGUxNl90b19jcHUoaGRyXzRhZGRycW9zLT5xb3NfY3RsKSAmIElFRUU4MDIxMV9R
Q1RMX1RJRDsKLQkgIHRpZCA9IFVQMkFDKHRpZCk7Ci0JICB0aWQrKzsKKwlpZiAoKChmYyAmIElF
RUU4MDIxMV9GQ1RMX0RTVE9EUykgPT0gSUVFRTgwMjExX0ZDVExfRFNUT0RTKSAmJiBJRUVFODAy
MTFfUU9TX0hBU19TRVEoZmMpKSB7CisJCWhkcl80YWRkcnFvcyA9IChzdHJ1Y3QgcnRsXzgwMjEx
X2hkcl80YWRkcnFvcyAqKWhkcjsKKwkJdGlkID0gbGUxNl90b19jcHUoaGRyXzRhZGRycW9zLT5x
b3NfY3RsKSAmIElFRUU4MDIxMV9RQ1RMX1RJRDsKKwkJdGlkID0gVVAyQUModGlkKTsKKwkJdGlk
Kys7CiAJfSBlbHNlIGlmIChJRUVFODAyMTFfUU9TX0hBU19TRVEoZmMpKSB7Ci0JICBoZHJfM2Fk
ZHJxb3MgPSAoc3RydWN0IHJ0bF84MDIxMV9oZHJfM2FkZHJxb3MgKiloZHI7Ci0JICB0aWQgPSBs
ZTE2X3RvX2NwdShoZHJfM2FkZHJxb3MtPnFvc19jdGwpICYgSUVFRTgwMjExX1FDVExfVElEOwot
CSAgdGlkID0gVVAyQUModGlkKTsKLQkgIHRpZCsrOworCQloZHJfM2FkZHJxb3MgPSAoc3RydWN0
IHJ0bF84MDIxMV9oZHJfM2FkZHJxb3MgKiloZHI7CisJCXRpZCA9IGxlMTZfdG9fY3B1KGhkcl8z
YWRkcnFvcy0+cW9zX2N0bCkgJiBJRUVFODAyMTFfUUNUTF9USUQ7CisJCXRpZCA9IFVQMkFDKHRp
ZCk7CisJCXRpZCsrOwogCX0gZWxzZSB7Ci0JICB0aWQgPSAwOworCQl0aWQgPSAwOwogCX0KCiAJ
aWYgKGZyYWcgPT0gMCkgewpAQCAtMTQ3LDcgKzE0Nyw3IEBAIGllZWU4MDIxMV9mcmFnX2NhY2hl
X2dldChzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSwKIAkJICogcmVjZWl2ZWQgYSBmcmFn
bWVudCBvZiBhIGZyYW1lIGZvciB3aGljaCB0aGUgaGVhZCBmcmFnbWVudAogCQkgKiBzaG91bGQg
aGF2ZSBhbHJlYWR5IGJlZW4gcmVjZWl2ZWQKIAkJICovCi0JCWVudHJ5ID0gaWVlZTgwMjExX2Zy
YWdfY2FjaGVfZmluZChpZWVlLCBzZXEsIGZyYWcsIHRpZCxoZHItPmFkZHIyLAorCQllbnRyeSA9
IGllZWU4MDIxMV9mcmFnX2NhY2hlX2ZpbmQoaWVlZSwgc2VxLCBmcmFnLCB0aWQsIGhkci0+YWRk
cjIsCiAJCQkJCQkgIGhkci0+YWRkcjEpOwogCQlpZiAoZW50cnkpIHsKIAkJCWVudHJ5LT5sYXN0
X2ZyYWcgPSBmcmFnOwpAQCAtMTcxLDE4ICsxNzEsMTggQEAgc3RhdGljIGludCBpZWVlODAyMTFf
ZnJhZ19jYWNoZV9pbnZhbGlkYXRlKHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLAogCXN0
cnVjdCBydGxfODAyMTFfaGRyXzRhZGRycW9zICpoZHJfNGFkZHJxb3M7CiAJdTggdGlkOwoKLQlp
ZigoKGZjICYgSUVFRTgwMjExX0ZDVExfRFNUT0RTKSA9PSBJRUVFODAyMTFfRkNUTF9EU1RPRFMp
JiZJRUVFODAyMTFfUU9TX0hBU19TRVEoZmMpKSB7Ci0JICBoZHJfNGFkZHJxb3MgPSAoc3RydWN0
IHJ0bF84MDIxMV9oZHJfNGFkZHJxb3MgKiloZHI7Ci0JICB0aWQgPSBsZTE2X3RvX2NwdShoZHJf
NGFkZHJxb3MtPnFvc19jdGwpICYgSUVFRTgwMjExX1FDVExfVElEOwotCSAgdGlkID0gVVAyQUMo
dGlkKTsKLQkgIHRpZCsrOworCWlmICgoKGZjICYgSUVFRTgwMjExX0ZDVExfRFNUT0RTKSA9PSBJ
RUVFODAyMTFfRkNUTF9EU1RPRFMpICYmIElFRUU4MDIxMV9RT1NfSEFTX1NFUShmYykpIHsKKwkJ
aGRyXzRhZGRycW9zID0gKHN0cnVjdCBydGxfODAyMTFfaGRyXzRhZGRycW9zICopaGRyOworCQl0
aWQgPSBsZTE2X3RvX2NwdShoZHJfNGFkZHJxb3MtPnFvc19jdGwpICYgSUVFRTgwMjExX1FDVExf
VElEOworCQl0aWQgPSBVUDJBQyh0aWQpOworCQl0aWQrKzsKIAl9IGVsc2UgaWYgKElFRUU4MDIx
MV9RT1NfSEFTX1NFUShmYykpIHsKLQkgIGhkcl8zYWRkcnFvcyA9IChzdHJ1Y3QgcnRsXzgwMjEx
X2hkcl8zYWRkcnFvcyAqKWhkcjsKLQkgIHRpZCA9IGxlMTZfdG9fY3B1KGhkcl8zYWRkcnFvcy0+
cW9zX2N0bCkgJiBJRUVFODAyMTFfUUNUTF9USUQ7Ci0JICB0aWQgPSBVUDJBQyh0aWQpOwotCSAg
dGlkKys7CisJCWhkcl8zYWRkcnFvcyA9IChzdHJ1Y3QgcnRsXzgwMjExX2hkcl8zYWRkcnFvcyAq
KWhkcjsKKwkJdGlkID0gbGUxNl90b19jcHUoaGRyXzNhZGRycW9zLT5xb3NfY3RsKSAmIElFRUU4
MDIxMV9RQ1RMX1RJRDsKKwkJdGlkID0gVVAyQUModGlkKTsKKwkJdGlkKys7CiAJfSBlbHNlIHsK
LQkgIHRpZCA9IDA7CisJCXRpZCA9IDA7CiAJfQoKIAllbnRyeSA9IGllZWU4MDIxMV9mcmFnX2Nh
Y2hlX2ZpbmQoaWVlZSwgc2VxLCAtMSwgdGlkLCBoZHItPmFkZHIyLApAQCAtMjIxLDEwICsyMjEs
MTAgQEAgaWVlZTgwMjExX3J4X2ZyYW1lX21nbXQoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmll
ZWUsIHN0cnVjdCBza19idWZmICpza2IsCiAJc3RydWN0IHJ0bF84MDIxMV9oZHJfM2FkZHIgKmhk
ciA9IChzdHJ1Y3QgcnRsXzgwMjExX2hkcl8zYWRkciAqKXNrYi0+ZGF0YTsKCiAJcnhfc3RhdHMt
PmxlbiA9IHNrYi0+bGVuOwotCWllZWU4MDIxMV9yeF9tZ3QoaWVlZSwoc3RydWN0IHJ0bF84MDIx
MV9oZHJfNGFkZHIgKilza2ItPmRhdGEscnhfc3RhdHMpOwotCS8qIGlmICgoaWVlZS0+c3RhdGUg
PT0gSUVFRTgwMjExX0xJTktFRCkgJiYgKG1lbWNtcChoZHItPmFkZHIzLCBpZWVlLT5jdXJyZW50
X25ldHdvcmsuYnNzaWQsIEVUSF9BTEVOKSkpICovCi0JaWYgKChtZW1jbXAoaGRyLT5hZGRyMSwg
aWVlZS0+ZGV2LT5kZXZfYWRkciwgRVRIX0FMRU4pKSkvKiB1c2UgQUREUjEgdG8gcGVyZm9ybSBh
ZGRyZXNzIG1hdGNoaW5nIGZvciBNYW5hZ2VtZW50IGZyYW1lcyAqLwotCXsKKwlpZWVlODAyMTFf
cnhfbWd0KGllZWUsIChzdHJ1Y3QgcnRsXzgwMjExX2hkcl80YWRkciAqKXNrYi0+ZGF0YSwgcnhf
c3RhdHMpOworCisJLyogdXNlIEFERFIxIHRvIHBlcmZvcm0gYWRkcmVzcyBtYXRjaGluZyBmb3Ig
TWFuYWdlbWVudCBmcmFtZXMgKi8KKwlpZiAoKG1lbWNtcChoZHItPmFkZHIxLCBpZWVlLT5kZXYt
PmRldl9hZGRyLCBFVEhfQUxFTikpKSB7CiAJCWRldl9rZnJlZV9za2JfYW55KHNrYik7CiAJCXJl
dHVybiAwOwogCX0KQEAgLTI0MCw5ICsyNDAsNiBAQCBpZWVlODAyMTFfcnhfZnJhbWVfbWdtdChz
dHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSwgc3RydWN0IHNrX2J1ZmYgKnNrYiwKIAkJcHJp
bnRrKEtFUk5fREVCVUcgIiVzOiBNYXN0ZXIgbW9kZSBub3QgeWV0IHN1cHBvcnRlZC5cbiIsCiAJ
CSAgICAgICBpZWVlLT5kZXYtPm5hbWUpOwogCQlyZXR1cm4gMDsKLS8qCi0gIGhvc3RhcF91cGRh
dGVfc3RhX3BzKGllZWUsIChzdHJ1Y3QgaG9zdGFwX2llZWU4MDIxMV9oZHJfNGFkZHIgKikKLSAg
c2tiLT5kYXRhKTsqLwogCX0KCiAJaWYgKGllZWUtPmhvc3RhcGQgJiYgdHlwZSA9PSBJRUVFODAy
MTFfVFlQRV9NR01UKSB7CkBAIC0yNjgsNyArMjY1LDcgQEAgaWVlZTgwMjExX3J4X2ZyYW1lX21n
bXQoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIHN0cnVjdCBza19idWZmICpza2IsCiAJ
CXJldHVybiAwOwogCX0KCi0JICAgIGlmIChpZWVlLT5pd19tb2RlID09IElXX01PREVfTUFTVEVS
KSB7CisJaWYgKGllZWUtPml3X21vZGUgPT0gSVdfTU9ERV9NQVNURVIpIHsKIAkJaWYgKHR5cGUg
IT0gV0xBTl9GQ19UWVBFX01HTVQgJiYgdHlwZSAhPSBXTEFOX0ZDX1RZUEVfQ1RSTCkgewogCQkJ
cHJpbnRrKEtFUk5fREVCVUcgIiVzOiB1bmtub3duIG1hbmFnZW1lbnQgZnJhbWUgIgogCQkJICAg
ICAgICIodHlwZT0weCUwMngsIHN0eXBlPTB4JTAyeCkgZHJvcHBlZFxuIiwKQEAgLTI5MCwxMSAr
Mjg3LDkgQEAgaWVlZTgwMjExX3J4X2ZyYW1lX21nbXQoc3RydWN0IGllZWU4MDIxMV9kZXZpY2Ug
KmllZWUsIHN0cnVjdCBza19idWZmICpza2IsCgogLyogU2VlIElFRUUgODAyLjFIIGZvciBMTEMv
U05BUCBlbmNhcHN1bGF0aW9uL2RlY2Fwc3VsYXRpb24gKi8KIC8qIEV0aGVybmV0LUlJIHNuYXAg
aGVhZGVyIChSRkMxMDQyIGZvciBtb3N0IEV0aGVyVHlwZXMpICovCi1zdGF0aWMgdW5zaWduZWQg
Y2hhciByZmMxMDQyX2hlYWRlcltdID0KLXsgMHhhYSwgMHhhYSwgMHgwMywgMHgwMCwgMHgwMCwg
MHgwMCB9Oworc3RhdGljIHVuc2lnbmVkIGNoYXIgcmZjMTA0Ml9oZWFkZXJbXSA9IHsweGFhLCAw
eGFhLCAweDAzLCAweDAwLCAweDAwLCAweDAwfTsKIC8qIEJyaWRnZS1UdW5uZWwgaGVhZGVyIChm
b3IgRXRoZXJUeXBlcyBFVEhfUF9BQVJQIGFuZCBFVEhfUF9JUFgpICovCi1zdGF0aWMgdW5zaWdu
ZWQgY2hhciBicmlkZ2VfdHVubmVsX2hlYWRlcltdID0KLXsgMHhhYSwgMHhhYSwgMHgwMywgMHgw
MCwgMHgwMCwgMHhmOCB9Oworc3RhdGljIHVuc2lnbmVkIGNoYXIgYnJpZGdlX3R1bm5lbF9oZWFk
ZXJbXSA9IHsweGFhLCAweGFhLCAweDAzLCAweDAwLCAweDAwLCAweGY4fTsKIC8qIE5vIGVuY2Fw
c3VsYXRpb24gaGVhZGVyIGlmIEV0aGVyVHlwZSA8IDB4NjAwICg9bGVuZ3RoKSAqLwoKIC8qIENh
bGxlZCBieSBpZWVlODAyMTFfcnhfZnJhbWVfZGVjcnlwdCAqLwpAQCAtMzQ3LDkgKzM0Miw4IEBA
IGllZWU4MDIxMV9yeF9mcmFtZV9kZWNyeXB0KHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVl
LCBzdHJ1Y3Qgc2tfYnVmZiAqc2tiLAoKIAlpZiAoIWNyeXB0IHx8ICFjcnlwdC0+b3BzLT5kZWNy
eXB0X21wZHUpCiAJCXJldHVybiAwOwotCWlmIChpZWVlLT5od3NlY19hY3RpdmUpCi0JewotCQlz
dHJ1Y3QgY2JfZGVzYyAqdGNiX2Rlc2MgPSAoc3RydWN0IGNiX2Rlc2MgKikoc2tiLT5jYisgTUFY
X0RFVl9BRERSX1NJWkUpOworCWlmIChpZWVlLT5od3NlY19hY3RpdmUpIHsKKwkJc3RydWN0IGNi
X2Rlc2MgKnRjYl9kZXNjID0gKHN0cnVjdCBjYl9kZXNjICopKHNrYi0+Y2IgKyBNQVhfREVWX0FE
RFJfU0laRSk7CiAJCXRjYl9kZXNjLT5iSHdTZWMgPSAxOwogCX0KIAloZHIgPSAoc3RydWN0IHJ0
bF84MDIxMV9oZHJfNGFkZHIgKikgc2tiLT5kYXRhOwpAQCAtMzk0LDkgKzM4OCw4IEBAIGllZWU4
MDIxMV9yeF9mcmFtZV9kZWNyeXB0X21zZHUoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUs
IHN0cnVjdCBza19idWZmICpzCgogCWlmICghY3J5cHQgfHwgIWNyeXB0LT5vcHMtPmRlY3J5cHRf
bXNkdSkKIAkJcmV0dXJuIDA7Ci0JaWYgKGllZWUtPmh3c2VjX2FjdGl2ZSkKLQl7Ci0JCXN0cnVj
dCBjYl9kZXNjICp0Y2JfZGVzYyA9IChzdHJ1Y3QgY2JfZGVzYyAqKShza2ItPmNiKyBNQVhfREVW
X0FERFJfU0laRSk7CisJaWYgKGllZWUtPmh3c2VjX2FjdGl2ZSkgeworCQlzdHJ1Y3QgY2JfZGVz
YyAqdGNiX2Rlc2MgPSAoc3RydWN0IGNiX2Rlc2MgKikoc2tiLT5jYiArIE1BWF9ERVZfQUREUl9T
SVpFKTsKIAkJdGNiX2Rlc2MtPmJId1NlYyA9IDE7CiAJfQoKQEAgLTQzNCwxOCArNDI3LDE4IEBA
IHN0YXRpYyBpbnQgaXNfZHVwbGljYXRlX3BhY2tldChzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAq
aWVlZSwKCgogCS8qIFRPMkRTIGFuZCBRb1MgKi8KLQlpZigoKGZjICYgSUVFRTgwMjExX0ZDVExf
RFNUT0RTKSA9PSBJRUVFODAyMTFfRkNUTF9EU1RPRFMpJiZJRUVFODAyMTFfUU9TX0hBU19TRVEo
ZmMpKSB7Ci0JICBoZHJfNGFkZHJxb3MgPSAoc3RydWN0IHJ0bF84MDIxMV9oZHJfNGFkZHJxb3Mg
KiloZWFkZXI7Ci0JICB0aWQgPSBsZTE2X3RvX2NwdShoZHJfNGFkZHJxb3MtPnFvc19jdGwpICYg
SUVFRTgwMjExX1FDVExfVElEOwotCSAgdGlkID0gVVAyQUModGlkKTsKLQkgIHRpZCsrOworCWlm
ICgoKGZjICYgSUVFRTgwMjExX0ZDVExfRFNUT0RTKSA9PSBJRUVFODAyMTFfRkNUTF9EU1RPRFMp
ICYmIElFRUU4MDIxMV9RT1NfSEFTX1NFUShmYykpIHsKKwkJaGRyXzRhZGRycW9zID0gKHN0cnVj
dCBydGxfODAyMTFfaGRyXzRhZGRycW9zICopaGVhZGVyOworCQl0aWQgPSBsZTE2X3RvX2NwdSho
ZHJfNGFkZHJxb3MtPnFvc19jdGwpICYgSUVFRTgwMjExX1FDVExfVElEOworCQl0aWQgPSBVUDJB
Qyh0aWQpOworCQl0aWQrKzsKIAl9IGVsc2UgaWYgKElFRUU4MDIxMV9RT1NfSEFTX1NFUShmYykp
IHsgLyogUW9TICovCi0JICBoZHJfM2FkZHJxb3MgPSAoc3RydWN0IHJ0bF84MDIxMV9oZHJfM2Fk
ZHJxb3MgKiloZWFkZXI7Ci0JICB0aWQgPSBsZTE2X3RvX2NwdShoZHJfM2FkZHJxb3MtPnFvc19j
dGwpICYgSUVFRTgwMjExX1FDVExfVElEOwotCSAgdGlkID0gVVAyQUModGlkKTsKLQkgIHRpZCsr
OworCQloZHJfM2FkZHJxb3MgPSAoc3RydWN0IHJ0bF84MDIxMV9oZHJfM2FkZHJxb3MgKiloZWFk
ZXI7CisJCXRpZCA9IGxlMTZfdG9fY3B1KGhkcl8zYWRkcnFvcy0+cW9zX2N0bCkgJiBJRUVFODAy
MTFfUUNUTF9USUQ7CisJCXRpZCA9IFVQMkFDKHRpZCk7CisJCXRpZCsrOwogCX0gZWxzZSB7IC8q
IG5vIFFvUyAqLwotCSAgdGlkID0gMDsKKwkJdGlkID0gMDsKIAl9CgogCXN3aXRjaCAoaWVlZS0+
aXdfbW9kZSkgewpAQCAtNDYxLDcgKzQ1NCw3IEBAIHN0YXRpYyBpbnQgaXNfZHVwbGljYXRlX3Bh
Y2tldChzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSwKIAkJCWlmICghbWVtY21wKGVudHJ5
LT5tYWMsIG1hYywgRVRIX0FMRU4pKQogCQkJCWJyZWFrOwogCQl9Ci0JLy8JaWYgKG1lbWNtcChl
bnRyeS0+bWFjLCBtYWMsIEVUSF9BTEVOKSl7CisJLy8JaWYgKG1lbWNtcChlbnRyeS0+bWFjLCBt
YWMsIEVUSF9BTEVOKSkgewogCQlpZiAocCA9PSAmaWVlZS0+aWJzc19tYWNfaGFzaFtpbmRleF0p
IHsKIAkJCWVudHJ5ID0ga21hbGxvYyhzaXplb2Yoc3RydWN0IGllZWVfaWJzc19zZXEpLCBHRlBf
QVRPTUlDKTsKIAkJCWlmICghZW50cnkpCkBAIC01MTAsOCArNTAzLDcgQEAgc3RhdGljIGludCBp
c19kdXBsaWNhdGVfcGFja2V0KHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLAogc3RhdGlj
IGJvb2wgQWRkUmVvcmRlckVudHJ5KHN0cnVjdCByeF90c19yZWNvcmQgKnBUUywgc3RydWN0IHJ4
X3Jlb3JkZXJfZW50cnkgKnBSZW9yZGVyRW50cnkpCiB7CiAJc3RydWN0IGxpc3RfaGVhZCAqcExp
c3QgPSAmcFRTLT5yeF9wZW5kaW5nX3BrdF9saXN0OwotCXdoaWxlKHBMaXN0LT5uZXh0ICE9ICZw
VFMtPnJ4X3BlbmRpbmdfcGt0X2xpc3QpCi0JeworCXdoaWxlIChwTGlzdC0+bmV4dCAhPSAmcFRT
LT5yeF9wZW5kaW5nX3BrdF9saXN0KSB7CiAJCWlmIChTTl9MRVNTKHBSZW9yZGVyRW50cnktPlNl
cU51bSwgbGlzdF9lbnRyeShwTGlzdC0+bmV4dCwgc3RydWN0IHJ4X3Jlb3JkZXJfZW50cnksIExp
c3QpLT5TZXFOdW0pKQogCQkJcExpc3QgPSBwTGlzdC0+bmV4dDsKIAkJZWxzZSBpZiAoU05fRVFV
QUwocFJlb3JkZXJFbnRyeS0+U2VxTnVtLCBsaXN0X2VudHJ5KHBMaXN0LT5uZXh0LCBzdHJ1Y3Qg
cnhfcmVvcmRlcl9lbnRyeSwgTGlzdCktPlNlcU51bSkpCkBAIC01MjcsMTUgKzUxOSwxNiBAQCBz
dGF0aWMgYm9vbCBBZGRSZW9yZGVyRW50cnkoc3RydWN0IHJ4X3RzX3JlY29yZCAqcFRTLCBzdHJ1
Y3QgcnhfcmVvcmRlcl9lbnRyeSAqcAogCXJldHVybiB0cnVlOwogfQoKLXZvaWQgaWVlZTgwMjEx
X2luZGljYXRlX3BhY2tldHMoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIHN0cnVjdCBp
ZWVlODAyMTFfcnhiICoqcHJ4YkluZGljYXRlQXJyYXksdTggIGluZGV4KQordm9pZCBpZWVlODAy
MTFfaW5kaWNhdGVfcGFja2V0cyhzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSwgc3RydWN0
IGllZWU4MDIxMV9yeGIgKipwcnhiSW5kaWNhdGVBcnJheSwgdTggaW5kZXgpCiB7Ci0JdTggaSA9
IDAgLCBqPTA7CisJdTggaSA9IDAsIGogPSAwOwogCXUxNiBldGhlcnR5cGU7Ci0JZm9yKGogPSAw
OyBqPGluZGV4OyBqKyspCi0JewotLyogYWRkZWQgYnkgYW15IGZvciByZW9yZGVyICovCisKKwlm
b3IgKGogPSAwOyBqIDwgaW5kZXg7IGorKykgeworCQkvKiBhZGRlZCBieSBhbXkgZm9yIHJlb3Jk
ZXIgKi8KIAkJc3RydWN0IGllZWU4MDIxMV9yeGIgKnByeGIgPSBwcnhiSW5kaWNhdGVBcnJheVtq
XTsKLQkJZm9yKGkgPSAwOyBpPHByeGItPm5yX3N1YmZyYW1lczsgaSsrKSB7CisKKwkJZm9yIChp
ID0gMDsgaSA8IHByeGItPm5yX3N1YmZyYW1lczsgaSsrKSB7CiAJCQlzdHJ1Y3Qgc2tfYnVmZiAq
c3ViX3NrYiA9IHByeGItPnN1YmZyYW1lc1tpXTsKCiAJCS8qIGNvbnZlcnQgaGRyICsgcG9zc2li
bGUgTExDIGhlYWRlcnMgaW50byBFdGhlcm5ldCBoZWFkZXIgKi8KQEAgLTU4Niw3ICs1NzksNyBA
QCBzdGF0aWMgdm9pZCBSeFJlb3JkZXJJbmRpY2F0ZVBhY2tldChzdHJ1Y3QgaWVlZTgwMjExX2Rl
dmljZSAqaWVlZSwKIAl1MTYJCQlXaW5FbmQgPSAocFRTLT5yeF9pbmRpY2F0ZV9zZXEgKyBXaW5T
aXplIC0gMSkgJSA0MDk2OwogCXU4CQkJaW5kZXggPSAwOwogCWJvb2wJCQliTWF0Y2hXaW5TdGFy
dCA9IGZhbHNlLCBiUGt0SW5CdWYgPSBmYWxzZTsKLQlJRUVFODAyMTFfREVCVUcoSUVFRTgwMjEx
X0RMX1JFT1JERVIsIiVzKCk6IFNlcSBpcyAlZCxwVFMtPnJ4X2luZGljYXRlX3NlcSBpcyAlZCwg
V2luU2l6ZSBpcyAlZFxuIixfX2Z1bmNfXyxTZXFOdW0scFRTLT5yeF9pbmRpY2F0ZV9zZXEsV2lu
U2l6ZSk7CisJSUVFRTgwMjExX0RFQlVHKElFRUU4MDIxMV9ETF9SRU9SREVSLCAiJXMoKTogU2Vx
IGlzICVkLHBUUy0+cnhfaW5kaWNhdGVfc2VxIGlzICVkLCBXaW5TaXplIGlzICVkXG4iLCBfX2Z1
bmNfXywgU2VxTnVtLCBwVFMtPnJ4X2luZGljYXRlX3NlcSwgV2luU2l6ZSk7CgogCXByeGJJbmRp
Y2F0ZUFycmF5ID0ga21hbGxvY19hcnJheShSRU9SREVSX1dJTl9TSVpFLAogCQkJCQkgIHNpemVv
ZihzdHJ1Y3QgaWVlZTgwMjExX3J4YiAqKSwKQEAgLTYwMCwxMiArNTkzLDEyIEBAIHN0YXRpYyB2
b2lkIFJ4UmVvcmRlckluZGljYXRlUGFja2V0KHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVl
LAoKIAkvKiBEcm9wIG91dCB0aGUgcGFja2V0IHdoaWNoIFNlcU51bSBpcyBzbWFsbGVyIHRoYW4g
V2luU3RhcnQgKi8KIAlpZiAoU05fTEVTUyhTZXFOdW0sIHBUUy0+cnhfaW5kaWNhdGVfc2VxKSkg
ewotCQlJRUVFODAyMTFfREVCVUcoSUVFRTgwMjExX0RMX1JFT1JERVIsIlBhY2tldCBEcm9wISBJ
bmRpY2F0ZVNlcTogJWQsIE5ld1NlcTogJWRcbiIsCisJCUlFRUU4MDIxMV9ERUJVRyhJRUVFODAy
MTFfRExfUkVPUkRFUiwgIlBhY2tldCBEcm9wISBJbmRpY2F0ZVNlcTogJWQsIE5ld1NlcTogJWRc
biIsCiAJCQkJIHBUUy0+cnhfaW5kaWNhdGVfc2VxLCBTZXFOdW0pOwogCQlwSFRJbmZvLT5SeFJl
b3JkZXJEcm9wQ291bnRlcisrOwogCQl7CiAJCQlpbnQgaTsKLQkJCWZvcihpID0wOyBpIDwgcHJ4
Yi0+bnJfc3ViZnJhbWVzOyBpKyspIHsKKwkJCWZvciAoaSA9IDA7IGkgPCBwcnhiLT5ucl9zdWJm
cmFtZXM7IGkrKykgewogCQkJCWRldl9rZnJlZV9za2IocHJ4Yi0+c3ViZnJhbWVzW2ldKTsKIAkJ
CX0KIAkJCWtmcmVlKHByeGIpOwpAQCAtNjIxLDE2ICs2MTQsMTYgQEAgc3RhdGljIHZvaWQgUnhS
ZW9yZGVySW5kaWNhdGVQYWNrZXQoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsCiAJICog
MS4gSW5jb21pbmcgU2VxTnVtIGlzIGVxdWFsIHRvIFdpblN0YXJ0ID0+V2luZG93IHNoaWZ0IDEK
IAkgKiAyLiBJbmNvbWluZyBTZXFOdW0gaXMgbGFyZ2VyIHRoYW4gdGhlIFdpbkVuZCA9PiBXaW5k
b3cgc2hpZnQgTgogCSAqLwotCWlmKFNOX0VRVUFMKFNlcU51bSwgcFRTLT5yeF9pbmRpY2F0ZV9z
ZXEpKSB7CisJaWYgKFNOX0VRVUFMKFNlcU51bSwgcFRTLT5yeF9pbmRpY2F0ZV9zZXEpKSB7CiAJ
CXBUUy0+cnhfaW5kaWNhdGVfc2VxID0gKHBUUy0+cnhfaW5kaWNhdGVfc2VxICsgMSkgJSA0MDk2
OwogCQliTWF0Y2hXaW5TdGFydCA9IHRydWU7Ci0JfSBlbHNlIGlmKFNOX0xFU1MoV2luRW5kLCBT
ZXFOdW0pKSB7Ci0JCWlmKFNlcU51bSA+PSAoV2luU2l6ZSAtIDEpKSB7Ci0JCQlwVFMtPnJ4X2lu
ZGljYXRlX3NlcSA9IFNlcU51bSArIDEgLVdpblNpemU7CisJfSBlbHNlIGlmIChTTl9MRVNTKFdp
bkVuZCwgU2VxTnVtKSkgeworCQlpZiAoU2VxTnVtID49IChXaW5TaXplIC0gMSkpIHsKKwkJCXBU
Uy0+cnhfaW5kaWNhdGVfc2VxID0gU2VxTnVtICsgMSAtIFdpblNpemU7CiAJCX0gZWxzZSB7CiAJ
CQlwVFMtPnJ4X2luZGljYXRlX3NlcSA9IDQwOTUgLSAoV2luU2l6ZSAtIChTZXFOdW0gKyAxKSkg
KyAxOwogCQl9Ci0JCUlFRUU4MDIxMV9ERUJVRyhJRUVFODAyMTFfRExfUkVPUkRFUiwgIldpbmRv
dyBTaGlmdCEgSW5kaWNhdGVTZXE6ICVkLCBOZXdTZXE6ICVkXG4iLHBUUy0+cnhfaW5kaWNhdGVf
c2VxLCBTZXFOdW0pOworCQlJRUVFODAyMTFfREVCVUcoSUVFRTgwMjExX0RMX1JFT1JERVIsICJX
aW5kb3cgU2hpZnQhIEluZGljYXRlU2VxOiAlZCwgTmV3U2VxOiAlZFxuIiwgcFRTLT5yeF9pbmRp
Y2F0ZV9zZXEsIFNlcU51bSk7CiAJfQoKIAkvKgpAQCAtNjQzLDE1ICs2MzYsMTUgQEAgc3RhdGlj
IHZvaWQgUnhSZW9yZGVySW5kaWNhdGVQYWNrZXQoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmll
ZWUsCiAJICogMS4gQWxsIHBhY2tldHMgd2l0aCBTZXFOdW0gc21hbGxlciB0aGFuIFdpblN0YXJ0
ID0+IEluZGljYXRlCiAJICogMi4gQWxsIHBhY2tldHMgd2l0aCBTZXFOdW0gbGFyZ2VyIHRoYW4g
b3IgZXF1YWwgdG8gV2luU3RhcnQgPT4gQnVmZmVyIGl0LgogCSAqLwotCWlmKGJNYXRjaFdpblN0
YXJ0KSB7CisJaWYgKGJNYXRjaFdpblN0YXJ0KSB7CiAJCS8qIEN1cnJlbnQgcGFja2V0IGlzIGdv
aW5nIHRvIGJlIGluZGljYXRlZC4qLwotCQlJRUVFODAyMTFfREVCVUcoSUVFRTgwMjExX0RMX1JF
T1JERVIsICJQYWNrZXRzIGluZGljYXRpb24hISBJbmRpY2F0ZVNlcTogJWQsIE5ld1NlcTogJWRc
biIsXAorCQlJRUVFODAyMTFfREVCVUcoSUVFRTgwMjExX0RMX1JFT1JERVIsICJQYWNrZXRzIGlu
ZGljYXRpb24hISBJbmRpY2F0ZVNlcTogJWQsIE5ld1NlcTogJWRcbiIsCiAJCQkJcFRTLT5yeF9p
bmRpY2F0ZV9zZXEsIFNlcU51bSk7CiAJCXByeGJJbmRpY2F0ZUFycmF5WzBdID0gcHJ4YjsKIAkJ
aW5kZXggPSAxOwogCX0gZWxzZSB7CiAJCS8qIEN1cnJlbnQgcGFja2V0IGlzIGdvaW5nIHRvIGJl
IGluc2VydGVkIGludG8gcGVuZGluZyBsaXN0LiovCi0JCWlmKCFsaXN0X2VtcHR5KCZpZWVlLT5S
eFJlb3JkZXJfVW51c2VkX0xpc3QpKSB7CisJCWlmICghbGlzdF9lbXB0eSgmaWVlZS0+UnhSZW9y
ZGVyX1VudXNlZF9MaXN0KSkgewogCQkJcFJlb3JkZXJFbnRyeSA9IGxpc3RfZW50cnkoaWVlZS0+
UnhSZW9yZGVyX1VudXNlZF9MaXN0Lm5leHQsIHN0cnVjdCByeF9yZW9yZGVyX2VudHJ5LCBMaXN0
KTsKIAkJCWxpc3RfZGVsX2luaXQoJnBSZW9yZGVyRW50cnktPkxpc3QpOwoKQEAgLTY1OSwxMyAr
NjUyLDE0IEBAIHN0YXRpYyB2b2lkIFJ4UmVvcmRlckluZGljYXRlUGFja2V0KHN0cnVjdCBpZWVl
ODAyMTFfZGV2aWNlICppZWVlLAogCQkJcFJlb3JkZXJFbnRyeS0+U2VxTnVtID0gU2VxTnVtOwog
CQkJcFJlb3JkZXJFbnRyeS0+cHJ4YiA9IHByeGI7CgotCQkJaWYoIUFkZFJlb3JkZXJFbnRyeShw
VFMsIHBSZW9yZGVyRW50cnkpKSB7CisJCQlpZiAoIUFkZFJlb3JkZXJFbnRyeShwVFMsIHBSZW9y
ZGVyRW50cnkpKSB7CiAJCQkJSUVFRTgwMjExX0RFQlVHKElFRUU4MDIxMV9ETF9SRU9SREVSLCAi
JXMoKTogRHVwbGljYXRlIHBhY2tldCBpcyBkcm9wcGVkISEgSW5kaWNhdGVTZXE6ICVkLCBOZXdT
ZXE6ICVkXG4iLAogCQkJCQlfX2Z1bmNfXywgcFRTLT5yeF9pbmRpY2F0ZV9zZXEsIFNlcU51bSk7
Ci0JCQkJbGlzdF9hZGRfdGFpbCgmcFJlb3JkZXJFbnRyeS0+TGlzdCwmaWVlZS0+UnhSZW9yZGVy
X1VudXNlZF9MaXN0KTsKKwkJCQlsaXN0X2FkZF90YWlsKCZwUmVvcmRlckVudHJ5LT5MaXN0LCAm
aWVlZS0+UnhSZW9yZGVyX1VudXNlZF9MaXN0KTsKIAkJCQl7CiAJCQkJCWludCBpOwotCQkJCQlm
b3IoaSA9MDsgaSA8IHByeGItPm5yX3N1YmZyYW1lczsgaSsrKSB7CisKKwkJCQkJZm9yIChpID0g
MDsgaSA8IHByeGItPm5yX3N1YmZyYW1lczsgaSsrKSB7CiAJCQkJCQlkZXZfa2ZyZWVfc2tiKHBy
eGItPnN1YmZyYW1lc1tpXSk7CiAJCQkJCX0KIAkJCQkJa2ZyZWUocHJ4Yik7CkBAIC02NzMsMTAg
KzY2Nyw5IEBAIHN0YXRpYyB2b2lkIFJ4UmVvcmRlckluZGljYXRlUGFja2V0KHN0cnVjdCBpZWVl
ODAyMTFfZGV2aWNlICppZWVlLAogCQkJCX0KIAkJCX0gZWxzZSB7CiAJCQkJSUVFRTgwMjExX0RF
QlVHKElFRUU4MDIxMV9ETF9SRU9SREVSLAotCQkJCQkgIlBrdCBpbnNlcnQgaW50byBidWZmZXIh
ISBJbmRpY2F0ZVNlcTogJWQsIE5ld1NlcTogJWRcbiIscFRTLT5yeF9pbmRpY2F0ZV9zZXEsIFNl
cU51bSk7CisJCQkJCSAiUGt0IGluc2VydCBpbnRvIGJ1ZmZlciEhIEluZGljYXRlU2VxOiAlZCwg
TmV3U2VxOiAlZFxuIiwgcFRTLT5yeF9pbmRpY2F0ZV9zZXEsIFNlcU51bSk7CiAJCQl9Ci0JCX0K
LQkJZWxzZSB7CisJCX0gZWxzZSB7CiAJCQkvKgogCQkJICogUGFja2V0cyBhcmUgZHJvcHBlZCBp
ZiB0aGVyZSBpcyBub3QgZW5vdWdoIHJlb3JkZXIgZW50cmllcy4KIAkJCSAqIFRoaXMgcGFydCBz
aGFsbCBiZSBtb2RpZmllZCEhIFdlIGNhbiBqdXN0IGluZGljYXRlIGFsbCB0aGUKQEAgLTY4NSw3
ICs2NzgsOCBAQCBzdGF0aWMgdm9pZCBSeFJlb3JkZXJJbmRpY2F0ZVBhY2tldChzdHJ1Y3QgaWVl
ZTgwMjExX2RldmljZSAqaWVlZSwKIAkJCUlFRUU4MDIxMV9ERUJVRyhJRUVFODAyMTFfRExfRVJS
LCAiUnhSZW9yZGVySW5kaWNhdGVQYWNrZXQoKTogVGhlcmUgaXMgbm8gcmVvcmRlciBlbnRyeSEh
IFBhY2tldCBpcyBkcm9wcGVkISFcbiIpOwogCQkJewogCQkJCWludCBpOwotCQkJCWZvcihpID0w
OyBpIDwgcHJ4Yi0+bnJfc3ViZnJhbWVzOyBpKyspIHsKKworCQkJCWZvciAoaSA9IDA7IGkgPCBw
cnhiLT5ucl9zdWJmcmFtZXM7IGkrKykgewogCQkJCQlkZXZfa2ZyZWVfc2tiKHByeGItPnN1YmZy
YW1lc1tpXSk7CiAJCQkJfQogCQkJCWtmcmVlKHByeGIpOwpAQCAtNjk1LDI5ICs2ODksMjggQEAg
c3RhdGljIHZvaWQgUnhSZW9yZGVySW5kaWNhdGVQYWNrZXQoc3RydWN0IGllZWU4MDIxMV9kZXZp
Y2UgKmllZWUsCiAJfQoKIAkvKiBDaGVjayBpZiB0aGVyZSBpcyBhbnkgcGFja2V0IG5lZWQgaW5k
aWNhdGUuKi8KLQl3aGlsZSghbGlzdF9lbXB0eSgmcFRTLT5yeF9wZW5kaW5nX3BrdF9saXN0KSkg
ewotCQlJRUVFODAyMTFfREVCVUcoSUVFRTgwMjExX0RMX1JFT1JERVIsIiVzKCk6IHN0YXJ0IFJS
RU9SREVSIGluZGljYXRlXG4iLF9fZnVuY19fKTsKKwl3aGlsZSAoIWxpc3RfZW1wdHkoJnBUUy0+
cnhfcGVuZGluZ19wa3RfbGlzdCkpIHsKKwkJSUVFRTgwMjExX0RFQlVHKElFRUU4MDIxMV9ETF9S
RU9SREVSLCAiJXMoKTogc3RhcnQgUlJFT1JERVIgaW5kaWNhdGVcbiIsIF9fZnVuY19fKTsKIAkJ
cFJlb3JkZXJFbnRyeSA9IGxpc3RfZW50cnkocFRTLT5yeF9wZW5kaW5nX3BrdF9saXN0LnByZXYs
IHN0cnVjdCByeF9yZW9yZGVyX2VudHJ5LCBMaXN0KTsKIAkJaWYgKFNOX0xFU1MocFJlb3JkZXJF
bnRyeS0+U2VxTnVtLCBwVFMtPnJ4X2luZGljYXRlX3NlcSkgfHwKLQkJICAgIFNOX0VRVUFMKHBS
ZW9yZGVyRW50cnktPlNlcU51bSwgcFRTLT5yeF9pbmRpY2F0ZV9zZXEpKQotCQl7CisJCQlTTl9F
UVVBTChwUmVvcmRlckVudHJ5LT5TZXFOdW0sIHBUUy0+cnhfaW5kaWNhdGVfc2VxKSkgewogCQkJ
LyogVGhpcyBwcm90ZWN0IGJ1ZmZlciBmcm9tIG92ZXJmbG93LiAqLwogCQkJaWYgKGluZGV4ID49
IFJFT1JERVJfV0lOX1NJWkUpIHsKLQkJCQlJRUVFODAyMTFfREVCVUcoSUVFRTgwMjExX0RMX0VS
UiwgIlJ4UmVvcmRlckluZGljYXRlUGFja2V0KCk6IEJ1ZmZlciBvdmVyZmxvdyEhIFxuIik7CisJ
CQkJSUVFRTgwMjExX0RFQlVHKElFRUU4MDIxMV9ETF9FUlIsICJSeFJlb3JkZXJJbmRpY2F0ZVBh
Y2tldCgpOiBCdWZmZXIgb3ZlcmZsb3chIVxuIik7CiAJCQkJYlBrdEluQnVmID0gdHJ1ZTsKIAkJ
CQlicmVhazsKIAkJCX0KCiAJCQlsaXN0X2RlbF9pbml0KCZwUmVvcmRlckVudHJ5LT5MaXN0KTsK
Ci0JCQlpZihTTl9FUVVBTChwUmVvcmRlckVudHJ5LT5TZXFOdW0sIHBUUy0+cnhfaW5kaWNhdGVf
c2VxKSkKKwkJCWlmIChTTl9FUVVBTChwUmVvcmRlckVudHJ5LT5TZXFOdW0sIHBUUy0+cnhfaW5k
aWNhdGVfc2VxKSkKIAkJCQlwVFMtPnJ4X2luZGljYXRlX3NlcSA9IChwVFMtPnJ4X2luZGljYXRl
X3NlcSArIDEpICUgNDA5NjsKCi0JCQlJRUVFODAyMTFfREVCVUcoSUVFRTgwMjExX0RMX1JFT1JE
RVIsIlBhY2tldHMgaW5kaWNhdGlvbiEhIEluZGljYXRlU2VxOiAlZCwgTmV3U2VxOiAlZFxuIixw
VFMtPnJ4X2luZGljYXRlX3NlcSwgU2VxTnVtKTsKKwkJCUlFRUU4MDIxMV9ERUJVRyhJRUVFODAy
MTFfRExfUkVPUkRFUiwgIlBhY2tldHMgaW5kaWNhdGlvbiEhIEluZGljYXRlU2VxOiAlZCwgTmV3
U2VxOiAlZFxuIiwgcFRTLT5yeF9pbmRpY2F0ZV9zZXEsIFNlcU51bSk7CiAJCQlwcnhiSW5kaWNh
dGVBcnJheVtpbmRleF0gPSBwUmVvcmRlckVudHJ5LT5wcnhiOwogCQkJaW5kZXgrKzsKCi0JCQls
aXN0X2FkZF90YWlsKCZwUmVvcmRlckVudHJ5LT5MaXN0LCZpZWVlLT5SeFJlb3JkZXJfVW51c2Vk
X0xpc3QpOworCQkJbGlzdF9hZGRfdGFpbCgmcFJlb3JkZXJFbnRyeS0+TGlzdCwgJmllZWUtPlJ4
UmVvcmRlcl9VbnVzZWRfTGlzdCk7CiAJCX0gZWxzZSB7CiAJCQliUGt0SW5CdWYgPSB0cnVlOwog
CQkJYnJlYWs7CkBAIC03MjUsMTMgKzcxOCwxMyBAQCBzdGF0aWMgdm9pZCBSeFJlb3JkZXJJbmRp
Y2F0ZVBhY2tldChzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSwKIAl9CgogCS8qIEhhbmRs
aW5nIHBlbmRpbmcgdGltZXIuIFNldCB0aGlzIHRpbWVyIHRvIHByZXZlbnQgZnJvbSBsb25nIHRp
bWUgUnggYnVmZmVyaW5nLiovCi0JaWYgKGluZGV4PjApIHsKKwlpZiAoaW5kZXggPiAwKSB7CiAJ
CS8qIENhbmNlbCBwcmV2aW91cyBwZW5kaW5nIHRpbWVyLiAqLwogCQlwVFMtPnJ4X3RpbWVvdXRf
aW5kaWNhdGVfc2VxID0gMHhmZmZmOwoKIAkJLyogSW5kaWNhdGUgcGFja2V0cyAqLwotCQlpZihp
bmRleD5SRU9SREVSX1dJTl9TSVpFKXsKLQkJCUlFRUU4MDIxMV9ERUJVRyhJRUVFODAyMTFfRExf
RVJSLCAiUnhSZW9yZGVySW5kaWNhdGVQYWNrZXQoKTogUnggUmVvcmRlciBidWZmZXIgZnVsbCEh
IFxuIik7CisJCWlmIChpbmRleCA+IFJFT1JERVJfV0lOX1NJWkUpIHsKKwkJCUlFRUU4MDIxMV9E
RUJVRyhJRUVFODAyMTFfRExfRVJSLCAiUnhSZW9yZGVySW5kaWNhdGVQYWNrZXQoKTogUnggUmVv
cmRlciBidWZmZXIgZnVsbCEhXG4iKTsKIAkJCWtmcmVlKHByeGJJbmRpY2F0ZUFycmF5KTsKIAkJ
CXJldHVybjsKIAkJfQpAQCAtNzQwLDkgKzczMyw5IEBAIHN0YXRpYyB2b2lkIFJ4UmVvcmRlcklu
ZGljYXRlUGFja2V0KHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLAoKIAlpZiAoYlBrdElu
QnVmICYmIHBUUy0+cnhfdGltZW91dF9pbmRpY2F0ZV9zZXEgPT0gMHhmZmZmKSB7CiAJCS8qIFNl
dCBuZXcgcGVuZGluZyB0aW1lci4gKi8KLQkJSUVFRTgwMjExX0RFQlVHKElFRUU4MDIxMV9ETF9S
RU9SREVSLCIlcygpOiBTRVQgcnggdGltZW91dCB0aW1lclxuIiwgX19mdW5jX18pOworCQlJRUVF
ODAyMTFfREVCVUcoSUVFRTgwMjExX0RMX1JFT1JERVIsICIlcygpOiBTRVQgcnggdGltZW91dCB0
aW1lclxuIiwgX19mdW5jX18pOwogCQlwVFMtPnJ4X3RpbWVvdXRfaW5kaWNhdGVfc2VxID0gcFRT
LT5yeF9pbmRpY2F0ZV9zZXE7Ci0JCWlmKHRpbWVyX3BlbmRpbmcoJnBUUy0+cnhfcGt0X3BlbmRp
bmdfdGltZXIpKQorCQlpZiAodGltZXJfcGVuZGluZygmcFRTLT5yeF9wa3RfcGVuZGluZ190aW1l
cikpCiAJCQlkZWxfdGltZXJfc3luYygmcFRTLT5yeF9wa3RfcGVuZGluZ190aW1lcik7CiAJCXBU
Uy0+cnhfcGt0X3BlbmRpbmdfdGltZXIuZXhwaXJlcyA9IGppZmZpZXMgKwogCQkJCW1zZWNzX3Rv
X2ppZmZpZXMocEhUSW5mby0+UnhSZW9yZGVyUGVuZGluZ1RpbWUpOwpAQCAtNzU5LDE4ICs3NTIs
MTggQEAgc3RhdGljIHU4IHBhcnNlX3N1YmZyYW1lKHN0cnVjdCBza19idWZmICpza2IsCiAJc3Ry
dWN0IHJ0bF84MDIxMV9oZHJfM2FkZHIgICpoZHIgPSAoc3RydWN0IHJ0bF84MDIxMV9oZHJfM2Fk
ZHIgKilza2ItPmRhdGE7CiAJdTE2CQlmYyA9IGxlMTZfdG9fY3B1KGhkci0+ZnJhbWVfY3RsKTsK
Ci0JdTE2CQlMTENPZmZzZXQ9IHNpemVvZihzdHJ1Y3QgcnRsXzgwMjExX2hkcl8zYWRkcik7CisJ
dTE2CQlMTENPZmZzZXQgPSBzaXplb2Yoc3RydWN0IHJ0bF84MDIxMV9oZHJfM2FkZHIpOwogCXUx
NgkJQ2hrTGVuZ3RoOwogCWJvb2wJCWJJc0FnZ3JlZ2F0ZUZyYW1lID0gZmFsc2U7CiAJdTE2CQlu
U3ViZnJhbWVfTGVuZ3RoOwogCXU4CQluUGFkZGluZ19MZW5ndGggPSAwOwotCXUxNgkJU2VxTnVt
PTA7CisJdTE2CQlTZXFOdW0gPSAwOwoKIAlzdHJ1Y3Qgc2tfYnVmZiAqc3ViX3NrYjsKIAkvKiBq
dXN0IGZvciBkZWJ1ZyBwdXJwb3NlICovCiAJU2VxTnVtID0gV0xBTl9HRVRfU0VRX1NFUShsZTE2
X3RvX2NwdShoZHItPnNlcV9jdGwpKTsKCi0JaWYgKChJRUVFODAyMTFfUU9TX0hBU19TRVEoZmMp
KSYmXAorCWlmICgoSUVFRTgwMjExX1FPU19IQVNfU0VRKGZjKSkgJiYgXAogCQkJKCgoZnJhbWVx
b3MgKikoc2tiLT5kYXRhICsgSUVFRTgwMjExXzNBRERSX0xFTikpLT5maWVsZC5yZXNlcnZlZCkp
IHsKIAkJYklzQWdncmVnYXRlRnJhbWUgPSB0cnVlOwogCX0KQEAgLTc5MCw3ICs3ODMsNyBAQCBz
dGF0aWMgdTggcGFyc2Vfc3ViZnJhbWUoc3RydWN0IHNrX2J1ZmYgKnNrYiwKCiAJc2tiX3B1bGwo
c2tiLCBMTENPZmZzZXQpOwoKLQlpZighYklzQWdncmVnYXRlRnJhbWUpIHsKKwlpZiAoIWJJc0Fn
Z3JlZ2F0ZUZyYW1lKSB7CiAJCXJ4Yi0+bnJfc3ViZnJhbWVzID0gMTsKICNpZmRlZiBKT0hOX05P
Q1BZCiAJCXJ4Yi0+c3ViZnJhbWVzWzBdID0gc2tiOwpAQCAtNzk4LDI1ICs3OTEsMjUgQEAgc3Rh
dGljIHU4IHBhcnNlX3N1YmZyYW1lKHN0cnVjdCBza19idWZmICpza2IsCiAJCXJ4Yi0+c3ViZnJh
bWVzWzBdID0gc2tiX2NvcHkoc2tiLCBHRlBfQVRPTUlDKTsKICNlbmRpZgoKLQkJbWVtY3B5KHJ4
Yi0+c3JjLHNyYyxFVEhfQUxFTik7Ci0JCW1lbWNweShyeGItPmRzdCxkc3QsRVRIX0FMRU4pOwor
CQltZW1jcHkocnhiLT5zcmMsIHNyYywgRVRIX0FMRU4pOworCQltZW1jcHkocnhiLT5kc3QsIGRz
dCwgRVRIX0FMRU4pOwogCQlyZXR1cm4gMTsKIAl9IGVsc2UgewogCQlyeGItPm5yX3N1YmZyYW1l
cyA9IDA7Ci0JCW1lbWNweShyeGItPnNyYyxzcmMsRVRIX0FMRU4pOwotCQltZW1jcHkocnhiLT5k
c3QsZHN0LEVUSF9BTEVOKTsKLQkJd2hpbGUoc2tiLT5sZW4gPiBFVEhFUk5FVF9IRUFERVJfU0la
RSkgeworCQltZW1jcHkocnhiLT5zcmMsIHNyYywgRVRIX0FMRU4pOworCQltZW1jcHkocnhiLT5k
c3QsIGRzdCwgRVRIX0FMRU4pOworCQl3aGlsZSAoc2tiLT5sZW4gPiBFVEhFUk5FVF9IRUFERVJf
U0laRSkgewogCQkJLyogT2Zmc2V0IDEyIGRlbm90ZSAyIG1hYyBhZGRyZXNzICovCiAJCQluU3Vi
ZnJhbWVfTGVuZ3RoID0gKigodTE2ICopKHNrYi0+ZGF0YSArIDEyKSk7CiAJCQkvKiA9PW09PT5j
aGFuZ2UgdGhlIGxlbmd0aCBvcmRlciAqLwogCQkJblN1YmZyYW1lX0xlbmd0aCA9IChuU3ViZnJh
bWVfTGVuZ3RoPj44KSArIChuU3ViZnJhbWVfTGVuZ3RoPDw4KTsKCi0JCQlpZiAoc2tiLT5sZW48
KEVUSEVSTkVUX0hFQURFUl9TSVpFICsgblN1YmZyYW1lX0xlbmd0aCkpIHsKKwkJCWlmIChza2It
PmxlbiA8IChFVEhFUk5FVF9IRUFERVJfU0laRSArIG5TdWJmcmFtZV9MZW5ndGgpKSB7CiAJCQkJ
cHJpbnRrKCIlczogQS1NU0RVIHBhcnNlIGVycm9yISEgcFJmZC0+blRvdGFsU3ViZnJhbWUgOiAl
ZFxuIixcCiAJCQkJCQlfX2Z1bmNfXywgcnhiLT5ucl9zdWJmcmFtZXMpOwotCQkJCXByaW50aygi
JXM6IEEtTVNEVSBwYXJzZSBlcnJvciEhIFN1YmZyYW1lIExlbmd0aDogJWRcbiIsX19mdW5jX18s
IG5TdWJmcmFtZV9MZW5ndGgpOwotCQkJCXByaW50aygiblJlbWFpbl9MZW5ndGggaXMgJWQgYW5k
IG5TdWJmcmFtZV9MZW5ndGggaXMgOiAlZFxuIixza2ItPmxlbixuU3ViZnJhbWVfTGVuZ3RoKTsK
LQkJCQlwcmludGsoIlRoZSBQYWNrZXQgU2VxTnVtIGlzICVkXG4iLFNlcU51bSk7CisJCQkJcHJp
bnRrKCIlczogQS1NU0RVIHBhcnNlIGVycm9yISEgU3ViZnJhbWUgTGVuZ3RoOiAlZFxuIiwgX19m
dW5jX18sIG5TdWJmcmFtZV9MZW5ndGgpOworCQkJCXByaW50aygiblJlbWFpbl9MZW5ndGggaXMg
JWQgYW5kIG5TdWJmcmFtZV9MZW5ndGggaXMgOiAlZFxuIiwgc2tiLT5sZW4sIG5TdWJmcmFtZV9M
ZW5ndGgpOworCQkJCXByaW50aygiVGhlIFBhY2tldCBTZXFOdW0gaXMgJWRcbiIsIFNlcU51bSk7
CiAJCQkJcmV0dXJuIDA7CiAJCQl9CgpAQCAtOTE4LDkgKzkxMSw4IEBAIGludCBpZWVlODAyMTFf
cngoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIHN0cnVjdCBza19idWZmICpza2IsCiAJ
ZnJhZyA9IFdMQU5fR0VUX1NFUV9GUkFHKHNjKTsKIAloZHJsZW4gPSBpZWVlODAyMTFfZ2V0X2hk
cmxlbihmYyk7CgotCWlmIChIVENDaGVjayhpZWVlLCBza2ItPmRhdGEpKQotCXsKLQkJaWYobmV0
X3JhdGVsaW1pdCgpKQorCWlmIChIVENDaGVjayhpZWVlLCBza2ItPmRhdGEpKSB7CisJCWlmIChu
ZXRfcmF0ZWxpbWl0KCkpCiAJCQlwcmludGsoImZpbmQgSFRDQ29udHJvbFxuIik7CiAJCWhkcmxl
biArPSA0OwogCQlyeF9zdGF0cy0+YkNvbnRhaW5IVEMgPSB0cnVlOwpAQCAtOTM1LDYgKzkyNyw3
IEBAIGludCBpZWVlODAyMTFfcngoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIHN0cnVj
dCBza19idWZmICpza2IsCiAJLyogSWYgc3B5IG1vbml0b3Jpbmcgb24gKi8KIAlpZiAoaWZhY2Ut
PnNweV9kYXRhLnNweV9udW1iZXIgPiAwKSB7CiAJCXN0cnVjdCBpd19xdWFsaXR5IHdzdGF0czsK
KwogCQl3c3RhdHMubGV2ZWwgPSByeF9zdGF0cy0+cnNzaTsKIAkJd3N0YXRzLm5vaXNlID0gcnhf
c3RhdHMtPm5vaXNlOwogCQl3c3RhdHMudXBkYXRlZCA9IDY7CS8qIE5vIHF1YWwgdmFsdWUgKi8K
QEAgLTk1NCw2ICs5NDcsNyBAQCBpbnQgaWVlZTgwMjExX3J4KHN0cnVjdCBpZWVlODAyMTFfZGV2
aWNlICppZWVlLCBzdHJ1Y3Qgc2tfYnVmZiAqc2tiLAoKIAlpZiAoaWVlZS0+aG9zdF9kZWNyeXB0
KSB7CiAJCWludCBpZHggPSAwOworCiAJCWlmIChza2ItPmxlbiA+PSBoZHJsZW4gKyAzKQogCQkJ
aWR4ID0gc2tiLT5kYXRhW2hkcmxlbiArIDNdID4+IDY7CiAJCWNyeXB0ID0gaWVlZS0+Y3J5cHRb
aWR4XTsKQEAgLTEwMDAsNDMgKzk5NCwzNSBAQCBpbnQgaWVlZTgwMjExX3J4KHN0cnVjdCBpZWVl
ODAyMTFfZGV2aWNlICppZWVlLCBzdHJ1Y3Qgc2tfYnVmZiAqc2tiLAogCQlnb3RvIHJ4X2Ryb3Bw
ZWQ7CgogCS8qIGlmIFFvUyBlbmFibGVkLCBzaG91bGQgY2hlY2sgdGhlIHNlcXVlbmNlIGZvciBl
YWNoIG9mIHRoZSBBQyAqLwotCWlmICgoIWllZWUtPnBIVEluZm8tPmJDdXJSeFJlb3JkZXJFbmFi
bGUpIHx8ICFpZWVlLT5jdXJyZW50X25ldHdvcmsucW9zX2RhdGEuYWN0aXZlfHwgIUlzRGF0YUZy
YW1lKHNrYi0+ZGF0YSkgfHwgSXNMZWdhY3lEYXRhRnJhbWUoc2tiLT5kYXRhKSkgeworCWlmICgo
IWllZWUtPnBIVEluZm8tPmJDdXJSeFJlb3JkZXJFbmFibGUpIHx8ICFpZWVlLT5jdXJyZW50X25l
dHdvcmsucW9zX2RhdGEuYWN0aXZlIHx8ICFJc0RhdGFGcmFtZShza2ItPmRhdGEpIHx8IElzTGVn
YWN5RGF0YUZyYW1lKHNrYi0+ZGF0YSkpIHsKIAkJaWYgKGlzX2R1cGxpY2F0ZV9wYWNrZXQoaWVl
ZSwgaGRyKSkKIAkJZ290byByeF9kcm9wcGVkOwoKLQl9Ci0JZWxzZQotCXsKKwl9IGVsc2Ugewog
CQlzdHJ1Y3QgcnhfdHNfcmVjb3JkICpwUnhUUyA9IE5VTEw7Ci0JCWlmKEdldFRzKAorCisJCWlm
IChHZXRUcygKIAkJCQlpZWVlLAogCQkJCShzdHJ1Y3QgdHNfY29tbW9uX2luZm8gKiopICZwUnhU
UywKIAkJCQloZHItPmFkZHIyLAogCQkJCUZyYW1lX1FvU1RJRCgodTggKikoc2tiLT5kYXRhKSks
CiAJCQkJUlhfRElSLAotCQkJCXRydWUpKQotCQl7Ci0KKwkJCQl0cnVlKSkgewogCQkJaWYgKChm
YyAmICgxPDwxMSkpICYmCiAJCQkgICAgKGZyYWcgPT0gcFJ4VFMtPnJ4X2xhc3RfZnJhZ19udW0p
ICYmCiAJCQkgICAgKFdMQU5fR0VUX1NFUV9TRVEoc2MpID09IHBSeFRTLT5yeF9sYXN0X3NlcV9u
dW0pKSB7CiAJCQkJZ290byByeF9kcm9wcGVkOwotCQkJfQotCQkJZWxzZQotCQkJeworCQkJfSBl
bHNlIHsKIAkJCQlwUnhUUy0+cnhfbGFzdF9mcmFnX251bSA9IGZyYWc7CiAJCQkJcFJ4VFMtPnJ4
X2xhc3Rfc2VxX251bSA9IFdMQU5fR0VUX1NFUV9TRVEoc2MpOwogCQkJfQotCQl9Ci0JCWVsc2UK
LQkJewotCQkJSUVFRTgwMjExX0RFQlVHKElFRUU4MDIxMV9ETF9FUlIsICIlcygpOiBObyBUUyEh
IFNraXAgdGhlIGNoZWNrISFcbiIsX19mdW5jX18pOworCQl9IGVsc2UgeworCQkJSUVFRTgwMjEx
X0RFQlVHKElFRUU4MDIxMV9ETF9FUlIsICIlcygpOiBObyBUUyEhIFNraXAgdGhlIGNoZWNrISFc
biIsIF9fZnVuY19fKTsKIAkJCWdvdG8gcnhfZHJvcHBlZDsKIAkJfQogCX0KIAlpZiAodHlwZSA9
PSBJRUVFODAyMTFfRlRZUEVfTUdNVCkgewoKLQogCQlpZiAoaWVlZTgwMjExX3J4X2ZyYW1lX21n
bXQoaWVlZSwgc2tiLCByeF9zdGF0cywgdHlwZSwgc3R5cGUpKQogCQkJZ290byByeF9kcm9wcGVk
OwogCQllbHNlCkBAIC0xMTA5LDcgKzEwOTUsNyBAQCBpbnQgaWVlZTgwMjExX3J4KHN0cnVjdCBp
ZWVlODAyMTFfZGV2aWNlICppZWVlLCBzdHJ1Y3Qgc2tfYnVmZiAqc2tiLAogCWlmIChzdHlwZSAh
PSBJRUVFODAyMTFfU1RZUEVfREFUQSAmJgogCSAgICBzdHlwZSAhPSBJRUVFODAyMTFfU1RZUEVf
REFUQV9DRkFDSyAmJgogCSAgICBzdHlwZSAhPSBJRUVFODAyMTFfU1RZUEVfREFUQV9DRlBPTEwg
JiYKLQkgICAgc3R5cGUgIT0gSUVFRTgwMjExX1NUWVBFX0RBVEFfQ0ZBQ0tQT0xMJiYKKwkgICAg
c3R5cGUgIT0gSUVFRTgwMjExX1NUWVBFX0RBVEFfQ0ZBQ0tQT0xMICYmCiAJICAgIHN0eXBlICE9
IElFRUU4MDIxMV9TVFlQRV9RT1NfREFUQS8qIGFkZCBieSBEYXZpZCwyMDA2LjguNCAqLwogCSAg
ICApIHsKIAkJaWYgKHN0eXBlICE9IElFRUU4MDIxMV9TVFlQRV9OVUxMRlVOQykKQEAgLTExMjUs
OSArMTExMSw4IEBAIGludCBpZWVlODAyMTFfcngoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmll
ZWUsIHN0cnVjdCBza19idWZmICpza2IsCgogCS8qIHNrYjogaGRyICsgKHBvc3NpYmx5IGZyYWdt
ZW50ZWQsIHBvc3NpYmx5IGVuY3J5cHRlZCkgcGF5bG9hZCAqLwoKLQlpZiAoaWVlZS0+aG9zdF9k
ZWNyeXB0ICYmIChmYyAmIElFRUU4MDIxMV9GQ1RMX1dFUCkgJiYKLQkgICAgKGtleWlkeCA9IGll
ZWU4MDIxMV9yeF9mcmFtZV9kZWNyeXB0KGllZWUsIHNrYiwgY3J5cHQpKSA8IDApCi0JeworCWtl
eWlkeCA9IGllZWU4MDIxMV9yeF9mcmFtZV9kZWNyeXB0KGllZWUsIHNrYiwgY3J5cHQpOworCWlm
IChpZWVlLT5ob3N0X2RlY3J5cHQgJiYgKGZjICYgSUVFRTgwMjExX0ZDVExfV0VQKSAmJiBrZXlp
ZHggPCAwKSB7CiAJCXByaW50aygiZGVjcnlwdCBmcmFtZSBlcnJvclxuIik7CiAJCWdvdG8gcnhf
ZHJvcHBlZDsKIAl9CkBAIC0xMTM3LDEwICsxMTIyLDEwIEBAIGludCBpZWVlODAyMTFfcngoc3Ry
dWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIHN0cnVjdCBza19idWZmICpza2IsCgogCS8qIHNr
YjogaGRyICsgKHBvc3NpYmx5IGZyYWdtZW50ZWQpIHBsYWludGV4dCBwYXlsb2FkICovCiAJLyog
UFI6IEZJWE1FOiBob3N0YXAgaGFzIGFkZGl0aW9uYWwgY29uZGl0aW9ucyBpbiB0aGUgImlmIiBi
ZWxvdzogKi8KLQkvLyBpZWVlLT5ob3N0X2RlY3J5cHQgJiYgKGZjICYgSUVFRTgwMjExX0ZDVExf
V0VQKSAmJgogCWlmICgoZnJhZyAhPSAwIHx8IChmYyAmIElFRUU4MDIxMV9GQ1RMX01PUkVGUkFH
UykpKSB7CiAJCWludCBmbGVuOwogCQlzdHJ1Y3Qgc2tfYnVmZiAqZnJhZ19za2IgPSBpZWVlODAy
MTFfZnJhZ19jYWNoZV9nZXQoaWVlZSwgaGRyKTsKKwogCQlJRUVFODAyMTFfREVCVUdfRlJBRygi
UnggRnJhZ21lbnQgcmVjZWl2ZWQgKCV1KVxuIiwgZnJhZyk7CgogCQlpZiAoIWZyYWdfc2tiKSB7
CkBAIC0xMjAyLDggKzExODcsNyBAQCBpbnQgaWVlZTgwMjExX3J4KHN0cnVjdCBpZWVlODAyMTFf
ZGV2aWNlICppZWVlLCBzdHJ1Y3Qgc2tfYnVmZiAqc2tiLAogCSAqIGVuY3J5cHRlZC9hdXRoZW50
aWNhdGVkCiAJICovCiAJaWYgKGllZWUtPmhvc3RfZGVjcnlwdCAmJiAoZmMgJiBJRUVFODAyMTFf
RkNUTF9XRVApICYmCi0JICAgIGllZWU4MDIxMV9yeF9mcmFtZV9kZWNyeXB0X21zZHUoaWVlZSwg
c2tiLCBrZXlpZHgsIGNyeXB0KSkKLQl7CisJICAgIGllZWU4MDIxMV9yeF9mcmFtZV9kZWNyeXB0
X21zZHUoaWVlZSwgc2tiLCBrZXlpZHgsIGNyeXB0KSkgewogCQlwcmludGsoIj09PmRlY3J5cHQg
bXNkdSBlcnJvclxuIik7CiAJCWdvdG8gcnhfZHJvcHBlZDsKIAl9CkBAIC0xMjU1LDIwICsxMjM5
LDE0IEBAIGludCBpZWVlODAyMTFfcngoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIHN0
cnVjdCBza19idWZmICpza2IsCiAJCQloZHItPmFkZHIyKTsKIAkJZ290byByeF9kcm9wcGVkOwog
CX0KLS8qCi0JaWYoaWVlZTgwMjExX2lzX2VhcG9sX2ZyYW1lKGllZWUsIHNrYiwgaGRybGVuKSkg
ewotCQlwcmludGsoS0VSTl9XQVJOSU5HICJSWDogSUVFRTgwMi4xWCBFUEFPTCBmcmFtZSFcbiIp
OwotCX0KLSovCi0vKiBhZGRlZCBieSBhbXkgZm9yIHJlb3JkZXIgKi8KKworCS8qIGFkZGVkIGJ5
IGFteSBmb3IgcmVvcmRlciAqLwogCWlmIChpZWVlLT5jdXJyZW50X25ldHdvcmsucW9zX2RhdGEu
YWN0aXZlICYmIElzUW9TRGF0YUZyYW1lKHNrYi0+ZGF0YSkKLQkJJiYgIWlzX211bHRpY2FzdF9l
dGhlcl9hZGRyKGhkci0+YWRkcjEpKQotCXsKKwkJJiYgIWlzX211bHRpY2FzdF9ldGhlcl9hZGRy
KGhkci0+YWRkcjEpKSB7CiAJCVRJRCA9IEZyYW1lX1FvU1RJRChza2ItPmRhdGEpOwogCQlTZXFO
dW0gPSBXTEFOX0dFVF9TRVFfU0VRKHNjKTsKLQkJR2V0VHMoaWVlZSwoc3RydWN0IHRzX2NvbW1v
bl9pbmZvICoqKSAmcFRTLGhkci0+YWRkcjIsVElELFJYX0RJUix0cnVlKTsKLQkJaWYgKFRJRCAh
PTAgJiYgVElEICE9MykKLQkJeworCQlHZXRUcyhpZWVlLCAoc3RydWN0IHRzX2NvbW1vbl9pbmZv
ICoqKSAmcFRTLCBoZHItPmFkZHIyLCBUSUQsIFJYX0RJUiwgdHJ1ZSk7CisJCWlmIChUSUQgIT0g
MCAmJiBUSUQgIT0gMykgewogCQkJaWVlZS0+YmlzX2FueV9ub25iZXBrdHMgPSB0cnVlOwogCQl9
CiAJfQpAQCAtMTI4Miw3ICsxMjYwLDcgQEAgaW50IGllZWU4MDIxMV9yeChzdHJ1Y3QgaWVlZTgw
MjExX2RldmljZSAqaWVlZSwgc3RydWN0IHNrX2J1ZmYgKnNrYiwKIAkvKiBxb3MgZGF0YSBwYWNr
ZXRzICYgcmVzZXJ2ZWQgYml0IGlzIDEgKi8KIAlpZiAocGFyc2Vfc3ViZnJhbWUoc2tiLCByeF9z
dGF0cywgcnhiLCBzcmMsIGRzdCkgPT0gMCkgewogCQkvKiBvbmx5IHRvIGZyZWUgcnhiLCBhbmQg
bm90IHN1Ym1pdCB0aGUgcGFja2V0cyB0byB1cHBlciBsYXllciAqLwotCQlmb3IoaSA9MDsgaSA8
IHJ4Yi0+bnJfc3ViZnJhbWVzOyBpKyspIHsKKwkJZm9yIChpID0gMDsgaSA8IHJ4Yi0+bnJfc3Vi
ZnJhbWVzOyBpKyspIHsKIAkJCWRldl9rZnJlZV9za2IocnhiLT5zdWJmcmFtZXNbaV0pOwogCQl9
CiAJCWtmcmVlKHJ4Yik7CkBAIC0xMjkzLDcgKzEyNzEsNyBAQCBpbnQgaWVlZTgwMjExX3J4KHN0
cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLCBzdHJ1Y3Qgc2tfYnVmZiAqc2tiLAogLyogYWRk
ZWQgYnkgYW15IGZvciByZW9yZGVyICovCiAJaWYgKCFpZWVlLT5wSFRJbmZvLT5iQ3VyUnhSZW9y
ZGVyRW5hYmxlIHx8ICFwVFMpIHsKIC8qIGFkZGVkIGJ5IGFteSBmb3IgcmVvcmRlciAqLwotCQlm
b3IoaSA9IDA7IGk8cnhiLT5ucl9zdWJmcmFtZXM7IGkrKykgeworCQlmb3IgKGkgPSAwOyBpIDwg
cnhiLT5ucl9zdWJmcmFtZXM7IGkrKykgewogCQkJc3RydWN0IHNrX2J1ZmYgKnN1Yl9za2IgPSBy
eGItPnN1YmZyYW1lc1tpXTsKCiAJCQlpZiAoc3ViX3NrYikgewpAQCAtMTMzOCwxMCArMTMxNiw4
IEBAIGludCBpZWVlODAyMTFfcngoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIHN0cnVj
dCBza19idWZmICpza2IsCiAJCWtmcmVlKHJ4Yik7CiAJCXJ4YiA9IE5VTEw7CgotCX0KLQllbHNl
Ci0JewotCQlJRUVFODAyMTFfREVCVUcoSUVFRTgwMjExX0RMX1JFT1JERVIsIiVzKCk6IFJFT1JE
RVIgRU5BQkxFIEFORCBQVFMgbm90IE5VTEwsIGFuZCB3ZSB3aWxsIGVudGVyIFJ4UmVvcmRlcklu
ZGljYXRlUGFja2V0KClcbiIsX19mdW5jX18pOworCX0gZWxzZSB7CisJCUlFRUU4MDIxMV9ERUJV
RyhJRUVFODAyMTFfRExfUkVPUkRFUiwgIiVzKCk6IFJFT1JERVIgRU5BQkxFIEFORCBQVFMgbm90
IE5VTEwsIGFuZCB3ZSB3aWxsIGVudGVyIFJ4UmVvcmRlckluZGljYXRlUGFja2V0KClcbiIsIF9f
ZnVuY19fKTsKIAkJUnhSZW9yZGVySW5kaWNhdGVQYWNrZXQoaWVlZSwgcnhiLCBwVFMsIFNlcU51
bSk7CiAJfQogI2lmbmRlZiBKT0hOX05PQ1BZCkBAIC0xMzc0LDkgKzEzNTAsOSBAQCBFWFBPUlRf
U1lNQk9MKGllZWU4MDIxMV9yeCk7CiBzdGF0aWMgdTggcW9zX291aVtRT1NfT1VJX0xFTl0gPSB7
IDB4MDAsIDB4NTAsIDB4RjIgfTsKCiAvKgotKiBNYWtlIHRoZSBzdHJ1Y3R1cmUgd2UgcmVhZCBm
cm9tIHRoZSBiZWFjb24gcGFja2V0IHRvIGhhdmUKLSogdGhlIHJpZ2h0IHZhbHVlcwotKi8KKyAq
IE1ha2UgdGhlIHN0cnVjdHVyZSB3ZSByZWFkIGZyb20gdGhlIGJlYWNvbiBwYWNrZXQgdG8gaGF2
ZQorICogdGhlIHJpZ2h0IHZhbHVlcworICovCiBzdGF0aWMgaW50IGllZWU4MDIxMV92ZXJpZnlf
cW9zX2luZm8oc3RydWN0IGllZWU4MDIxMV9xb3NfaW5mb3JtYXRpb25fZWxlbWVudAogCQkJCSAg
ICAgKmluZm9fZWxlbWVudCwgaW50IHN1Yl90eXBlKQogewpAQCAtMTQ2OSwxMiArMTQ0NSwxMiBA
QCBzdGF0aWMgaW50IGllZWU4MDIxMV9xb3NfY29udmVydF9hY190b19wYXJhbWV0ZXJzKHN0cnVj
dAoKIAkJYWNpID0gKGFjX3BhcmFtcy0+YWNpX2FpZnNuICYgMHg2MCkgPj4gNTsKCi0JCWlmKGFj
aSA+PSBRT1NfUVVFVUVfTlVNKQorCQlpZiAoYWNpID49IFFPU19RVUVVRV9OVU0pCiAJCQljb250
aW51ZTsKIAkJcW9zX3BhcmFtLT5haWZzW2FjaV0gPSAoYWNfcGFyYW1zLT5hY2lfYWlmc24pICYg
MHgwZjsKCiAJCS8qIFdNTSBzcGVjIFAuMTE6IFRoZSBtaW5pbXVtIHZhbHVlIGZvciBBSUZTTiBz
aGFsbCBiZSAyICovCi0JCXFvc19wYXJhbS0+YWlmc1thY2ldID0gKHFvc19wYXJhbS0+YWlmc1th
Y2ldIDwgMikgPyAyOnFvc19wYXJhbS0+YWlmc1thY2ldOworCQlxb3NfcGFyYW0tPmFpZnNbYWNp
XSA9IChxb3NfcGFyYW0tPmFpZnNbYWNpXSA8IDIpID8gMiA6IHFvc19wYXJhbS0+YWlmc1thY2ld
OwoKIAkJcW9zX3BhcmFtLT5jd19taW5bYWNpXSA9CiAJCSAgICBjcHVfdG9fbGUxNihhY19wYXJh
bXMtPmVjd19taW5fbWF4ICYgMHgwRik7CkBAIC0xNTc0LDE1ICsxNTUwLDEyIEBAIHN0YXRpYyBp
bmxpbmUgdm9pZCBpZWVlODAyMTFfZXh0cmFjdF9jb3VudHJ5X2llKAogCXU4ICphZGRyMgogKQog
ewotCWlmIChJU19ET1QxMURfRU5BQkxFKGllZWUpKQotCXsKLQkJaWYgKGluZm9fZWxlbWVudC0+
bGVuIT0gMCkKLQkJeworCWlmIChJU19ET1QxMURfRU5BQkxFKGllZWUpKSB7CisJCWlmIChpbmZv
X2VsZW1lbnQtPmxlbiAhPSAwKSB7CiAJCQltZW1jcHkobmV0d29yay0+Q291bnRyeUllQnVmLCBp
bmZvX2VsZW1lbnQtPmRhdGEsIGluZm9fZWxlbWVudC0+bGVuKTsKIAkJCW5ldHdvcmstPkNvdW50
cnlJZUxlbiA9IGluZm9fZWxlbWVudC0+bGVuOwoKLQkJCWlmICghSVNfQ09VTlRSWV9JRV9WQUxJ
RChpZWVlKSkKLQkJCXsKKwkJCWlmICghSVNfQ09VTlRSWV9JRV9WQUxJRChpZWVlKSkgewogCQkJ
CWRvdDExZF91cGRhdGVfY291bnRyeV9pZShpZWVlLCBhZGRyMiwgaW5mb19lbGVtZW50LT5sZW4s
IGluZm9fZWxlbWVudC0+ZGF0YSk7CiAJCQl9CiAJCX0KQEAgLTE1OTIsOCArMTU2NSw3IEBAIHN0
YXRpYyBpbmxpbmUgdm9pZCBpZWVlODAyMTFfZXh0cmFjdF9jb3VudHJ5X2llKAogCQkgKiBzb21l
IEFQIChlLmcuIENpc2NvIDEyNDIpIGRvbid0IGluY2x1ZGUgY291bnRyeSBJRSBpbiB0aGVpcgog
CQkgKiBwcm9iZSByZXNwb25zZSBmcmFtZS4KIAkJICovCi0JCWlmIChJU19FUVVBTF9DSUVfU1JD
KGllZWUsIGFkZHIyKSApCi0JCXsKKwkJaWYgKElTX0VRVUFMX0NJRV9TUkMoaWVlZSwgYWRkcjIp
KSB7CiAJCQlVUERBVEVfQ0lFX1dBVENIRE9HKGllZWUpOwogCQl9CiAJfQpAQCAtMTYwOCw5ICsx
NTgwLDkgQEAgaW50IGllZWU4MDIxMV9wYXJzZV9pbmZvX3BhcmFtKHN0cnVjdCBpZWVlODAyMTFf
ZGV2aWNlICppZWVlLAogewogCXU4IGk7CiAJc2hvcnQgb2Zmc2V0OwotCXUxNgl0bXBfaHRjYXBf
bGVuPTA7Ci0JdTE2CXRtcF9odGluZm9fbGVuPTA7Ci0JdTE2IGh0X3JlYWx0ZWtfYWdnX2xlbj0w
OworCXUxNgl0bXBfaHRjYXBfbGVuID0gMDsKKwl1MTYJdG1wX2h0aW5mb19sZW4gPSAwOworCXUx
NiBodF9yZWFsdGVrX2FnZ19sZW4gPSAwOwogCXU4ICBodF9yZWFsdGVrX2FnZ19idWZbTUFYX0lF
X0xFTl07CiAjaWZkZWYgQ09ORklHX0lFRUU4MDIxMV9ERUJVRwogCWNoYXIgcmF0ZXNfc3RyWzY0
XTsKQEAgLTE3MjEsMTQgKzE2OTMsMTQgQEAgaW50IGllZWU4MDIxMV9wYXJzZV9pbmZvX3BhcmFt
KHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLAogCQkJYnJlYWs7CgogCQljYXNlIE1GSUVf
VFlQRV9USU06Ci0JCQlpZihpbmZvX2VsZW1lbnQtPmxlbiA8IDQpCisJCQlpZiAoaW5mb19lbGVt
ZW50LT5sZW4gPCA0KQogCQkJCWJyZWFrOwoKIAkJCW5ldHdvcmstPnRpbS50aW1fY291bnQgPSBp
bmZvX2VsZW1lbnQtPmRhdGFbMF07CiAJCQluZXR3b3JrLT50aW0udGltX3BlcmlvZCA9IGluZm9f
ZWxlbWVudC0+ZGF0YVsxXTsKCiAJCQluZXR3b3JrLT5kdGltX3BlcmlvZCA9IGluZm9fZWxlbWVu
dC0+ZGF0YVsxXTsKLQkJCWlmKGllZWUtPnN0YXRlICE9IElFRUU4MDIxMV9MSU5LRUQpCisJCQlp
ZiAoaWVlZS0+c3RhdGUgIT0gSUVFRTgwMjExX0xJTktFRCkKIAkJCQlicmVhazsKCiAJCQluZXR3
b3JrLT5sYXN0X2R0aW1fc3RhX3RpbWVbMF0gPSBzdGF0cy0+bWFjX3RpbWVbMF07CkBAIC0xNzM2
LDIyICsxNzA4LDIyIEBAIGludCBpZWVlODAyMTFfcGFyc2VfaW5mb19wYXJhbShzdHJ1Y3QgaWVl
ZTgwMjExX2RldmljZSAqaWVlZSwKCiAJCQluZXR3b3JrLT5kdGltX2RhdGEgPSBJRUVFODAyMTFf
RFRJTV9WQUxJRDsKCi0JCQlpZihpbmZvX2VsZW1lbnQtPmRhdGFbMF0gIT0gMCkKKwkJCWlmIChp
bmZvX2VsZW1lbnQtPmRhdGFbMF0gIT0gMCkKIAkJCQlicmVhazsKCi0JCQlpZihpbmZvX2VsZW1l
bnQtPmRhdGFbMl0gJiAxKQorCQkJaWYgKGluZm9fZWxlbWVudC0+ZGF0YVsyXSAmIDEpCiAJCQkJ
bmV0d29yay0+ZHRpbV9kYXRhIHw9IElFRUU4MDIxMV9EVElNX01CQ0FTVDsKCiAJCQlvZmZzZXQg
PSAoaW5mb19lbGVtZW50LT5kYXRhWzJdID4+IDEpKjI7CgotCQkJaWYoaWVlZS0+YXNzb2NfaWQg
PCA4Km9mZnNldCB8fAotCQkJCWllZWUtPmFzc29jX2lkID4gOCoob2Zmc2V0ICsgaW5mb19lbGVt
ZW50LT5sZW4gLTMpKQorCQkJaWYgKGllZWUtPmFzc29jX2lkIDwgOCpvZmZzZXQgfHwKKwkJCQlp
ZWVlLT5hc3NvY19pZCA+IDgqKG9mZnNldCArIGluZm9fZWxlbWVudC0+bGVuIC0gMykpCgogCQkJ
CWJyZWFrOwoKIAkJCW9mZnNldCA9IChpZWVlLT5hc3NvY19pZCAvIDgpIC0gb2Zmc2V0OwoKLQkJ
CWlmKGluZm9fZWxlbWVudC0+ZGF0YVszK29mZnNldF0gJiAoMTw8KGllZWUtPmFzc29jX2lkJTgp
KSkKKwkJCWlmIChpbmZvX2VsZW1lbnQtPmRhdGFbMytvZmZzZXRdICYgKDE8PChpZWVlLT5hc3Nv
Y19pZCU4KSkpCiAJCQkJbmV0d29yay0+ZHRpbV9kYXRhIHw9IElFRUU4MDIxMV9EVElNX1VDQVNU
OwoKIAkJCWJyZWFrOwpAQCAtMTc5Myw1MiArMTc2NSw1MiBAQCBpbnQgaWVlZTgwMjExX3BhcnNl
X2luZm9fcGFyYW0oc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsCgogI2lmZGVmIFRIT01B
U19UVVJCTwogCQkJaWYgKGluZm9fZWxlbWVudC0+bGVuID09IDcgJiYKLQkJCSAgICBpbmZvX2Vs
ZW1lbnQtPmRhdGFbMF0gPT0gMHgwMCAmJgotCQkJICAgIGluZm9fZWxlbWVudC0+ZGF0YVsxXSA9
PSAweGUwICYmCi0JCQkgICAgaW5mb19lbGVtZW50LT5kYXRhWzJdID09IDB4NGMgJiYKLQkJCSAg
ICBpbmZvX2VsZW1lbnQtPmRhdGFbM10gPT0gMHgwMSAmJgotCQkJICAgIGluZm9fZWxlbWVudC0+
ZGF0YVs0XSA9PSAweDAyKSB7Ci0JCQkJbmV0d29yay0+VHVyYm9fRW5hYmxlID0gMTsKKwkJCQlp
bmZvX2VsZW1lbnQtPmRhdGFbMF0gPT0gMHgwMCAmJgorCQkJCWluZm9fZWxlbWVudC0+ZGF0YVsx
XSA9PSAweGUwICYmCisJCQkJaW5mb19lbGVtZW50LT5kYXRhWzJdID09IDB4NGMgJiYKKwkJCQlp
bmZvX2VsZW1lbnQtPmRhdGFbM10gPT0gMHgwMSAmJgorCQkJCWluZm9fZWxlbWVudC0+ZGF0YVs0
XSA9PSAweDAyKSB7CisJCQkJCW5ldHdvcmstPlR1cmJvX0VuYWJsZSA9IDE7CiAJCQl9CiAjZW5k
aWYKCiAJCQkvKiBmb3IgSFRjYXAgYW5kIEhUaW5mbyBwYXJhbWV0ZXJzICovCi0JCQlpZih0bXBf
aHRjYXBfbGVuID09IDApewotCQkJCWlmKGluZm9fZWxlbWVudC0+bGVuID49IDQgJiYKLQkJCQkg
ICBpbmZvX2VsZW1lbnQtPmRhdGFbMF0gPT0gMHgwMCAmJgotCQkJCSAgIGluZm9fZWxlbWVudC0+
ZGF0YVsxXSA9PSAweDkwICYmCi0JCQkJICAgaW5mb19lbGVtZW50LT5kYXRhWzJdID09IDB4NGMg
JiYKLQkJCQkgICBpbmZvX2VsZW1lbnQtPmRhdGFbM10gPT0gMHgwMzMpewotCi0JCQkJCQl0bXBf
aHRjYXBfbGVuID0gbWluKGluZm9fZWxlbWVudC0+bGVuLCh1OClNQVhfSUVfTEVOKTsKLQkJCQkJ
CWlmKHRtcF9odGNhcF9sZW4gIT0gMCl7CisJCQlpZiAodG1wX2h0Y2FwX2xlbiA9PSAwKSB7CisJ
CQkJaWYgKGluZm9fZWxlbWVudC0+bGVuID49IDQgJiYKKwkJCQkJaW5mb19lbGVtZW50LT5kYXRh
WzBdID09IDB4MDAgJiYKKwkJCQkJaW5mb19lbGVtZW50LT5kYXRhWzFdID09IDB4OTAgJiYKKwkJ
CQkJaW5mb19lbGVtZW50LT5kYXRhWzJdID09IDB4NGMgJiYKKwkJCQkJaW5mb19lbGVtZW50LT5k
YXRhWzNdID09IDB4MDMzKSB7CisKKwkJCQkJCXRtcF9odGNhcF9sZW4gPSBtaW4oaW5mb19lbGVt
ZW50LT5sZW4sICh1OClNQVhfSUVfTEVOKTsKKwkJCQkJCWlmICh0bXBfaHRjYXBfbGVuICE9IDAp
IHsKIAkJCQkJCQluZXR3b3JrLT5ic3NodC5iZEhUU3BlY1ZlciA9IEhUX1NQRUNfVkVSX0VXQzsK
LQkJCQkJCQluZXR3b3JrLT5ic3NodC5iZEhUQ2FwTGVuID0gdG1wX2h0Y2FwX2xlbiA+IHNpemVv
ZihuZXR3b3JrLT5ic3NodC5iZEhUQ2FwQnVmKT9cCisJCQkJCQkJbmV0d29yay0+YnNzaHQuYmRI
VENhcExlbiA9IHRtcF9odGNhcF9sZW4gPiBzaXplb2YobmV0d29yay0+YnNzaHQuYmRIVENhcEJ1
ZikgPyBcCiAJCQkJCQkJCXNpemVvZihuZXR3b3JrLT5ic3NodC5iZEhUQ2FwQnVmKTp0bXBfaHRj
YXBfbGVuOwotCQkJCQkJCW1lbWNweShuZXR3b3JrLT5ic3NodC5iZEhUQ2FwQnVmLGluZm9fZWxl
bWVudC0+ZGF0YSxuZXR3b3JrLT5ic3NodC5iZEhUQ2FwTGVuKTsKKwkJCQkJCQltZW1jcHkobmV0
d29yay0+YnNzaHQuYmRIVENhcEJ1ZiwgaW5mb19lbGVtZW50LT5kYXRhLCBuZXR3b3JrLT5ic3No
dC5iZEhUQ2FwTGVuKTsKIAkJCQkJCX0KIAkJCQl9Ci0JCQkJaWYodG1wX2h0Y2FwX2xlbiAhPSAw
KQorCQkJCWlmICh0bXBfaHRjYXBfbGVuICE9IDApCiAJCQkJCW5ldHdvcmstPmJzc2h0LmJkU3Vw
cG9ydEhUID0gdHJ1ZTsKIAkJCQllbHNlCiAJCQkJCW5ldHdvcmstPmJzc2h0LmJkU3VwcG9ydEhU
ID0gZmFsc2U7CiAJCQl9CgoKLQkJCWlmKHRtcF9odGluZm9fbGVuID09IDApewotCQkJCWlmKGlu
Zm9fZWxlbWVudC0+bGVuID49IDQgJiYKKwkJCWlmICh0bXBfaHRpbmZvX2xlbiA9PSAwKSB7CisJ
CQkJaWYgKGluZm9fZWxlbWVudC0+bGVuID49IDQgJiYKIAkJCQkJaW5mb19lbGVtZW50LT5kYXRh
WzBdID09IDB4MDAgJiYKIAkJCQkJaW5mb19lbGVtZW50LT5kYXRhWzFdID09IDB4OTAgJiYKIAkJ
CQkJaW5mb19lbGVtZW50LT5kYXRhWzJdID09IDB4NGMgJiYKLQkJCQkJaW5mb19lbGVtZW50LT5k
YXRhWzNdID09IDB4MDM0KXsKKwkJCQkJaW5mb19lbGVtZW50LT5kYXRhWzNdID09IDB4MDM0KSB7
CgotCQkJCQkJdG1wX2h0aW5mb19sZW4gPSBtaW4oaW5mb19lbGVtZW50LT5sZW4sKHU4KU1BWF9J
RV9MRU4pOwotCQkJCQkJaWYodG1wX2h0aW5mb19sZW4gIT0gMCl7CisJCQkJCQl0bXBfaHRpbmZv
X2xlbiA9IG1pbihpbmZvX2VsZW1lbnQtPmxlbiwgKHU4KU1BWF9JRV9MRU4pOworCQkJCQkJaWYg
KHRtcF9odGluZm9fbGVuICE9IDApIHsKIAkJCQkJCQluZXR3b3JrLT5ic3NodC5iZEhUU3BlY1Zl
ciA9IEhUX1NQRUNfVkVSX0VXQzsKLQkJCQkJCQlpZih0bXBfaHRpbmZvX2xlbil7Ci0JCQkJCQkJ
CW5ldHdvcmstPmJzc2h0LmJkSFRJbmZvTGVuID0gdG1wX2h0aW5mb19sZW4gPiBzaXplb2YobmV0
d29yay0+YnNzaHQuYmRIVEluZm9CdWYpP1wKKwkJCQkJCQlpZiAodG1wX2h0aW5mb19sZW4pIHsK
KwkJCQkJCQkJbmV0d29yay0+YnNzaHQuYmRIVEluZm9MZW4gPSB0bXBfaHRpbmZvX2xlbiA+IHNp
emVvZihuZXR3b3JrLT5ic3NodC5iZEhUSW5mb0J1ZikgPyBcCiAJCQkJCQkJCQlzaXplb2YobmV0
d29yay0+YnNzaHQuYmRIVEluZm9CdWYpOnRtcF9odGluZm9fbGVuOwotCQkJCQkJCQltZW1jcHko
bmV0d29yay0+YnNzaHQuYmRIVEluZm9CdWYsaW5mb19lbGVtZW50LT5kYXRhLG5ldHdvcmstPmJz
c2h0LmJkSFRJbmZvTGVuKTsKKwkJCQkJCQkJbWVtY3B5KG5ldHdvcmstPmJzc2h0LmJkSFRJbmZv
QnVmLCBpbmZvX2VsZW1lbnQtPmRhdGEsIG5ldHdvcmstPmJzc2h0LmJkSFRJbmZvTGVuKTsKIAkJ
CQkJCQl9CgogCQkJCQkJfQpAQCAtMTg0NiwyOSArMTgxOCwyOSBAQCBpbnQgaWVlZTgwMjExX3Bh
cnNlX2luZm9fcGFyYW0oc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsCiAJCQkJfQogCQkJ
fQoKLQkJCWlmKGllZWUtPmFnZ3JlZ2F0aW9uKXsKLQkJCQlpZihuZXR3b3JrLT5ic3NodC5iZFN1
cHBvcnRIVCl7Ci0JCQkJCWlmKGluZm9fZWxlbWVudC0+bGVuID49IDQgJiYKKwkJCWlmIChpZWVl
LT5hZ2dyZWdhdGlvbikgeworCQkJCWlmIChuZXR3b3JrLT5ic3NodC5iZFN1cHBvcnRIVCkgewor
CQkJCQlpZiAoaW5mb19lbGVtZW50LT5sZW4gPj0gNCAmJgogCQkJCQkJaW5mb19lbGVtZW50LT5k
YXRhWzBdID09IDB4MDAgJiYKIAkJCQkJCWluZm9fZWxlbWVudC0+ZGF0YVsxXSA9PSAweGUwICYm
CiAJCQkJCQlpbmZvX2VsZW1lbnQtPmRhdGFbMl0gPT0gMHg0YyAmJgotCQkJCQkJaW5mb19lbGVt
ZW50LT5kYXRhWzNdID09IDB4MDIpeworCQkJCQkJaW5mb19lbGVtZW50LT5kYXRhWzNdID09IDB4
MDIpIHsKCi0JCQkJCQlodF9yZWFsdGVrX2FnZ19sZW4gPSBtaW4oaW5mb19lbGVtZW50LT5sZW4s
KHU4KU1BWF9JRV9MRU4pOwotCQkJCQkJbWVtY3B5KGh0X3JlYWx0ZWtfYWdnX2J1ZixpbmZvX2Vs
ZW1lbnQtPmRhdGEsaW5mb19lbGVtZW50LT5sZW4pOworCQkJCQkJaHRfcmVhbHRla19hZ2dfbGVu
ID0gbWluKGluZm9fZWxlbWVudC0+bGVuLCAodTgpTUFYX0lFX0xFTik7CisJCQkJCQltZW1jcHko
aHRfcmVhbHRla19hZ2dfYnVmLCBpbmZvX2VsZW1lbnQtPmRhdGEsIGluZm9fZWxlbWVudC0+bGVu
KTsKCiAJCQkJCX0KLQkJCQkJaWYoaHRfcmVhbHRla19hZ2dfbGVuID49IDUpeworCQkJCQlpZiAo
aHRfcmVhbHRla19hZ2dfbGVuID49IDUpIHsKIAkJCQkJCW5ldHdvcmstPmJzc2h0LmJkUlQyUlRB
Z2dyZWdhdGlvbiA9IHRydWU7CgotCQkJCQkJaWYoKGh0X3JlYWx0ZWtfYWdnX2J1Zls0XSA9PSAx
KSAmJiAoaHRfcmVhbHRla19hZ2dfYnVmWzVdICYgMHgwMikpCisJCQkJCQlpZiAoKGh0X3JlYWx0
ZWtfYWdnX2J1Zls0XSA9PSAxKSAmJiAoaHRfcmVhbHRla19hZ2dfYnVmWzVdICYgMHgwMikpCiAJ
CQkJCQluZXR3b3JrLT5ic3NodC5iZFJUMlJUTG9uZ1Nsb3RUaW1lID0gdHJ1ZTsKIAkJCQkJfQog
CQkJCX0KCiAJCQl9CgotCQkJLy9pZih0bXBfaHRjYXBfbGVuICE9MCAgfHwgIHRtcF9odGluZm9f
bGVuICE9IDApCisJCQkvL2lmICh0bXBfaHRjYXBfbGVuICE9MCAgfHwgIHRtcF9odGluZm9fbGVu
ICE9IDApCiAJCQl7CiAJCQkJaWYgKChpbmZvX2VsZW1lbnQtPmxlbiA+PSAzICYmCiAJCQkJCSBp
bmZvX2VsZW1lbnQtPmRhdGFbMF0gPT0gMHgwMCAmJgpAQCAtMTg4MSw4MCArMTg1Myw2NSBAQCBp
bnQgaWVlZTgwMjExX3BhcnNlX2luZm9fcGFyYW0oc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmll
ZWUsCiAJCQkJCSAoaW5mb19lbGVtZW50LT5sZW4gPj0gMyAmJgogCQkJCQkgaW5mb19lbGVtZW50
LT5kYXRhWzBdID09IDB4MDAgJiYKIAkJCQkJIGluZm9fZWxlbWVudC0+ZGF0YVsxXSA9PSAweDEw
ICYmCi0JCQkJCSBpbmZvX2VsZW1lbnQtPmRhdGFbMl0gPT0gMHgxOCkpeworCQkJCQkgaW5mb19l
bGVtZW50LT5kYXRhWzJdID09IDB4MTgpKSB7CgogCQkJCQkJbmV0d29yay0+YnJvYWRjb21fY2Fw
X2V4aXN0ID0gdHJ1ZTsKCiAJCQkJfQogCQkJfQotCQkJaWYoaW5mb19lbGVtZW50LT5sZW4gPj0g
MyAmJgorCQkJaWYgKGluZm9fZWxlbWVudC0+bGVuID49IDMgJiYKIAkJCQlpbmZvX2VsZW1lbnQt
PmRhdGFbMF0gPT0gMHgwMCAmJgogCQkJCWluZm9fZWxlbWVudC0+ZGF0YVsxXSA9PSAweDBjICYm
Ci0JCQkJaW5mb19lbGVtZW50LT5kYXRhWzJdID09IDB4NDMpCi0JCQl7CisJCQkJaW5mb19lbGVt
ZW50LT5kYXRhWzJdID09IDB4NDMpIHsKIAkJCQluZXR3b3JrLT5yYWxpbmtfY2FwX2V4aXN0ID0g
dHJ1ZTsKLQkJCX0KLQkJCWVsc2UKKwkJCX0gZWxzZQogCQkJCW5ldHdvcmstPnJhbGlua19jYXBf
ZXhpc3QgPSBmYWxzZTsKIAkJCS8qIGFkZGVkIGJ5IGFteSBmb3IgYXRoZXJvcyBBUCAqLwotCQkJ
aWYoKGluZm9fZWxlbWVudC0+bGVuID49IDMgJiYKKwkJCWlmICgoaW5mb19lbGVtZW50LT5sZW4g
Pj0gMyAmJgogCQkJCWluZm9fZWxlbWVudC0+ZGF0YVswXSA9PSAweDAwICYmCiAJCQkJaW5mb19l
bGVtZW50LT5kYXRhWzFdID09IDB4MDMgJiYKIAkJCQlpbmZvX2VsZW1lbnQtPmRhdGFbMl0gPT0g
MHg3ZikgfHwKIAkJCQkoaW5mb19lbGVtZW50LT5sZW4gPj0gMyAmJgogCQkJCWluZm9fZWxlbWVu
dC0+ZGF0YVswXSA9PSAweDAwICYmCiAJCQkJaW5mb19lbGVtZW50LT5kYXRhWzFdID09IDB4MTMg
JiYKLQkJCQlpbmZvX2VsZW1lbnQtPmRhdGFbMl0gPT0gMHg3NCkpCi0JCQl7Ci0JCQkJcHJpbnRr
KCI9PT09PT09PT4lcygpOiBhdGhyb3MgQVAgaXMgZXhpc3RcbiIsX19mdW5jX18pOworCQkJCWlu
Zm9fZWxlbWVudC0+ZGF0YVsyXSA9PSAweDc0KSkgeworCQkJCXByaW50aygiPT09PT09PT0+JXMo
KTogYXRocm9zIEFQIGlzIGV4aXN0XG4iLCBfX2Z1bmNfXyk7CiAJCQkJbmV0d29yay0+YXRoZXJv
c19jYXBfZXhpc3QgPSB0cnVlOwotCQkJfQotCQkJZWxzZQorCQkJfSBlbHNlCiAJCQkJbmV0d29y
ay0+YXRoZXJvc19jYXBfZXhpc3QgPSBmYWxzZTsKCi0JCQlpZihpbmZvX2VsZW1lbnQtPmxlbiA+
PSAzICYmCisJCQlpZiAoaW5mb19lbGVtZW50LT5sZW4gPj0gMyAmJgogCQkJCWluZm9fZWxlbWVu
dC0+ZGF0YVswXSA9PSAweDAwICYmCiAJCQkJaW5mb19lbGVtZW50LT5kYXRhWzFdID09IDB4NDAg
JiYKLQkJCQlpbmZvX2VsZW1lbnQtPmRhdGFbMl0gPT0gMHg5NikKLQkJCXsKKwkJCQlpbmZvX2Vs
ZW1lbnQtPmRhdGFbMl0gPT0gMHg5NikgewogCQkJCW5ldHdvcmstPmNpc2NvX2NhcF9leGlzdCA9
IHRydWU7Ci0JCQl9Ci0JCQllbHNlCisJCQl9IGVsc2UKIAkJCQluZXR3b3JrLT5jaXNjb19jYXBf
ZXhpc3QgPSBmYWxzZTsKIAkJCS8qIGFkZGVkIGJ5IGFteSBmb3IgTEVBUCBvZiBjaXNjbyAqLwog
CQkJaWYgKGluZm9fZWxlbWVudC0+bGVuID4gNCAmJgogCQkJCWluZm9fZWxlbWVudC0+ZGF0YVsw
XSA9PSAweDAwICYmCiAJCQkJaW5mb19lbGVtZW50LT5kYXRhWzFdID09IDB4NDAgJiYKIAkJCQlp
bmZvX2VsZW1lbnQtPmRhdGFbMl0gPT0gMHg5NiAmJgotCQkJCWluZm9fZWxlbWVudC0+ZGF0YVsz
XSA9PSAweDAxKQotCQkJewotCQkJCWlmKGluZm9fZWxlbWVudC0+bGVuID09IDYpCi0JCQkJewor
CQkJCWluZm9fZWxlbWVudC0+ZGF0YVszXSA9PSAweDAxKSB7CisJCQkJaWYgKGluZm9fZWxlbWVu
dC0+bGVuID09IDYpIHsKIAkJCQkJbWVtY3B5KG5ldHdvcmstPkNjeFJtU3RhdGUsICZpbmZvX2Vs
ZW1lbnRbNF0sIDIpOwotCQkJCQlpZihuZXR3b3JrLT5DY3hSbVN0YXRlWzBdICE9IDApCi0JCQkJ
CXsKKwkJCQkJaWYgKG5ldHdvcmstPkNjeFJtU3RhdGVbMF0gIT0gMCkgewogCQkJCQkJbmV0d29y
ay0+YkNjeFJtRW5hYmxlID0gdHJ1ZTsKLQkJCQkJfQotCQkJCQllbHNlCisJCQkJCX0gZWxzZQog
CQkJCQkJbmV0d29yay0+YkNjeFJtRW5hYmxlID0gZmFsc2U7CiAJCQkJCS8qCiAJCQkJCSAqIEND
WHY0IFRhYmxlIDU5LTEgTUJTU0lEIE1hc2tzLgogCQkJCQkgKi8KIAkJCQkJbmV0d29yay0+TUJz
c2lkTWFzayA9IG5ldHdvcmstPkNjeFJtU3RhdGVbMV0gJiAweDA3OwotCQkJCQlpZihuZXR3b3Jr
LT5NQnNzaWRNYXNrICE9IDApCi0JCQkJCXsKKwkJCQkJaWYgKG5ldHdvcmstPk1Cc3NpZE1hc2sg
IT0gMCkgewogCQkJCQkJbmV0d29yay0+Yk1Cc3NpZFZhbGlkID0gdHJ1ZTsKIAkJCQkJCW5ldHdv
cmstPk1Cc3NpZE1hc2sgPSAweGZmIDw8IChuZXR3b3JrLT5NQnNzaWRNYXNrKTsKIAkJCQkJCWV0
aGVyX2FkZHJfY29weShuZXR3b3JrLT5NQnNzaWQsIG5ldHdvcmstPmJzc2lkKTsKIAkJCQkJCW5l
dHdvcmstPk1Cc3NpZFs1XSAmPSBuZXR3b3JrLT5NQnNzaWRNYXNrOwotCQkJCQl9Ci0JCQkJCWVs
c2UKLQkJCQkJeworCQkJCQl9IGVsc2UgewogCQkJCQkJbmV0d29yay0+Yk1Cc3NpZFZhbGlkID0g
ZmFsc2U7CiAJCQkJCX0KLQkJCQl9Ci0JCQkJZWxzZQotCQkJCXsKKwkJCQl9IGVsc2UgewogCQkJ
CQluZXR3b3JrLT5iQ2N4Um1FbmFibGUgPSBmYWxzZTsKIAkJCQl9CiAJCQl9CkBAIC0xOTYyLDE1
ICsxOTE5LDExIEBAIGludCBpZWVlODAyMTFfcGFyc2VfaW5mb19wYXJhbShzdHJ1Y3QgaWVlZTgw
MjExX2RldmljZSAqaWVlZSwKIAkJCQlpbmZvX2VsZW1lbnQtPmRhdGFbMF0gPT0gMHgwMCAmJgog
CQkJCWluZm9fZWxlbWVudC0+ZGF0YVsxXSA9PSAweDQwICYmCiAJCQkJaW5mb19lbGVtZW50LT5k
YXRhWzJdID09IDB4OTYgJiYKLQkJCQlpbmZvX2VsZW1lbnQtPmRhdGFbM10gPT0gMHgwMykKLQkJ
CXsKLQkJCQlpZihpbmZvX2VsZW1lbnQtPmxlbiA9PSA1KQotCQkJCXsKKwkJCQlpbmZvX2VsZW1l
bnQtPmRhdGFbM10gPT0gMHgwMykgeworCQkJCWlmIChpbmZvX2VsZW1lbnQtPmxlbiA9PSA1KSB7
CiAJCQkJCW5ldHdvcmstPmJXaXRoQ2N4VmVyTnVtID0gdHJ1ZTsKIAkJCQkJbmV0d29yay0+QnNz
Q2N4VmVyTnVtYmVyID0gaW5mb19lbGVtZW50LT5kYXRhWzRdOwotCQkJCX0KLQkJCQllbHNlCi0J
CQkJeworCQkJCX0gZWxzZSB7CiAJCQkJCW5ldHdvcmstPmJXaXRoQ2N4VmVyTnVtID0gZmFsc2U7
CiAJCQkJCW5ldHdvcmstPkJzc0NjeFZlck51bWJlciA9IDA7CiAJCQkJfQpAQCAtMTk5MCwxMiAr
MTk0MywxMiBAQCBpbnQgaWVlZTgwMjExX3BhcnNlX2luZm9fcGFyYW0oc3RydWN0IGllZWU4MDIx
MV9kZXZpY2UgKmllZWUsCiAJCWNhc2UgTUZJRV9UWVBFX0hUX0NBUDoKIAkJCUlFRUU4MDIxMV9E
RUJVR19TQ0FOKCJNRklFX1RZUEVfSFRfQ0FQOiAlZCBieXRlc1xuIiwKIAkJCQkJICAgICBpbmZv
X2VsZW1lbnQtPmxlbik7Ci0JCQl0bXBfaHRjYXBfbGVuID0gbWluKGluZm9fZWxlbWVudC0+bGVu
LCh1OClNQVhfSUVfTEVOKTsKLQkJCWlmKHRtcF9odGNhcF9sZW4gIT0gMCl7CisJCQl0bXBfaHRj
YXBfbGVuID0gbWluKGluZm9fZWxlbWVudC0+bGVuLCAodTgpTUFYX0lFX0xFTik7CisJCQlpZiAo
dG1wX2h0Y2FwX2xlbiAhPSAwKSB7CiAJCQkJbmV0d29yay0+YnNzaHQuYmRIVFNwZWNWZXIgPSBI
VF9TUEVDX1ZFUl9FV0M7Ci0JCQkJbmV0d29yay0+YnNzaHQuYmRIVENhcExlbiA9IHRtcF9odGNh
cF9sZW4gPiBzaXplb2YobmV0d29yay0+YnNzaHQuYmRIVENhcEJ1Zik/XAorCQkJCW5ldHdvcmst
PmJzc2h0LmJkSFRDYXBMZW4gPSB0bXBfaHRjYXBfbGVuID4gc2l6ZW9mKG5ldHdvcmstPmJzc2h0
LmJkSFRDYXBCdWYpID8gXAogCQkJCQlzaXplb2YobmV0d29yay0+YnNzaHQuYmRIVENhcEJ1Zik6
dG1wX2h0Y2FwX2xlbjsKLQkJCQltZW1jcHkobmV0d29yay0+YnNzaHQuYmRIVENhcEJ1ZixpbmZv
X2VsZW1lbnQtPmRhdGEsbmV0d29yay0+YnNzaHQuYmRIVENhcExlbik7CisJCQkJbWVtY3B5KG5l
dHdvcmstPmJzc2h0LmJkSFRDYXBCdWYsIGluZm9fZWxlbWVudC0+ZGF0YSwgbmV0d29yay0+YnNz
aHQuYmRIVENhcExlbik7CgogCQkJCS8qCiAJCQkJICogSWYgcGVlciBpcyBIVCwgYnV0IG5vdCBX
TU0sIGNhbGwgUW9zU2V0TGVnYWN5V01NUGFyYW1XaXRoSFQoKQpAQCAtMjAwMyw4ICsxOTU2LDcg
QEAgaW50IGllZWU4MDIxMV9wYXJzZV9pbmZvX3BhcmFtKHN0cnVjdCBpZWVlODAyMTFfZGV2aWNl
ICppZWVlLAogCQkJCSAqIExpbnV4IGRyaXZlciBpcyBhIGJpdCBkaWZmZXJlbnQuCiAJCQkJICov
CiAJCQkJbmV0d29yay0+YnNzaHQuYmRTdXBwb3J0SFQgPSB0cnVlOwotCQkJfQotCQkJZWxzZQor
CQkJfSBlbHNlCiAJCQkJbmV0d29yay0+YnNzaHQuYmRTdXBwb3J0SFQgPSBmYWxzZTsKIAkJCWJy
ZWFrOwoKQEAgLTIwMTIsMjAgKzE5NjQsMTkgQEAgaW50IGllZWU4MDIxMV9wYXJzZV9pbmZvX3Bh
cmFtKHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLAogCQljYXNlIE1GSUVfVFlQRV9IVF9J
TkZPOgogCQkJSUVFRTgwMjExX0RFQlVHX1NDQU4oIk1GSUVfVFlQRV9IVF9JTkZPOiAlZCBieXRl
c1xuIiwKIAkJCQkJICAgICBpbmZvX2VsZW1lbnQtPmxlbik7Ci0JCQl0bXBfaHRpbmZvX2xlbiA9
IG1pbihpbmZvX2VsZW1lbnQtPmxlbiwodTgpTUFYX0lFX0xFTik7Ci0JCQlpZih0bXBfaHRpbmZv
X2xlbil7CisJCQl0bXBfaHRpbmZvX2xlbiA9IG1pbihpbmZvX2VsZW1lbnQtPmxlbiwgKHU4KU1B
WF9JRV9MRU4pOworCQkJaWYgKHRtcF9odGluZm9fbGVuKSB7CiAJCQkJbmV0d29yay0+YnNzaHQu
YmRIVFNwZWNWZXIgPSBIVF9TUEVDX1ZFUl9JRUVFOwotCQkJCW5ldHdvcmstPmJzc2h0LmJkSFRJ
bmZvTGVuID0gdG1wX2h0aW5mb19sZW4gPiBzaXplb2YobmV0d29yay0+YnNzaHQuYmRIVEluZm9C
dWYpP1wKKwkJCQluZXR3b3JrLT5ic3NodC5iZEhUSW5mb0xlbiA9IHRtcF9odGluZm9fbGVuID4g
c2l6ZW9mKG5ldHdvcmstPmJzc2h0LmJkSFRJbmZvQnVmKSA/IFwKIAkJCQkJc2l6ZW9mKG5ldHdv
cmstPmJzc2h0LmJkSFRJbmZvQnVmKTp0bXBfaHRpbmZvX2xlbjsKLQkJCQltZW1jcHkobmV0d29y
ay0+YnNzaHQuYmRIVEluZm9CdWYsaW5mb19lbGVtZW50LT5kYXRhLG5ldHdvcmstPmJzc2h0LmJk
SFRJbmZvTGVuKTsKKwkJCQltZW1jcHkobmV0d29yay0+YnNzaHQuYmRIVEluZm9CdWYsIGluZm9f
ZWxlbWVudC0+ZGF0YSwgbmV0d29yay0+YnNzaHQuYmRIVEluZm9MZW4pOwogCQkJfQogCQkJYnJl
YWs7CgogCQljYXNlIE1GSUVfVFlQRV9BSVJPTkVUOgogCQkJSUVFRTgwMjExX0RFQlVHX1NDQU4o
Ik1GSUVfVFlQRV9BSVJPTkVUOiAlZCBieXRlc1xuIiwKIAkJCQkJICAgICBpbmZvX2VsZW1lbnQt
Pmxlbik7Ci0JCQlpZihpbmZvX2VsZW1lbnQtPmxlbiA+SUVfQ0lTQ09fRkxBR19QT1NJVElPTikK
LQkJCXsKKwkJCWlmIChpbmZvX2VsZW1lbnQtPmxlbiA+IElFX0NJU0NPX0ZMQUdfUE9TSVRJT04p
IHsKIAkJCQluZXR3b3JrLT5iV2l0aEFpcm9uZXRJRSA9IHRydWU7CgogCQkJCS8qCkBAIC0yMDMz
LDE4ICsxOTg0LDEzIEBAIGludCBpZWVlODAyMTFfcGFyc2VfaW5mb19wYXJhbShzdHJ1Y3QgaWVl
ZTgwMjExX2RldmljZSAqaWVlZSwKIAkJCQkgKiAiQSBDaXNjbyBhY2Nlc3MgcG9pbnQgYWR2ZXJ0
aXNlcyBzdXBwb3J0IGZvciBDS0lQIGluIGJlYWNvbiBhbmQgcHJvYmUgcmVzcG9uc2UgcGFja2V0
cywKIAkJCQkgKiBieSBhZGRpbmcgYW4gQWlyb25ldCBlbGVtZW50IGFuZCBzZXR0aW5nIG9uZSBv
ciBib3RoIG9mIHRoZSBDS0lQIG5lZ290aWF0aW9uIGJpdHMuIgogCQkJCSAqLwotCQkJCWlmKAko
aW5mb19lbGVtZW50LT5kYXRhW0lFX0NJU0NPX0ZMQUdfUE9TSVRJT05dJlNVUFBPUlRfQ0tJUF9N
SUMpCXx8Ci0JCQkJCShpbmZvX2VsZW1lbnQtPmRhdGFbSUVfQ0lTQ09fRkxBR19QT1NJVElPTl0m
U1VQUE9SVF9DS0lQX1BLKQkpCi0JCQkJeworCQkJCWlmICgoaW5mb19lbGVtZW50LT5kYXRhW0lF
X0NJU0NPX0ZMQUdfUE9TSVRJT05dJlNVUFBPUlRfQ0tJUF9NSUMpIHx8CisJCQkJCShpbmZvX2Vs
ZW1lbnQtPmRhdGFbSUVfQ0lTQ09fRkxBR19QT1NJVElPTl0mU1VQUE9SVF9DS0lQX1BLKSkgewog
CQkJCQluZXR3b3JrLT5iQ2tpcFN1cHBvcnRlZCA9IHRydWU7Ci0JCQkJfQotCQkJCWVsc2UKLQkJ
CQl7CisJCQkJfSBlbHNlIHsKIAkJCQkJbmV0d29yay0+YkNraXBTdXBwb3J0ZWQgPSBmYWxzZTsK
IAkJCQl9Ci0JCQl9Ci0JCQllbHNlCi0JCQl7CisJCQl9IGVsc2UgewogCQkJCW5ldHdvcmstPmJX
aXRoQWlyb25ldElFID0gZmFsc2U7CiAJCQkJbmV0d29yay0+YkNraXBTdXBwb3J0ZWQgPSBmYWxz
ZTsKIAkJCX0KQEAgLTIwNjksNjggKzIwMTUsNDIgQEAgaW50IGllZWU4MDIxMV9wYXJzZV9pbmZv
X3BhcmFtKHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLAogCQl9CgogCQlsZW5ndGggLT0g
c2l6ZW9mKCppbmZvX2VsZW1lbnQpICsgaW5mb19lbGVtZW50LT5sZW47Ci0JCWluZm9fZWxlbWVu
dCA9Ci0JCSAgICAoc3RydWN0IGllZWU4MDIxMV9pbmZvX2VsZW1lbnQgKikmaW5mb19lbGVtZW50
LT4KLQkJICAgIGRhdGFbaW5mb19lbGVtZW50LT5sZW5dOworCQlpbmZvX2VsZW1lbnQgPSAoc3Ry
dWN0IGllZWU4MDIxMV9pbmZvX2VsZW1lbnQgKikmaW5mb19lbGVtZW50LT5kYXRhW2luZm9fZWxl
bWVudC0+bGVuXTsKIAl9CgotCWlmKCFuZXR3b3JrLT5hdGhlcm9zX2NhcF9leGlzdCAmJiAhbmV0
d29yay0+YnJvYWRjb21fY2FwX2V4aXN0ICYmCi0JCSFuZXR3b3JrLT5jaXNjb19jYXBfZXhpc3Qg
JiYgIW5ldHdvcmstPnJhbGlua19jYXBfZXhpc3QgJiYgIW5ldHdvcmstPmJzc2h0LmJkUlQyUlRB
Z2dyZWdhdGlvbikKLQl7CisJaWYgKCFuZXR3b3JrLT5hdGhlcm9zX2NhcF9leGlzdCAmJiAhbmV0
d29yay0+YnJvYWRjb21fY2FwX2V4aXN0ICYmCisJCSFuZXR3b3JrLT5jaXNjb19jYXBfZXhpc3Qg
JiYgIW5ldHdvcmstPnJhbGlua19jYXBfZXhpc3QgJiYgIW5ldHdvcmstPmJzc2h0LmJkUlQyUlRB
Z2dyZWdhdGlvbikgewogCQluZXR3b3JrLT51bmtub3duX2NhcF9leGlzdCA9IHRydWU7Ci0JfQot
CWVsc2UKLQl7CisJfSBlbHNlIHsKIAkJbmV0d29yay0+dW5rbm93bl9jYXBfZXhpc3QgPSBmYWxz
ZTsKIAl9CiAJcmV0dXJuIDA7CiB9Cgotc3RhdGljIGlubGluZSB1OCBpZWVlODAyMTFfU2lnbmFs
U3RyZW5ndGhUcmFuc2xhdGUoCi0JdTggIEN1cnJTUwotCSkKK3N0YXRpYyBpbmxpbmUgdTggaWVl
ZTgwMjExX1NpZ25hbFN0cmVuZ3RoVHJhbnNsYXRlKHU4IEN1cnJTUykKIHsKIAl1OCBSZXRTUzsK
CiAJLyogU3RlcCAxLiBTY2FsZSBtYXBwaW5nLiAqLwotCWlmKEN1cnJTUyA+PSA3MSAmJiBDdXJy
U1MgPD0gMTAwKQotCXsKKwlpZiAoQ3VyclNTID49IDcxICYmIEN1cnJTUyA8PSAxMDApIHsKIAkJ
UmV0U1MgPSA5MCArICgoQ3VyclNTIC0gNzApIC8gMyk7Ci0JfQotCWVsc2UgaWYoQ3VyclNTID49
IDQxICYmIEN1cnJTUyA8PSA3MCkKLQl7CisJfSBlbHNlIGlmIChDdXJyU1MgPj0gNDEgJiYgQ3Vy
clNTIDw9IDcwKSB7CiAJCVJldFNTID0gNzggKyAoKEN1cnJTUyAtIDQwKSAvIDMpOwotCX0KLQll
bHNlIGlmKEN1cnJTUyA+PSAzMSAmJiBDdXJyU1MgPD0gNDApCi0JeworCX0gZWxzZSBpZiAoQ3Vy
clNTID49IDMxICYmIEN1cnJTUyA8PSA0MCkgewogCQlSZXRTUyA9IDY2ICsgKEN1cnJTUyAtIDMw
KTsKLQl9Ci0JZWxzZSBpZihDdXJyU1MgPj0gMjEgJiYgQ3VyclNTIDw9IDMwKQotCXsKKwl9IGVs
c2UgaWYgKEN1cnJTUyA+PSAyMSAmJiBDdXJyU1MgPD0gMzApIHsKIAkJUmV0U1MgPSA1NCArIChD
dXJyU1MgLSAyMCk7Ci0JfQotCWVsc2UgaWYoQ3VyclNTID49IDUgJiYgQ3VyclNTIDw9IDIwKQot
CXsKKwl9IGVsc2UgaWYgKEN1cnJTUyA+PSA1ICYmIEN1cnJTUyA8PSAyMCkgewogCQlSZXRTUyA9
IDQyICsgKCgoQ3VyclNTIC0gNSkgKiAyKSAvIDMpOwotCX0KLQllbHNlIGlmKEN1cnJTUyA9PSA0
KQotCXsKKwl9IGVsc2UgaWYgKEN1cnJTUyA9PSA0KSB7CiAJCVJldFNTID0gMzY7Ci0JfQotCWVs
c2UgaWYoQ3VyclNTID09IDMpCi0JeworCX0gZWxzZSBpZiAoQ3VyclNTID09IDMpIHsKIAkJUmV0
U1MgPSAyNzsKLQl9Ci0JZWxzZSBpZihDdXJyU1MgPT0gMikKLQl7CisJfSBlbHNlIGlmIChDdXJy
U1MgPT0gMikgewogCQlSZXRTUyA9IDE4OwotCX0KLQllbHNlIGlmKEN1cnJTUyA9PSAxKQotCXsK
Kwl9IGVsc2UgaWYgKEN1cnJTUyA9PSAxKSB7CiAJCVJldFNTID0gOTsKLQl9Ci0JZWxzZQotCXsK
Kwl9IGVsc2UgewogCQlSZXRTUyA9IEN1cnJTUzsKIAl9CgpAQCAtMjE0Miw3ICsyMDYyLDcgQEAg
c3RhdGljIGlubGluZSB1OCBpZWVlODAyMTFfU2lnbmFsU3RyZW5ndGhUcmFuc2xhdGUoCiAvKiAw
LTEwMCBpbmRleCAqLwogc3RhdGljIGxvbmcgaWVlZTgwMjExX3RyYW5zbGF0ZV90b2RibSh1OCBz
aWduYWxfc3RyZW5ndGhfaW5kZXgpCiB7Ci0JbG9uZwlzaWduYWxfcG93ZXI7IC8qIGluIGRCbS4g
Ki8KKwlsb25nIHNpZ25hbF9wb3dlcjsgLyogaW4gZEJtLiAqLwoKIAkvKiBUcmFuc2xhdGUgdG8g
ZEJtICh4PTAuNXktOTUpLiAqLwogCXNpZ25hbF9wb3dlciA9IChsb25nKSgoc2lnbmFsX3N0cmVu
Z3RoX2luZGV4ICsgMSkgPj4gMSk7CkBAIC0yMjAyLDcgKzIxMjIsNyBAQCBzdGF0aWMgaW5saW5l
IGludCBpZWVlODAyMTFfbmV0d29ya19pbml0KAogCW5ldHdvcmstPnJzbl9pZV9sZW4gPSAwOwoK
IAlpZiAoaWVlZTgwMjExX3BhcnNlX2luZm9fcGFyYW0KLQkgICAgKGllZWUsYmVhY29uLT5pbmZv
X2VsZW1lbnQsIHN0YXRzLT5sZW4gLSBzaXplb2YoKmJlYWNvbiksIG5ldHdvcmssIHN0YXRzKSkK
KwkgICAgKGllZWUsIGJlYWNvbi0+aW5mb19lbGVtZW50LCBzdGF0cy0+bGVuIC0gc2l6ZW9mKCpi
ZWFjb24pLCBuZXR3b3JrLCBzdGF0cykpCiAJCXJldHVybiAxOwoKIAluZXR3b3JrLT5tb2RlID0g
MDsKQEAgLTIyMjQsMTcgKzIxNDQsMTcgQEAgc3RhdGljIGlubGluZSBpbnQgaWVlZTgwMjExX25l
dHdvcmtfaW5pdCgKIAkJcmV0dXJuIDE7CiAJfQoKLQlpZihuZXR3b3JrLT5ic3NodC5iZFN1cHBv
cnRIVCl7Ci0JCWlmKG5ldHdvcmstPm1vZGUgPT0gSUVFRV9BKQorCWlmIChuZXR3b3JrLT5ic3No
dC5iZFN1cHBvcnRIVCkgeworCQlpZiAobmV0d29yay0+bW9kZSA9PSBJRUVFX0EpCiAJCQluZXR3
b3JrLT5tb2RlID0gSUVFRV9OXzVHOwotCQllbHNlIGlmKG5ldHdvcmstPm1vZGUgJiAoSUVFRV9H
IHwgSUVFRV9CKSkKKwkJZWxzZSBpZiAobmV0d29yay0+bW9kZSAmIChJRUVFX0cgfCBJRUVFX0Ip
KQogCQkJbmV0d29yay0+bW9kZSA9IElFRUVfTl8yNEc7CiAJfQogCWlmIChpZWVlODAyMTFfaXNf
ZW1wdHlfZXNzaWQobmV0d29yay0+c3NpZCwgbmV0d29yay0+c3NpZF9sZW4pKQogCQluZXR3b3Jr
LT5mbGFncyB8PSBORVRXT1JLX0VNUFRZX0VTU0lEOwoKIAlzdGF0cy0+c2lnbmFsID0gMzAgKyAo
c3RhdHMtPlNpZ25hbFN0cmVuZ3RoICogNzApIC8gMTAwOwotCXN0YXRzLT5ub2lzZSA9IGllZWU4
MDIxMV90cmFuc2xhdGVfdG9kYm0oKHU4KSgxMDAtc3RhdHMtPnNpZ25hbCkpIC0yNTsKKwlzdGF0
cy0+bm9pc2UgPSBpZWVlODAyMTFfdHJhbnNsYXRlX3RvZGJtKCh1OCkoMTAwLXN0YXRzLT5zaWdu
YWwpKSAtIDI1OwoKIAltZW1jcHkoJm5ldHdvcmstPnN0YXRzLCBzdGF0cywgc2l6ZW9mKG5ldHdv
cmstPnN0YXRzKSk7CgpAQCAtMjI0MiwxOSArMjE2MiwxNyBAQCBzdGF0aWMgaW5saW5lIGludCBp
ZWVlODAyMTFfbmV0d29ya19pbml0KAogfQoKIHN0YXRpYyBpbmxpbmUgaW50IGlzX3NhbWVfbmV0
d29yayhzdHJ1Y3QgaWVlZTgwMjExX25ldHdvcmsgKnNyYywKLQkJCQkgIHN0cnVjdCBpZWVlODAy
MTFfbmV0d29yayAqZHN0LCBzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSkKLXsKKwkJCQkg
IHN0cnVjdCBpZWVlODAyMTFfbmV0d29yayAqZHN0LCBzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAq
aWVlZSkgewogCS8qCiAJICogQSBuZXR3b3JrIGlzIG9ubHkgYSBkdXBsaWNhdGUgaWYgdGhlIGNo
YW5uZWwsIEJTU0lELCBFU1NJRAogCSAqIGFuZCB0aGUgY2FwYWJpbGl0eSBmaWVsZCAoaW4gcGFy
dGljdWxhciBJQlNTIGFuZCBCU1MpIGFsbCBtYXRjaC4KIAkgKiBXZSB0cmVhdCBhbGwgPGhpZGRl
bj4gd2l0aCB0aGUgc2FtZSBCU1NJRCBhbmQgY2hhbm5lbAogCSAqIGFzIG9uZSBuZXR3b3JrCiAJ
ICovCi0JcmV0dXJuIC8vKChzcmMtPnNzaWRfbGVuID09IGRzdC0+c3NpZF9sZW4pICYmCisJcmV0
dXJuCiAJCSgoKHNyYy0+c3NpZF9sZW4gPT0gZHN0LT5zc2lkX2xlbikgfHwgKGllZWUtPml3X21v
ZGUgPT0gSVdfTU9ERV9JTkZSQSkpICYmCiAJCShzcmMtPmNoYW5uZWwgPT0gZHN0LT5jaGFubmVs
KSAmJgogCQkhbWVtY21wKHNyYy0+YnNzaWQsIGRzdC0+YnNzaWQsIEVUSF9BTEVOKSAmJgotCQkv
LyFtZW1jbXAoc3JjLT5zc2lkLCBkc3QtPnNzaWQsIHNyYy0+c3NpZF9sZW4pICYmCiAJCSghbWVt
Y21wKHNyYy0+c3NpZCwgZHN0LT5zc2lkLCBzcmMtPnNzaWRfbGVuKSB8fCAoaWVlZS0+aXdfbW9k
ZSA9PSBJV19NT0RFX0lORlJBKSkgJiYKIAkJKChzcmMtPmNhcGFiaWxpdHkgJiBXTEFOX0NBUEFC
SUxJVFlfSUJTUykgPT0KIAkJKGRzdC0+Y2FwYWJpbGl0eSAmIFdMQU5fQ0FQQUJJTElUWV9JQlNT
KSkgJiYKQEAgLTIyNjMsOCArMjE4MSw3IEBAIHN0YXRpYyBpbmxpbmUgaW50IGlzX3NhbWVfbmV0
d29yayhzdHJ1Y3QgaWVlZTgwMjExX25ldHdvcmsgKnNyYywKIH0KCiBzdGF0aWMgaW5saW5lIHZv
aWQgdXBkYXRlX25ldHdvcmsoc3RydWN0IGllZWU4MDIxMV9uZXR3b3JrICpkc3QsCi0JCQkJICBz
dHJ1Y3QgaWVlZTgwMjExX25ldHdvcmsgKnNyYykKLXsKKwkJCQkgIHN0cnVjdCBpZWVlODAyMTFf
bmV0d29yayAqc3JjKSB7CiAJaW50IHFvc19hY3RpdmU7CiAJdTggb2xkX3BhcmFtOwoKQEAgLTIy
NzQsOCArMjE5MSw3IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCB1cGRhdGVfbmV0d29yayhzdHJ1Y3Qg
aWVlZTgwMjExX25ldHdvcmsgKmRzdCwKIAlkc3QtPnJhdGVzX2xlbiA9IHNyYy0+cmF0ZXNfbGVu
OwogCW1lbWNweShkc3QtPnJhdGVzX2V4LCBzcmMtPnJhdGVzX2V4LCBzcmMtPnJhdGVzX2V4X2xl
bik7CiAJZHN0LT5yYXRlc19leF9sZW4gPSBzcmMtPnJhdGVzX2V4X2xlbjsKLQlpZiAoc3JjLT5z
c2lkX2xlbiA+IDApCi0JeworCWlmIChzcmMtPnNzaWRfbGVuID4gMCkgewogCQltZW1zZXQoZHN0
LT5zc2lkLCAwLCBkc3QtPnNzaWRfbGVuKTsKIAkJZHN0LT5zc2lkX2xlbiA9IHNyYy0+c3NpZF9s
ZW47CiAJCW1lbWNweShkc3QtPnNzaWQsIHNyYy0+c3NpZCwgc3JjLT5zc2lkX2xlbik7CkBAIC0y
Mjg0LDggKzIyMDAsNyBAQCBzdGF0aWMgaW5saW5lIHZvaWQgdXBkYXRlX25ldHdvcmsoc3RydWN0
IGllZWU4MDIxMV9uZXR3b3JrICpkc3QsCiAJZHN0LT5mbGFncyA9IHNyYy0+ZmxhZ3M7CiAJZHN0
LT50aW1lX3N0YW1wWzBdID0gc3JjLT50aW1lX3N0YW1wWzBdOwogCWRzdC0+dGltZV9zdGFtcFsx
XSA9IHNyYy0+dGltZV9zdGFtcFsxXTsKLQlpZiAoc3JjLT5mbGFncyAmIE5FVFdPUktfSEFTX0VS
UF9WQUxVRSkKLQl7CisJaWYgKHNyYy0+ZmxhZ3MgJiBORVRXT1JLX0hBU19FUlBfVkFMVUUpIHsK
IAkJZHN0LT5lcnBfdmFsdWUgPSBzcmMtPmVycF92YWx1ZTsKIAkJZHN0LT5iZXJwX2luZm9fdmFs
aWQgPSBzcmMtPmJlcnBfaW5mb192YWxpZCA9IHRydWU7CiAJfQpAQCAtMjMwMCwxMCArMjIxNSwx
MCBAQCBzdGF0aWMgaW5saW5lIHZvaWQgdXBkYXRlX25ldHdvcmsoc3RydWN0IGllZWU4MDIxMV9u
ZXR3b3JrICpkc3QsCgogCWRzdC0+YnNzaHQuYmRTdXBwb3J0SFQgPSBzcmMtPmJzc2h0LmJkU3Vw
cG9ydEhUOwogCWRzdC0+YnNzaHQuYmRSVDJSVEFnZ3JlZ2F0aW9uID0gc3JjLT5ic3NodC5iZFJU
MlJUQWdncmVnYXRpb247Ci0JZHN0LT5ic3NodC5iZEhUQ2FwTGVuPSBzcmMtPmJzc2h0LmJkSFRD
YXBMZW47Ci0JbWVtY3B5KGRzdC0+YnNzaHQuYmRIVENhcEJ1ZixzcmMtPmJzc2h0LmJkSFRDYXBC
dWYsc3JjLT5ic3NodC5iZEhUQ2FwTGVuKTsKLQlkc3QtPmJzc2h0LmJkSFRJbmZvTGVuPSBzcmMt
PmJzc2h0LmJkSFRJbmZvTGVuOwotCW1lbWNweShkc3QtPmJzc2h0LmJkSFRJbmZvQnVmLHNyYy0+
YnNzaHQuYmRIVEluZm9CdWYsc3JjLT5ic3NodC5iZEhUSW5mb0xlbik7CisJZHN0LT5ic3NodC5i
ZEhUQ2FwTGVuID0gc3JjLT5ic3NodC5iZEhUQ2FwTGVuOworCW1lbWNweShkc3QtPmJzc2h0LmJk
SFRDYXBCdWYsIHNyYy0+YnNzaHQuYmRIVENhcEJ1Ziwgc3JjLT5ic3NodC5iZEhUQ2FwTGVuKTsK
Kwlkc3QtPmJzc2h0LmJkSFRJbmZvTGVuID0gc3JjLT5ic3NodC5iZEhUSW5mb0xlbjsKKwltZW1j
cHkoZHN0LT5ic3NodC5iZEhUSW5mb0J1Ziwgc3JjLT5ic3NodC5iZEhUSW5mb0J1Ziwgc3JjLT5i
c3NodC5iZEhUSW5mb0xlbik7CiAJZHN0LT5ic3NodC5iZEhUU3BlY1ZlciA9IHNyYy0+YnNzaHQu
YmRIVFNwZWNWZXI7CiAJZHN0LT5ic3NodC5iZFJUMlJUTG9uZ1Nsb3RUaW1lID0gc3JjLT5ic3No
dC5iZFJUMlJUTG9uZ1Nsb3RUaW1lOwogCWRzdC0+YnJvYWRjb21fY2FwX2V4aXN0ID0gc3JjLT5i
cm9hZGNvbV9jYXBfZXhpc3Q7CkBAIC0yMzIwLDcgKzIyMzUsNyBAQCBzdGF0aWMgaW5saW5lIHZv
aWQgdXBkYXRlX25ldHdvcmsoc3RydWN0IGllZWU4MDIxMV9uZXR3b3JrICpkc3QsCiAJLyogcW9z
IHJlbGF0ZWQgcGFyYW1ldGVycyAqLwogCXFvc19hY3RpdmUgPSBkc3QtPnFvc19kYXRhLmFjdGl2
ZTsKIAlvbGRfcGFyYW0gPSBkc3QtPnFvc19kYXRhLnBhcmFtX2NvdW50OwotCWlmKGRzdC0+Zmxh
Z3MgJiBORVRXT1JLX0hBU19RT1NfTUFTSykKKwlpZiAoZHN0LT5mbGFncyAmIE5FVFdPUktfSEFT
X1FPU19NQVNLKQogCQltZW1jcHkoJmRzdC0+cW9zX2RhdGEsICZzcmMtPnFvc19kYXRhLAogCQkJ
c2l6ZW9mKHN0cnVjdCBpZWVlODAyMTFfcW9zX2RhdGEpKTsKIAllbHNlIHsKQEAgLTIzMzAsNyAr
MjI0NSw3IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCB1cGRhdGVfbmV0d29yayhzdHJ1Y3QgaWVlZTgw
MjExX25ldHdvcmsgKmRzdCwKCiAJaWYgKGRzdC0+cW9zX2RhdGEuc3VwcG9ydGVkID09IDEpIHsK
IAkJZHN0LT5Rb1NfRW5hYmxlID0gMTsKLQkJaWYoZHN0LT5zc2lkX2xlbikKKwkJaWYgKGRzdC0+
c3NpZF9sZW4pCiAJCQlJRUVFODAyMTFfREVCVUdfUU9TCiAJCQkJKCJRb1MgdGhlIG5ldHdvcmsg
JXMgaXMgUW9TIHN1cHBvcnRlZFxuIiwKIAkJCQlkc3QtPnNzaWQpOwpAQCAtMjM0MywxMSArMjI1
OCwxMSBAQCBzdGF0aWMgaW5saW5lIHZvaWQgdXBkYXRlX25ldHdvcmsoc3RydWN0IGllZWU4MDIx
MV9uZXR3b3JrICpkc3QsCgogCS8qIGRzdC0+bGFzdF9hc3NvY2lhdGUgaXMgbm90IG92ZXJ3cml0
dGVuICovCiAJZHN0LT53bW1faW5mbyA9IHNyYy0+d21tX2luZm87IC8qIHN1cmUgdG8gZXhpc3Qg
aW4gYmVhY29uIG9yIHByb2JlIHJlc3BvbnNlIGZyYW1lLiAqLwotCWlmIChzcmMtPndtbV9wYXJh
bVswXS5hY2lfYWlmc258fCBcCi0JICAgc3JjLT53bW1fcGFyYW1bMV0uYWNpX2FpZnNufHwgXAot
CSAgIHNyYy0+d21tX3BhcmFtWzJdLmFjaV9haWZzbnx8IFwKKwlpZiAoc3JjLT53bW1fcGFyYW1b
MF0uYWNpX2FpZnNuIHx8IFwKKwkgICBzcmMtPndtbV9wYXJhbVsxXS5hY2lfYWlmc24gfHwgXAor
CSAgIHNyYy0+d21tX3BhcmFtWzJdLmFjaV9haWZzbiB8fCBcCiAJICAgc3JjLT53bW1fcGFyYW1b
M10uYWNpX2FpZnNuKSB7Ci0JICBtZW1jcHkoZHN0LT53bW1fcGFyYW0sIHNyYy0+d21tX3BhcmFt
LCBXTUVfQUNfUFJBTV9MRU4pOworCQltZW1jcHkoZHN0LT53bW1fcGFyYW0sIHNyYy0+d21tX3Bh
cmFtLCBXTUVfQUNfUFJBTV9MRU4pOwogCX0KICNpZmRlZiBUSE9NQVNfVFVSQk8KIAlkc3QtPlR1
cmJvX0VuYWJsZSA9IHNyYy0+VHVyYm9fRW5hYmxlOwpAQCAtMjQzNyw0NiArMjM1MiwzNiBAQCBz
dGF0aWMgaW5saW5lIHZvaWQgaWVlZTgwMjExX3Byb2Nlc3NfcHJvYmVfcmVzcG9uc2UoCgogCWlm
ICghaXNfbGVnYWxfY2hhbm5lbChpZWVlLCBuZXR3b3JrLT5jaGFubmVsKSkKIAkJZ290byBvdXQ7
Ci0JaWYgKGllZWUtPmJHbG9iYWxEb21haW4pCi0JewotCQlpZiAoZmMgPT0gSUVFRTgwMjExX1NU
WVBFX1BST0JFX1JFU1ApCi0JCXsKKwlpZiAoaWVlZS0+Ykdsb2JhbERvbWFpbikgeworCQlpZiAo
ZmMgPT0gSUVFRTgwMjExX1NUWVBFX1BST0JFX1JFU1ApIHsKIAkJCS8qIENhc2UgMTogQ291bnRy
eSBjb2RlICovCi0JCQlpZihJU19DT1VOVFJZX0lFX1ZBTElEKGllZWUpICkKLQkJCXsKKwkJCWlm
IChJU19DT1VOVFJZX0lFX1ZBTElEKGllZWUpKSB7CiAJCQkJaWYgKCFpc19sZWdhbF9jaGFubmVs
KGllZWUsIG5ldHdvcmstPmNoYW5uZWwpKSB7CiAJCQkJCXByaW50aygiR2V0U2NhbkluZm8oKTog
Rm9yIENvdW50cnkgY29kZSwgZmlsdGVyIHByb2JlIHJlc3BvbnNlIGF0IGNoYW5uZWwoJWQpLlxu
IiwgbmV0d29yay0+Y2hhbm5lbCk7CiAJCQkJCWdvdG8gb3V0OwogCQkJCX0KIAkJCX0KIAkJCS8q
IENhc2UgMjogTm8gYW55IGNvdW50cnkgY29kZS4gKi8KLQkJCWVsc2UKLQkJCXsKKwkJCWVsc2Ug
ewogCQkJCS8qIEZpbHRlciBvdmVyIGNoYW5uZWwgY2gxMn4xNCAqLwotCQkJCWlmIChuZXR3b3Jr
LT5jaGFubmVsID4gMTEpCi0JCQkJeworCQkJCWlmIChuZXR3b3JrLT5jaGFubmVsID4gMTEpIHsK
IAkJCQkJcHJpbnRrKCJHZXRTY2FuSW5mbygpOiBGb3IgR2xvYmFsIERvbWFpbiwgZmlsdGVyIHBy
b2JlIHJlc3BvbnNlIGF0IGNoYW5uZWwoJWQpLlxuIiwgbmV0d29yay0+Y2hhbm5lbCk7CiAJCQkJ
CWdvdG8gb3V0OwogCQkJCX0KIAkJCX0KLQkJfQotCQllbHNlCi0JCXsKKwkJfSBlbHNlIHsKIAkJ
CS8qIENhc2UgMTogQ291bnRyeSBjb2RlICovCi0JCQlpZihJU19DT1VOVFJZX0lFX1ZBTElEKGll
ZWUpICkKLQkJCXsKKwkJCWlmIChJU19DT1VOVFJZX0lFX1ZBTElEKGllZWUpKSB7CiAJCQkJaWYg
KCFpc19sZWdhbF9jaGFubmVsKGllZWUsIG5ldHdvcmstPmNoYW5uZWwpKSB7Ci0JCQkJCXByaW50
aygiR2V0U2NhbkluZm8oKTogRm9yIENvdW50cnkgY29kZSwgZmlsdGVyIGJlYWNvbiBhdCBjaGFu
bmVsKCVkKS5cbiIsbmV0d29yay0+Y2hhbm5lbCk7CisJCQkJCXByaW50aygiR2V0U2NhbkluZm8o
KTogRm9yIENvdW50cnkgY29kZSwgZmlsdGVyIGJlYWNvbiBhdCBjaGFubmVsKCVkKS5cbiIsIG5l
dHdvcmstPmNoYW5uZWwpOwogCQkJCQlnb3RvIG91dDsKIAkJCQl9CiAJCQl9CiAJCQkvKiBDYXNl
IDI6IE5vIGFueSBjb3VudHJ5IGNvZGUuICovCi0JCQllbHNlCi0JCQl7CisJCQllbHNlIHsKIAkJ
CQkvKiBGaWx0ZXIgb3ZlciBjaGFubmVsIGNoMTJ+MTQgKi8KLQkJCQlpZiAobmV0d29yay0+Y2hh
bm5lbCA+IDE0KQotCQkJCXsKLQkJCQkJcHJpbnRrKCJHZXRTY2FuSW5mbygpOiBGb3IgR2xvYmFs
IERvbWFpbiwgZmlsdGVyIGJlYWNvbiBhdCBjaGFubmVsKCVkKS5cbiIsbmV0d29yay0+Y2hhbm5l
bCk7CisJCQkJaWYgKG5ldHdvcmstPmNoYW5uZWwgPiAxNCkgeworCQkJCQlwcmludGsoIkdldFNj
YW5JbmZvKCk6IEZvciBHbG9iYWwgRG9tYWluLCBmaWx0ZXIgYmVhY29uIGF0IGNoYW5uZWwoJWQp
LlxuIiwgbmV0d29yay0+Y2hhbm5lbCk7CiAJCQkJCWdvdG8gb3V0OwogCQkJCX0KIAkJCX0KQEAg
LTI1MDIsMTUgKzI0MDcsMTQgQEAgc3RhdGljIGlubGluZSB2b2lkIGllZWU4MDIxMV9wcm9jZXNz
X3Byb2JlX3Jlc3BvbnNlKAogCWlmIChpc19zYW1lX25ldHdvcmsoJmllZWUtPmN1cnJlbnRfbmV0
d29yaywgbmV0d29yaywgaWVlZSkpIHsKIAkJdXBkYXRlX25ldHdvcmsoJmllZWUtPmN1cnJlbnRf
bmV0d29yaywgbmV0d29yayk7CiAJCWlmICgoaWVlZS0+Y3VycmVudF9uZXR3b3JrLm1vZGUgPT0g
SUVFRV9OXzI0RyB8fCBpZWVlLT5jdXJyZW50X25ldHdvcmsubW9kZSA9PSBJRUVFX0cpCi0JCSYm
IGllZWUtPmN1cnJlbnRfbmV0d29yay5iZXJwX2luZm9fdmFsaWQpewotCQlpZihpZWVlLT5jdXJy
ZW50X25ldHdvcmsuZXJwX3ZhbHVlJiBFUlBfVXNlUHJvdGVjdGlvbikKLQkJCWllZWUtPmN1cnJl
bnRfbmV0d29yay5idXNlcHJvdGVjdGlvbiA9IHRydWU7Ci0JCWVsc2UKLQkJCWllZWUtPmN1cnJl
bnRfbmV0d29yay5idXNlcHJvdGVjdGlvbiA9IGZhbHNlOwotCQl9Ci0JCWlmKGlzX2JlYWNvbihi
ZWFjb24tPmhlYWRlci5mcmFtZV9jdGwpKQotCQl7Ci0JCQlpZihpZWVlLT5zdGF0ZSA9PSBJRUVF
ODAyMTFfTElOS0VEKQorCQkmJiBpZWVlLT5jdXJyZW50X25ldHdvcmsuYmVycF9pbmZvX3ZhbGlk
KSB7CisJCQlpZiAoaWVlZS0+Y3VycmVudF9uZXR3b3JrLmVycF92YWx1ZSAmIEVSUF9Vc2VQcm90
ZWN0aW9uKQorCQkJCWllZWUtPmN1cnJlbnRfbmV0d29yay5idXNlcHJvdGVjdGlvbiA9IHRydWU7
CisJCQllbHNlCisJCQkJaWVlZS0+Y3VycmVudF9uZXR3b3JrLmJ1c2Vwcm90ZWN0aW9uID0gZmFs
c2U7CisJCQl9CisJCWlmIChpc19iZWFjb24oYmVhY29uLT5oZWFkZXIuZnJhbWVfY3RsKSkgewor
CQkJaWYgKGllZWUtPnN0YXRlID09IElFRUU4MDIxMV9MSU5LRUQpCiAJCQkJaWVlZS0+TGlua0Rl
dGVjdEluZm8uTnVtUmVjdkJjbkluUGVyaW9kKys7CiAJCX0gZWxzZSAvKiBoaWRkZW4gQVAgKi8K
IAkJCW5ldHdvcmstPmZsYWdzID0gKH5ORVRXT1JLX0VNUFRZX0VTU0lEICYgbmV0d29yay0+Zmxh
Z3MpfChORVRXT1JLX0VNUFRZX0VTU0lEICYgaWVlZS0+Y3VycmVudF9uZXR3b3JrLmZsYWdzKTsK
QEAgLTI1NTYsOCArMjQ2MCw4IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpZWVlODAyMTFfcHJvY2Vz
c19wcm9iZV9yZXNwb25zZSgKICNlbmRpZgogCQltZW1jcHkodGFyZ2V0LCBuZXR3b3JrLCBzaXpl
b2YoKnRhcmdldCkpOwogCQlsaXN0X2FkZF90YWlsKCZ0YXJnZXQtPmxpc3QsICZpZWVlLT5uZXR3
b3JrX2xpc3QpOwotCQlpZihpZWVlLT5zb2Z0bWFjX2ZlYXR1cmVzICYgSUVFRV9TT0ZUTUFDX0FT
U09DSUFURSkKLQkJCWllZWU4MDIxMV9zb2Z0bWFjX25ld19uZXQoaWVlZSxuZXR3b3JrKTsKKwkJ
aWYgKGllZWUtPnNvZnRtYWNfZmVhdHVyZXMgJiBJRUVFX1NPRlRNQUNfQVNTT0NJQVRFKQorCQkJ
aWVlZTgwMjExX3NvZnRtYWNfbmV3X25ldChpZWVlLCBuZXR3b3JrKTsKIAl9IGVsc2UgewogCQlJ
RUVFODAyMTFfREVCVUdfU0NBTigiVXBkYXRpbmcgJyVzJyAoJXBNKSB2aWEgJXMuXG4iLAogCQkJ
CSAgICAgZXNjYXBlX2Vzc2lkKHRhcmdldC0+c3NpZCwKQEAgLTI1NzMsMjQgKzI0NzcsMjcgQEAg
c3RhdGljIGlubGluZSB2b2lkIGllZWU4MDIxMV9wcm9jZXNzX3Byb2JlX3Jlc3BvbnNlKAogCQkg
Ki8KIAkJcmVuZXcgPSAhdGltZV9hZnRlcih0YXJnZXQtPmxhc3Rfc2Nhbm5lZCArIGllZWUtPnNj
YW5fYWdlLCBqaWZmaWVzKTsKIAkJLyogWUosYWRkLDA4MDgxOSxmb3IgaGlkZGVuIGFwICovCi0J
CWlmKGlzX2JlYWNvbihiZWFjb24tPmhlYWRlci5mcmFtZV9jdGwpID09IDApCisJCWlmIChpc19i
ZWFjb24oYmVhY29uLT5oZWFkZXIuZnJhbWVfY3RsKSA9PSAwKQogCQkJbmV0d29yay0+ZmxhZ3Mg
PSAofk5FVFdPUktfRU1QVFlfRVNTSUQgJiBuZXR3b3JrLT5mbGFncyl8KE5FVFdPUktfRU1QVFlf
RVNTSUQgJiB0YXJnZXQtPmZsYWdzKTsKLQkJaWYoKChuZXR3b3JrLT5mbGFncyAmIE5FVFdPUktf
RU1QVFlfRVNTSUQpID09IE5FVFdPUktfRU1QVFlfRVNTSUQpIFwKLQkJICAgICYmICgoKG5ldHdv
cmstPnNzaWRfbGVuID4gMCkgJiYgKHN0cm5jbXAodGFyZ2V0LT5zc2lkLCBuZXR3b3JrLT5zc2lk
LCBuZXR3b3JrLT5zc2lkX2xlbikpKVwKLQkJICAgIHx8KChpZWVlLT5jdXJyZW50X25ldHdvcmsu
c3NpZF9sZW4gPT0gbmV0d29yay0+c3NpZF9sZW4pJiYoc3RybmNtcChpZWVlLT5jdXJyZW50X25l
dHdvcmsuc3NpZCwgbmV0d29yay0+c3NpZCwgbmV0d29yay0+c3NpZF9sZW4pID09IDApJiYoaWVl
ZS0+c3RhdGUgPT0gSUVFRTgwMjExX05PTElOSykpKSkKLQkJCXJlbmV3ID0gMTsKKwkJaWYgKCgo
bmV0d29yay0+ZmxhZ3MgJiBORVRXT1JLX0VNUFRZX0VTU0lEKSA9PSBORVRXT1JLX0VNUFRZX0VT
U0lEKSAmJgorCQkJKCgobmV0d29yay0+c3NpZF9sZW4gPiAwKSAmJgorCQkJKHN0cm5jbXAodGFy
Z2V0LT5zc2lkLCBuZXR3b3JrLT5zc2lkLCBuZXR3b3JrLT5zc2lkX2xlbikpKSB8fAorCQkJKChp
ZWVlLT5jdXJyZW50X25ldHdvcmsuc3NpZF9sZW4gPT0gbmV0d29yay0+c3NpZF9sZW4pICYmCisJ
CQkoc3RybmNtcChpZWVlLT5jdXJyZW50X25ldHdvcmsuc3NpZCwgbmV0d29yay0+c3NpZCwgbmV0
d29yay0+c3NpZF9sZW4pID09IDApICYmCisJCQkoaWVlZS0+c3RhdGUgPT0gSUVFRTgwMjExX05P
TElOSykpKSkKKwkJCQlyZW5ldyA9IDE7CiAJCS8qIFlKLGFkZCwwODA4MTksZm9yIGhpZGRlbiBh
cCxlbmQgKi8KCiAJCXVwZGF0ZV9uZXR3b3JrKHRhcmdldCwgbmV0d29yayk7Ci0JCWlmKHJlbmV3
ICYmIChpZWVlLT5zb2Z0bWFjX2ZlYXR1cmVzICYgSUVFRV9TT0ZUTUFDX0FTU09DSUFURSkpCi0J
CQlpZWVlODAyMTFfc29mdG1hY19uZXdfbmV0KGllZWUsbmV0d29yayk7CisJCWlmIChyZW5ldyAm
JiAoaWVlZS0+c29mdG1hY19mZWF0dXJlcyAmIElFRUVfU09GVE1BQ19BU1NPQ0lBVEUpKQorCQkJ
aWVlZTgwMjExX3NvZnRtYWNfbmV3X25ldChpZWVlLCBuZXR3b3JrKTsKIAl9CgogCXNwaW5fdW5s
b2NrX2lycXJlc3RvcmUoJmllZWUtPmxvY2ssIGZsYWdzKTsKLQlpZiAoaXNfYmVhY29uKGJlYWNv
bi0+aGVhZGVyLmZyYW1lX2N0bCkmJmlzX3NhbWVfbmV0d29yaygmaWVlZS0+Y3VycmVudF9uZXR3
b3JrLCBuZXR3b3JrLCBpZWVlKSYmXAorCWlmIChpc19iZWFjb24oYmVhY29uLT5oZWFkZXIuZnJh
bWVfY3RsKSAmJiBpc19zYW1lX25ldHdvcmsoJmllZWUtPmN1cnJlbnRfbmV0d29yaywgbmV0d29y
aywgaWVlZSkgJiYKIAkJKGllZWUtPnN0YXRlID09IElFRUU4MDIxMV9MSU5LRUQpKSB7CiAJCWlm
IChpZWVlLT5oYW5kbGVfYmVhY29uICE9IE5VTEwpIHsKLQkJCWllZWUtPmhhbmRsZV9iZWFjb24o
aWVlZS0+ZGV2LGJlYWNvbiwmaWVlZS0+Y3VycmVudF9uZXR3b3JrKTsKKwkJCWllZWUtPmhhbmRs
ZV9iZWFjb24oaWVlZS0+ZGV2LCBiZWFjb24sICZpZWVlLT5jdXJyZW50X25ldHdvcmspOwogCQl9
CiAJfQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9pZWVlODAyMTEvaWVl
ZTgwMjExX3NvZnRtYWMuYyBiL2RyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9pZWVlODAyMTEvaWVl
ZTgwMjExX3NvZnRtYWMuYwppbmRleCA0ZjY0OWZjYzdjMWQuLjdlMzgwZTkzZTdiOSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L2llZWU4MDIxMS9pZWVlODAyMTFfc29mdG1h
Yy5jCisrKyBiL2RyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9pZWVlODAyMTEvaWVlZTgwMjExX3Nv
ZnRtYWMuYwpAQCAtMTk2LDE1ICsxOTYsNiBAQCBzdGF0aWMgdTggTWdudFF1ZXJ5X01nbnRGcmFt
ZVR4UmF0ZShzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSkKIAkJCXJhdGUgPSAweDAyOwog
CX0KCi0JLyoKLQkvLyBEYXRhIHJhdGUgb2YgUHJvYmVSZXEgaXMgYWxyZWFkeSBkZWNpZGVkLiBB
bm5pZSwgMjAwNS0wMy0zMQotCWlmKCBwTWdudEluZm8tPmJTY2FuSW5Qcm9ncmVzcyB8fCAocE1n
bnRJbmZvLT5iRHVhbE1vZGVTY2FuU3RlcCE9MCkgKSB7Ci0JaWYocE1nbnRJbmZvLT5kb3QxMUN1
cnJlbnRXaXJlbGVzc01vZGU9PVdJUkVMRVNTX01PREVfQSkKLQlyYXRlID0gMHgwYzsKLQllbHNl
Ci0JcmF0ZSA9IDB4MDI7Ci0JfQotCSAqLwogCXJldHVybiByYXRlOwogfQoKQEAgLTUwNiw2ICs0
OTcsNyBAQCBzdGF0aWMgdm9pZCBpZWVlODAyMTFfc29mdG1hY19zY2FuX3dxKHN0cnVjdCB3b3Jr
X3N0cnVjdCAqd29yaykKIHN0YXRpYyB2b2lkIGllZWU4MDIxMV9iZWFjb25zX3N0YXJ0KHN0cnVj
dCBpZWVlODAyMTFfZGV2aWNlICppZWVlKQogewogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKIAlz
cGluX2xvY2tfaXJxc2F2ZSgmaWVlZS0+YmVhY29uX2xvY2ssIGZsYWdzKTsKCiAJaWVlZS0+YmVh
Y29uX3R4aW5nID0gMTsKQEAgLTY4MSw3ICs2NzMsNyBAQCBzdGF0aWMgc3RydWN0IHNrX2J1ZmYg
KmllZWU4MDIxMV9wcm9iZV9yZXNwKHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLCB1OCAq
ZAogCWNyeXB0ID0gaWVlZS0+Y3J5cHRbaWVlZS0+dHhfa2V5aWR4XTsKCiAJZW5jcnlwdCA9IGll
ZWUtPmhvc3RfZW5jcnlwdCAmJiBjcnlwdCAmJiBjcnlwdC0+b3BzICYmCi0JCSgoMCA9PSBzdHJj
bXAoY3J5cHQtPm9wcy0+bmFtZSwgIldFUCIpIHx8IHdwYV9pZV9sZW4pKTsKKwkJKChzdHJjbXAo
Y3J5cHQtPm9wcy0+bmFtZSwgIldFUCIpID09IDAgfHwgd3BhX2llX2xlbikpOwogCS8qIEhUIHJh
bGF0ZWQgZWxlbWVudCAqLwogCXRtcF9odF9jYXBfYnVmID0gKHU4ICopJmllZWUtPnBIVEluZm8t
PlNlbGZIVENhcDsKIAl0bXBfaHRfY2FwX2xlbiA9IHNpemVvZihpZWVlLT5wSFRJbmZvLT5TZWxm
SFRDYXApOwpAQCAtOTEyLDYgKzkwNCw3IEBAIHN0YXRpYyB2b2lkIGllZWU4MDIxMV9yZXNwX3Rv
X2F1dGgoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIGludCBzLAogc3RhdGljIHZvaWQg
aWVlZTgwMjExX3Jlc3BfdG9fcHJvYmUoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIHU4
ICpkZXN0KQogewogCXN0cnVjdCBza19idWZmICpidWYgPSBpZWVlODAyMTFfcHJvYmVfcmVzcChp
ZWVlLCBkZXN0KTsKKwogCWlmIChidWYpCiAJCXNvZnRtYWNfbWdtdF94bWl0KGJ1ZiwgaWVlZSk7
CiB9CkBAIC05NDUsNyArOTM4LDcgQEAgaWVlZTgwMjExX2Fzc29jaWF0aW9uX3JlcShzdHJ1Y3Qg
aWVlZTgwMjExX25ldHdvcmsgKmJlYWNvbiwKIAlpbnQgbGVuID0gMDsKCiAJY3J5cHQgPSBpZWVl
LT5jcnlwdFtpZWVlLT50eF9rZXlpZHhdOwotCWVuY3J5cHQgPSBpZWVlLT5ob3N0X2VuY3J5cHQg
JiYgY3J5cHQgJiYgY3J5cHQtPm9wcyAmJiAoKDAgPT0gc3RyY21wKGNyeXB0LT5vcHMtPm5hbWUs
ICJXRVAiKSB8fCB3cGFfaWVfbGVuKSk7CisJZW5jcnlwdCA9IGllZWUtPmhvc3RfZW5jcnlwdCAm
JiBjcnlwdCAmJiBjcnlwdC0+b3BzICYmICgoc3RyY21wKGNyeXB0LT5vcHMtPm5hbWUsICJXRVAi
KSA9PSAwIHx8IHdwYV9pZV9sZW4pKTsKCiAJLyogSW5jbHVkZSBIaWdoIFRocm91cHV0IGNhcGFi
aWxpdHkgJiYgUmVhbHRlayBwcm9wcmlldGFyeSAqLwogCWlmIChpZWVlLT5wSFRJbmZvLT5iQ3Vy
cmVudEhUU3VwcG9ydCAmJiBpZWVlLT5wSFRJbmZvLT5iRW5hYmxlSFQpIHsKQEAgLTEwODAsNiAr
MTA3Myw3IEBAIGllZWU4MDIxMV9hc3NvY2lhdGlvbl9yZXEoc3RydWN0IGllZWU4MDIxMV9uZXR3
b3JrICpiZWFjb24sCiAJaWYgKGJlYWNvbi0+QnNzQ2N4VmVyTnVtYmVyID49IDIpIHsKIAkJdTgJ
CQlDY3hWZXJOdW1CdWZbXSA9IHsweDAwLCAweDQwLCAweDk2LCAweDAzLCAweDAwfTsKIAkJc3Ry
dWN0IG9jdGV0X3N0cmluZwlvc0NjeFZlck51bTsKKwogCQlDY3hWZXJOdW1CdWZbNF0gPSBiZWFj
b24tPkJzc0NjeFZlck51bWJlcjsKIAkJb3NDY3hWZXJOdW0ub2N0ZXQgPSBDY3hWZXJOdW1CdWY7
CiAJCW9zQ2N4VmVyTnVtLmxlbmd0aCA9IHNpemVvZihDY3hWZXJOdW1CdWYpOwpAQCAtMTE1OSw3
ICsxMTUzLDcgQEAgdm9pZCBpZWVlODAyMTFfYXNzb2NpYXRlX2Fib3J0KHN0cnVjdCBpZWVlODAy
MTFfZGV2aWNlICppZWVlKQoKIAlpZWVlLT5zdGF0ZSA9IElFRUU4MDIxMV9BU1NPQ0lBVElOR19S
RVRSWTsKCi0Jc2NoZWR1bGVfZGVsYXllZF93b3JrKCZpZWVlLT5hc3NvY2lhdGVfcmV0cnlfd3Es
IFwKKwlzY2hlZHVsZV9kZWxheWVkX3dvcmsoJmllZWUtPmFzc29jaWF0ZV9yZXRyeV93cSwKIAkJ
CSAgICAgIElFRUU4MDIxMV9TT0ZUTUFDX0FTU09DX1JFVFJZX1RJTUUpOwoKIAlzcGluX3VubG9j
a19pcnFyZXN0b3JlKCZpZWVlLT5sb2NrLCBmbGFncyk7CkBAIC0xMjQ3LDYgKzEyNDEsNyBAQCBz
dGF0aWMgdm9pZCBpZWVlODAyMTFfYXNzb2NpYXRlX3N0ZXAyKHN0cnVjdCBpZWVlODAyMTFfZGV2
aWNlICppZWVlKQogc3RhdGljIHZvaWQgaWVlZTgwMjExX2Fzc29jaWF0ZV9jb21wbGV0ZV93cShz
dHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7CiAJc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmll
ZWUgPSBjb250YWluZXJfb2Yod29yaywgc3RydWN0IGllZWU4MDIxMV9kZXZpY2UsIGFzc29jaWF0
ZV9jb21wbGV0ZV93cSk7CisKIAlwcmludGsoS0VSTl9JTkZPICJBc3NvY2lhdGVkIHN1Y2Nlc3Nm
dWxseVxuIik7CiAJaWYgKGllZWU4MDIxMV9pc181NGcoJmllZWUtPmN1cnJlbnRfbmV0d29yaykg
JiYKIAkgICAgKGllZWUtPm1vZHVsYXRpb24gJiBJRUVFODAyMTFfT0ZETV9NT0RVTEFUSU9OKSkg
ewpAQCAtMTI5NCw2ICsxMjg5LDcgQEAgc3RhdGljIHZvaWQgaWVlZTgwMjExX2Fzc29jaWF0ZV9j
b21wbGV0ZShzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSkKIHN0YXRpYyB2b2lkIGllZWU4
MDIxMV9hc3NvY2lhdGVfcHJvY2VkdXJlX3dxKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHsK
IAlzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSA9IGNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1
Y3QgaWVlZTgwMjExX2RldmljZSwgYXNzb2NpYXRlX3Byb2NlZHVyZV93cSk7CisKIAlpZWVlLT5z
eW5jX3NjYW5faHVycnl1cCA9IDE7CiAJbXV0ZXhfbG9jaygmaWVlZS0+d3hfbXV0ZXgpOwoKQEAg
LTE0NDIsNiArMTQzOCw3IEBAIHN0YXRpYyBpbmxpbmUgdTE2IGF1dGhfcGFyc2Uoc3RydWN0IHNr
X2J1ZmYgKnNrYiwgdTggKipjaGFsbGVuZ2UsIGludCAqY2hsZW4pCiB7CiAJc3RydWN0IGllZWU4
MDIxMV9hdXRoZW50aWNhdGlvbiAqYTsKIAl1OCAqdDsKKwogCWlmIChza2ItPmxlbiA8IChzaXpl
b2Yoc3RydWN0IGllZWU4MDIxMV9hdXRoZW50aWNhdGlvbikgLSBzaXplb2Yoc3RydWN0IGllZWU4
MDIxMV9pbmZvX2VsZW1lbnQpKSkgewogCQlJRUVFODAyMTFfREVCVUdfTUdNVCgiaW52YWxpZCBs
ZW4gaW4gYXV0aCByZXNwOiAlZFxuIiwgc2tiLT5sZW4pOwogCQlyZXR1cm4gMHhjYWZlOwpAQCAt
MTUyNSw3ICsxNTIyLDcgQEAgc3RhdGljIGludCBhc3NvY19ycV9wYXJzZShzdHJ1Y3Qgc2tfYnVm
ZiAqc2tiLCB1OCAqZGVzdCkKCiAJaWYgKHNrYi0+bGVuIDwgKHNpemVvZihzdHJ1Y3QgaWVlZTgw
MjExX2Fzc29jX3JlcXVlc3RfZnJhbWUpIC0KIAkJc2l6ZW9mKHN0cnVjdCBpZWVlODAyMTFfaW5m
b19lbGVtZW50KSkpIHsKLQkJSUVFRTgwMjExX0RFQlVHX01HTVQoImludmFsaWQgbGVuIGluIGF1
dGggcmVxdWVzdDolZCBcbiIsIHNrYi0+bGVuKTsKKwkJSUVFRTgwMjExX0RFQlVHX01HTVQoImlu
dmFsaWQgbGVuIGluIGF1dGggcmVxdWVzdDolZFxuIiwgc2tiLT5sZW4pOwogCQlyZXR1cm4gLTE7
CiAJfQoKQEAgLTE1ODAsNiArMTU3Nyw3IEBAIGllZWU4MDIxMV9yeF9hdXRoX3JxKHN0cnVjdCBp
ZWVlODAyMTFfZGV2aWNlICppZWVlLCBzdHJ1Y3Qgc2tfYnVmZiAqc2tiKQogewogCXU4IGRlc3Rb
RVRIX0FMRU5dOwogCWludCBzdGF0dXM7CisKIAlpZWVlLT5zb2Z0bWFjX3N0YXRzLnJ4X2F1dGhf
cnErKzsKCiAJc3RhdHVzID0gYXV0aF9ycV9wYXJzZShza2IsIGRlc3QpOwpAQCAtMTY2NCw3ICsx
NjYyLDcgQEAgc3RhdGljIGlubGluZSB2b2lkIGllZWU4MDIxMV9zdGFfcHMoc3RydWN0IGllZWU4
MDIxMV9kZXZpY2UgKmllZWUpCiAJaWYgKChpZWVlLT5wcyA9PSBJRUVFODAyMTFfUFNfRElTQUJM
RUQgfHwKIAkgICAgIGllZWUtPml3X21vZGUgIT0gSVdfTU9ERV9JTkZSQSB8fAogCSAgICAgaWVl
ZS0+c3RhdGUgIT0gSUVFRTgwMjExX0xJTktFRCkpIHsKLQkJLyogCSN3YXJuaW5nIENIRUNLX0xP
Q0tfSEVSRSAqLworCQkvKiAjd2FybmluZyBDSEVDS19MT0NLX0hFUkUgKi8KIAkJc3Bpbl9sb2Nr
X2lycXNhdmUoJmllZWUtPm1nbXRfdHhfbG9jaywgZmxhZ3MyKTsKCiAJCWllZWU4MDIxMV9zdGFf
d2FrZXVwKGllZWUsIDEpOwpAQCAtMTc2Myw2ICsxNzYxLDcgQEAgc3RhdGljIHZvaWQgaWVlZTgw
MjExX3Byb2Nlc3NfYWN0aW9uKHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLAogCXN0cnVj
dCBydGxfODAyMTFfaGRyICpoZWFkZXIgPSAoc3RydWN0IHJ0bF84MDIxMV9oZHIgKilza2ItPmRh
dGE7CiAJdTggKmFjdCA9IGllZWU4MDIxMV9nZXRfcGF5bG9hZChoZWFkZXIpOwogCXU4IHRtcCA9
IDA7CisKIAlpZiAoYWN0ID09IE5VTEwpIHsKIAkJSUVFRTgwMjExX0RFQlVHKElFRUU4MDIxMV9E
TF9FUlIsICJlcnJvciB0byBnZXQgcGF5bG9hZCBvZiBhY3Rpb24gZnJhbWVcbiIpOwogCQlyZXR1
cm47CkBAIC0xNzgxLDcgKzE3ODAsNiBAQCBzdGF0aWMgdm9pZCBpZWVlODAyMTFfcHJvY2Vzc19h
Y3Rpb24oc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsCiAJZGVmYXVsdDoKIAkJYnJlYWs7
CiAJfQotCXJldHVybjsKIH0KCiBzdGF0aWMgdm9pZCBpZWVlODAyMTFfY2hlY2tfYXV0aF9yZXNw
b25zZShzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSwKQEAgLTE4ODYsOCArMTg4NCw4IEBA
IGllZWU4MDIxMV9yeF9mcmFtZV9zb2Z0bWFjKHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVl
LCBzdHJ1Y3Qgc2tfYnVmZiAqc2tiLAogCQkJCWlmIChpZWVlLT5xb3Nfc3VwcG9ydCkgewogCQkJ
CQlhc3NvY19yZXNwID0gKHN0cnVjdCBpZWVlODAyMTFfYXNzb2NfcmVzcG9uc2VfZnJhbWUgKilz
a2ItPmRhdGE7CiAJCQkJCW1lbXNldChuZXR3b3JrLCAwLCBzaXplb2YoKm5ldHdvcmspKTsKLQkJ
CQkJaWYgKGllZWU4MDIxMV9wYXJzZV9pbmZvX3BhcmFtKGllZWUsIGFzc29jX3Jlc3AtPmluZm9f
ZWxlbWVudCxcCi0JCQkJCQkJCSAgICAgICByeF9zdGF0cy0+bGVuIC0gc2l6ZW9mKCphc3NvY19y
ZXNwKSwgXAorCQkJCQlpZiAoaWVlZTgwMjExX3BhcnNlX2luZm9fcGFyYW0oaWVlZSwgYXNzb2Nf
cmVzcC0+aW5mb19lbGVtZW50LAorCQkJCQkJCQkgICAgICAgcnhfc3RhdHMtPmxlbiAtIHNpemVv
ZigqYXNzb2NfcmVzcCksCiAJCQkJCQkJCSAgICAgICBuZXR3b3JrLCByeF9zdGF0cykpIHsKIAkJ
CQkJCXJldHVybiAxOwogCQkJCQl9IGVsc2UgewpAQCAtMjAxNCwxNSArMjAxMiwxNSBAQCB2b2lk
IGllZWU4MDIxMV9zb2Z0bWFjX3htaXQoc3RydWN0IGllZWU4MDIxMV90eGIgKnR4Yiwgc3RydWN0
IGllZWU4MDIxMV9kZXZpY2UgKgogI2Vsc2UKIAkJaWYgKChza2JfcXVldWVfbGVuKCZpZWVlLT5z
a2Jfd2FpdFFbcXVldWVfaW5kZXhdKSAhPSAwKSB8fAogI2VuZGlmCi0JCSAgICAoIWllZWUtPmNo
ZWNrX25pY19lbm91Z2hfZGVzYyhpZWVlLT5kZXYsIHF1ZXVlX2luZGV4KSkgfHwgXAorCQkgICAg
KCFpZWVlLT5jaGVja19uaWNfZW5vdWdoX2Rlc2MoaWVlZS0+ZGV2LCBxdWV1ZV9pbmRleCkpIHx8
CiAJCSAgICAoaWVlZS0+cXVldWVfc3RvcCkpIHsKIAkJCS8qIGluc2VydCB0aGUgc2tiIHBhY2tl
dCB0byB0aGUgd2FpdCBxdWV1ZSAqLwogCQkJLyoKIAkJCSAqIGFzIGZvciB0aGUgY29tcGxldGlv
biBmdW5jdGlvbiwgaXQgZG9lcyBub3QgbmVlZAogCQkJICogdG8gY2hlY2sgaXQgYW55IG1vcmUu
Ci0JCQkgKiAqLwotCQkJLy9wcmludGsoImVycm9yOm5vIGRlc2NyaXB0b3IgbGVmdEBxdWV1ZV9p
bmRleCAlZFxuIiwgcXVldWVfaW5kZXgpOwotCQkJLy9pZWVlODAyMTFfc3RvcF9xdWV1ZShpZWVl
KTsKKwkJCSAqLworCQkJLyogcHJpbnRrKCJlcnJvcjpubyBkZXNjcmlwdG9yIGxlZnRAcXVldWVf
aW5kZXggJWRcbiIsIHF1ZXVlX2luZGV4KTsgKi8KKwkJCS8qIGllZWU4MDIxMV9zdG9wX3F1ZXVl
KGllZWUpOyAqLwogI2lmZGVmIFVTQl9UWF9EUklWRVJfQUdHUkVHQVRJT05fRU5BQkxFCiAJCQlz
a2JfcXVldWVfdGFpbCgmaWVlZS0+c2tiX2Rydl9hZ2dRW3F1ZXVlX2luZGV4XSwgdHhiLT5mcmFn
bWVudHNbaV0pOwogI2Vsc2UKQEAgLTIwNDQsNiArMjA0Miw3IEBAIEVYUE9SVF9TWU1CT0woaWVl
ZTgwMjExX3NvZnRtYWNfeG1pdCk7CiBzdGF0aWMgdm9pZCBpZWVlODAyMTFfcmVzdW1lX3R4KHN0
cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlKQogewogCWludCBpOworCiAJZm9yIChpID0gaWVl
ZS0+dHhfcGVuZGluZy5mcmFnOyBpIDwgaWVlZS0+dHhfcGVuZGluZy50eGItPm5yX2ZyYWdzOyBp
KyspIHsKIAkJaWYgKGllZWUtPnF1ZXVlX3N0b3ApIHsKIAkJCWllZWUtPnR4X3BlbmRpbmcuZnJh
ZyA9IGk7CkBAIC0yNDk2LDYgKzI0OTUsNyBAQCB2b2lkIGllZWU4MDIxMV9zdGFydF9wcm90b2Nv
bChzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSkKIHZvaWQgaWVlZTgwMjExX3NvZnRtYWNf
aW5pdChzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSkKIHsKIAlpbnQgaTsKKwogCW1lbXNl
dCgmaWVlZS0+Y3VycmVudF9uZXR3b3JrLCAwLCBzaXplb2Yoc3RydWN0IGllZWU4MDIxMV9uZXR3
b3JrKSk7CgogCWllZWUtPnN0YXRlID0gSUVFRTgwMjExX05PTElOSzsKQEAgLTI1NzksOCArMjU3
OSwxMCBAQCB2b2lkIGllZWU4MDIxMV9zb2Z0bWFjX2ZyZWUoc3RydWN0IGllZWU4MDIxMV9kZXZp
Y2UgKmllZWUpCiAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKiovCiBzdGF0aWMgaW50IGllZWU4MDIxMV93cGFfZW5hYmxlKHN0cnVjdCBpZWVl
ODAyMTFfZGV2aWNlICppZWVlLCBpbnQgdmFsdWUpCiB7Ci0JLyogVGhpcyBpcyBjYWxsZWQgd2hl
biB3cGFfc3VwcGxpY2FudCBsb2FkcyBhbmQgY2xvc2VzIHRoZSBkcml2ZXIKLQkgKiBpbnRlcmZh
Y2UuICovCisJLyoKKwkgKiBUaGlzIGlzIGNhbGxlZCB3aGVuIHdwYV9zdXBwbGljYW50IGxvYWRz
IGFuZCBjbG9zZXMgdGhlIGRyaXZlcgorCSAqIGludGVyZmFjZS4KKwkgKi8KIAlwcmludGsoIiVz
IFdQQVxuIiwgdmFsdWUgPyAiZW5hYmxpbmciIDogImRpc2FibGluZyIpOwogCWllZWUtPndwYV9l
bmFibGVkID0gdmFsdWU7CiAJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL3N0YWdpbmcv
cnRsODE5MnUvaWVlZTgwMjExL2llZWU4MDIxMV90eC5jIGIvZHJpdmVycy9zdGFnaW5nL3J0bDgx
OTJ1L2llZWU4MDIxMS9pZWVlODAyMTFfdHguYwppbmRleCAzMjAwMjE3NTJmMjguLmQ4MDdlYTAz
YTc3MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L2llZWU4MDIxMS9pZWVl
ODAyMTFfdHguYworKysgYi9kcml2ZXJzL3N0YWdpbmcvcnRsODE5MnUvaWVlZTgwMjExL2llZWU4
MDIxMV90eC5jCkBAIC0xNjksOCArMTY5LDcgQEAgaW50IGllZWU4MDIxMV9lbmNyeXB0X2ZyYWdt
ZW50KAogCXN0cnVjdCBpZWVlODAyMTFfY3J5cHRfZGF0YSAqY3J5cHQgPSBpZWVlLT5jcnlwdFtp
ZWVlLT50eF9rZXlpZHhdOwogCWludCByZXM7CgotCWlmICghKGNyeXB0ICYmIGNyeXB0LT5vcHMp
KQotCXsKKwlpZiAoIShjcnlwdCAmJiBjcnlwdC0+b3BzKSkgewogCQlwcmludGsoIj09PT09PT09
PT4lcygpLCBjcnlwdCBpcyBudWxsXG4iLCBfX2Z1bmNfXyk7CiAJCXJldHVybiAtMTsKIAl9CkBA
IC0yMTcsNyArMjE2LDggQEAgaW50IGllZWU4MDIxMV9lbmNyeXB0X2ZyYWdtZW50KAogfQoKCi12
b2lkIGllZWU4MDIxMV90eGJfZnJlZShzdHJ1Y3QgaWVlZTgwMjExX3R4YiAqdHhiKSB7Cit2b2lk
IGllZWU4MDIxMV90eGJfZnJlZShzdHJ1Y3QgaWVlZTgwMjExX3R4YiAqdHhiKQorewogCWlmICh1
bmxpa2VseSghdHhiKSkKIAkJcmV0dXJuOwogCWtmcmVlKHR4Yik7CkBAIC0yMjksNiArMjI5LDcg
QEAgc3RhdGljIHN0cnVjdCBpZWVlODAyMTFfdHhiICppZWVlODAyMTFfYWxsb2NfdHhiKGludCBu
cl9mcmFncywgaW50IHR4Yl9zaXplLAogewogCXN0cnVjdCBpZWVlODAyMTFfdHhiICp0eGI7CiAJ
aW50IGk7CisKIAl0eGIgPSBrbWFsbG9jKAogCQlzaXplb2Yoc3RydWN0IGllZWU4MDIxMV90eGIp
ICsgKHNpemVvZih1OCAqKSAqIG5yX2ZyYWdzKSwKIAkJZ2ZwX21hc2spOwpAQCAtMjYzLDYgKzI2
NCw3IEBAIGllZWU4MDIxMV9jbGFzc2lmeShzdHJ1Y3Qgc2tfYnVmZiAqc2tiLCBzdHJ1Y3QgaWVl
ZTgwMjExX25ldHdvcmsgKm5ldHdvcmspCiB7CiAJc3RydWN0IGV0aGhkciAqZXRoOwogCXN0cnVj
dCBpcGhkciAqaXA7CisKIAlldGggPSAoc3RydWN0IGV0aGhkciAqKXNrYi0+ZGF0YTsKIAlpZiAo
ZXRoLT5oX3Byb3RvICE9IGh0b25zKEVUSF9QX0lQKSkKIAkJcmV0dXJuIDA7CkBAIC0yOTUsNyAr
Mjk3LDcgQEAgc3RhdGljIHZvaWQgaWVlZTgwMjExX3R4X3F1ZXJ5X2FnZ19jYXAoc3RydWN0IGll
ZWU4MDIxMV9kZXZpY2UgKmllZWUsCiAJc3RydWN0IHR4X3RzX3JlY29yZCAgICAgICAgKnBUeFRz
ID0gTlVMTDsKIAlzdHJ1Y3QgcnRsXzgwMjExX2hkcl8xYWRkciAqaGRyID0gKHN0cnVjdCBydGxf
ODAyMTFfaGRyXzFhZGRyICopc2tiLT5kYXRhOwoKLQlpZiAoIXBIVEluZm8tPmJDdXJyZW50SFRT
dXBwb3J0fHwhcEhUSW5mby0+YkVuYWJsZUhUKQorCWlmICghcEhUSW5mby0+YkN1cnJlbnRIVFN1
cHBvcnQgfHwgIXBIVEluZm8tPmJFbmFibGVIVCkKIAkJcmV0dXJuOwogCWlmICghSXNRb1NEYXRh
RnJhbWUoc2tiLT5kYXRhKSkKIAkJcmV0dXJuOwpAQCAtMzEwLDY5ICszMTIsNTggQEAgc3RhdGlj
IHZvaWQgaWVlZTgwMjExX3R4X3F1ZXJ5X2FnZ19jYXAoc3RydWN0IGllZWU4MDIxMV9kZXZpY2Ug
KmllZWUsCiAJaWYgKCFBZGFwdGVyLT5IYWxGdW5jLkdldE5tb2RlU3VwcG9ydEJ5U2VjQ2ZnSGFu
ZGxlcihBZGFwdGVyKSkKIAkJcmV0dXJuOwogI2VuZGlmCi0JaWYgKCFpZWVlLT5HZXRObW9kZVN1
cHBvcnRCeVNlY0NmZyhpZWVlLT5kZXYpKQotCXsKKwlpZiAoIWllZWUtPkdldE5tb2RlU3VwcG9y
dEJ5U2VjQ2ZnKGllZWUtPmRldikpIHsKIAkJcmV0dXJuOwogCX0KLQlpZiAocEhUSW5mby0+YkN1
cnJlbnRBTVBEVUVuYWJsZSkKLQl7Ci0JCWlmICghR2V0VHMoaWVlZSwgKHN0cnVjdCB0c19jb21t
b25faW5mbyAqKikoJnBUeFRzKSwgaGRyLT5hZGRyMSwgc2tiLT5wcmlvcml0eSwgVFhfRElSLCB0
cnVlKSkKLQkJeworCWlmIChwSFRJbmZvLT5iQ3VycmVudEFNUERVRW5hYmxlKSB7CisJCWlmICgh
R2V0VHMoaWVlZSwgKHN0cnVjdCB0c19jb21tb25faW5mbyAqKikoJnBUeFRzKSwgaGRyLT5hZGRy
MSwgc2tiLT5wcmlvcml0eSwgVFhfRElSLCB0cnVlKSkgewogCQkJcHJpbnRrKCI9PT0+Y2FuJ3Qg
Z2V0IFRTXG4iKTsKIAkJCXJldHVybjsKIAkJfQotCQlpZiAoIXBUeFRzLT50eF9hZG1pdHRlZF9i
YV9yZWNvcmQudmFsaWQpCi0JCXsKKwkJaWYgKCFwVHhUcy0+dHhfYWRtaXR0ZWRfYmFfcmVjb3Jk
LnZhbGlkKSB7CiAJCQlUc1N0YXJ0QWRkQmFQcm9jZXNzKGllZWUsIHBUeFRzKTsKIAkJCWdvdG8g
Rk9SQ0VEX0FHR19TRVRUSU5HOwotCQl9Ci0JCWVsc2UgaWYgKCFwVHhUcy0+dXNpbmdfYmEpCi0J
CXsKKwkJfSBlbHNlIGlmICghcFR4VHMtPnVzaW5nX2JhKSB7CiAJCQlpZiAoU05fTEVTUyhwVHhU
cy0+dHhfYWRtaXR0ZWRfYmFfcmVjb3JkLnN0YXJ0X3NlcV9jdHJsLmZpZWxkLnNlcV9udW0sIChw
VHhUcy0+dHhfY3VyX3NlcSArIDEpICUgNDA5NikpCiAJCQkJcFR4VHMtPnVzaW5nX2JhID0gdHJ1
ZTsKIAkJCWVsc2UKIAkJCQlnb3RvIEZPUkNFRF9BR0dfU0VUVElORzsKIAkJfQoKLQkJaWYgKGll
ZWUtPml3X21vZGUgPT0gSVdfTU9ERV9JTkZSQSkKLQkJeworCQlpZiAoaWVlZS0+aXdfbW9kZSA9
PSBJV19NT0RFX0lORlJBKSB7CiAJCQl0Y2JfZGVzYy0+YkFNUERVRW5hYmxlID0gdHJ1ZTsKIAkJ
CXRjYl9kZXNjLT5hbXBkdV9mYWN0b3IgPSBwSFRJbmZvLT5DdXJyZW50QU1QRFVGYWN0b3I7CiAJ
CQl0Y2JfZGVzYy0+YW1wZHVfZGVuc2l0eSA9IHBIVEluZm8tPkN1cnJlbnRNUERVRGVuc2l0eTsK
IAkJfQogCX0KIEZPUkNFRF9BR0dfU0VUVElORzoKLQlzd2l0Y2ggKHBIVEluZm8tPkZvcmNlZEFN
UERVTW9kZSApCi0JewotCQljYXNlIEhUX0FHR19BVVRPOgotCQkJYnJlYWs7Ci0KLQkJY2FzZSBI
VF9BR0dfRk9SQ0VfRU5BQkxFOgotCQkJdGNiX2Rlc2MtPmJBTVBEVUVuYWJsZSA9IHRydWU7Ci0J
CQl0Y2JfZGVzYy0+YW1wZHVfZGVuc2l0eSA9IHBIVEluZm8tPkZvcmNlZE1QRFVEZW5zaXR5Owot
CQkJdGNiX2Rlc2MtPmFtcGR1X2ZhY3RvciA9IHBIVEluZm8tPkZvcmNlZEFNUERVRmFjdG9yOwot
CQkJYnJlYWs7Ci0KLQkJY2FzZSBIVF9BR0dfRk9SQ0VfRElTQUJMRToKLQkJCXRjYl9kZXNjLT5i
QU1QRFVFbmFibGUgPSBmYWxzZTsKLQkJCXRjYl9kZXNjLT5hbXBkdV9kZW5zaXR5ID0gMDsKLQkJ
CXRjYl9kZXNjLT5hbXBkdV9mYWN0b3IgPSAwOwotCQkJYnJlYWs7CisJc3dpdGNoIChwSFRJbmZv
LT5Gb3JjZWRBTVBEVU1vZGUpIHsKKwljYXNlIEhUX0FHR19BVVRPOgorCQlicmVhazsKKworCWNh
c2UgSFRfQUdHX0ZPUkNFX0VOQUJMRToKKwkJdGNiX2Rlc2MtPmJBTVBEVUVuYWJsZSA9IHRydWU7
CisJCXRjYl9kZXNjLT5hbXBkdV9kZW5zaXR5ID0gcEhUSW5mby0+Rm9yY2VkTVBEVURlbnNpdHk7
CisJCXRjYl9kZXNjLT5hbXBkdV9mYWN0b3IgPSBwSFRJbmZvLT5Gb3JjZWRBTVBEVUZhY3RvcjsK
KwkJYnJlYWs7CisKKwljYXNlIEhUX0FHR19GT1JDRV9ESVNBQkxFOgorCQl0Y2JfZGVzYy0+YkFN
UERVRW5hYmxlID0gZmFsc2U7CisJCXRjYl9kZXNjLT5hbXBkdV9kZW5zaXR5ID0gMDsKKwkJdGNi
X2Rlc2MtPmFtcGR1X2ZhY3RvciA9IDA7CisJCWJyZWFrOwoKIAl9Ci0JCXJldHVybjsKKwlyZXR1
cm47CiB9Cgogc3RhdGljIHZvaWQgaWVlZTgwMjExX3F1cmV5X1Nob3J0UHJlYW1ibGVNb2RlKHN0
cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLAogCQkJCQkgICAgICBzdHJ1Y3QgY2JfZGVzYyAq
dGNiX2Rlc2MpCiB7CiAJdGNiX2Rlc2MtPmJVc2VTaG9ydFByZWFtYmxlID0gZmFsc2U7Ci0JaWYg
KHRjYl9kZXNjLT5kYXRhX3JhdGUgPT0gMikgewotCS8qIDFNIGNhbiBvbmx5IHVzZSBMb25nIFBy
ZWFtYmxlLiAxMUIgc3BlYyAqLworCWlmICh0Y2JfZGVzYy0+ZGF0YV9yYXRlID09IDIpIHsvKiAx
TSBjYW4gb25seSB1c2UgTG9uZyBQcmVhbWJsZS4gMTFCIHNwZWMgKi8KIAkJcmV0dXJuOwotCX0K
LQllbHNlIGlmIChpZWVlLT5jdXJyZW50X25ldHdvcmsuY2FwYWJpbGl0eSAmIFdMQU5fQ0FQQUJJ
TElUWV9TSE9SVF9QUkVBTUJMRSkKLQl7CisJfSBlbHNlIGlmIChpZWVlLT5jdXJyZW50X25ldHdv
cmsuY2FwYWJpbGl0eSAmIFdMQU5fQ0FQQUJJTElUWV9TSE9SVF9QUkVBTUJMRSkgewogCQl0Y2Jf
ZGVzYy0+YlVzZVNob3J0UHJlYW1ibGUgPSB0cnVlOwogCX0KIAlyZXR1cm47CkBAIC0zODQsMTgg
KzM3NSwxNyBAQCBpZWVlODAyMTFfcXVlcnlfSFRDYXBTaG9ydEdJKHN0cnVjdCBpZWVlODAyMTFf
ZGV2aWNlICppZWVlLCBzdHJ1Y3QgY2JfZGVzYyAqdGNiXwoKIAl0Y2JfZGVzYy0+YlVzZVNob3J0
R0kJCT0gZmFsc2U7CgotCWlmICghcEhUSW5mby0+YkN1cnJlbnRIVFN1cHBvcnR8fCFwSFRJbmZv
LT5iRW5hYmxlSFQpCisJaWYgKCFwSFRJbmZvLT5iQ3VycmVudEhUU3VwcG9ydCB8fCAhcEhUSW5m
by0+YkVuYWJsZUhUKQogCQlyZXR1cm47CgotCWlmIChwSFRJbmZvLT5iRm9yY2VkU2hvcnRHSSkK
LQl7CisJaWYgKHBIVEluZm8tPmJGb3JjZWRTaG9ydEdJKSB7CiAJCXRjYl9kZXNjLT5iVXNlU2hv
cnRHSSA9IHRydWU7CiAJCXJldHVybjsKIAl9CgotCWlmICgocEhUSW5mby0+YkN1ckJXNDBNSHo9
PXRydWUpICYmIHBIVEluZm8tPmJDdXJTaG9ydEdJNDBNSHopCisJaWYgKChwSFRJbmZvLT5iQ3Vy
Qlc0ME1IeiA9PSB0cnVlKSAmJiBwSFRJbmZvLT5iQ3VyU2hvcnRHSTQwTUh6KQogCQl0Y2JfZGVz
Yy0+YlVzZVNob3J0R0kgPSB0cnVlOwotCWVsc2UgaWYgKChwSFRJbmZvLT5iQ3VyQlc0ME1Iej09
ZmFsc2UpICYmIHBIVEluZm8tPmJDdXJTaG9ydEdJMjBNSHopCisJZWxzZSBpZiAoKHBIVEluZm8t
PmJDdXJCVzQwTUh6ID09IGZhbHNlKSAmJiBwSFRJbmZvLT5iQ3VyU2hvcnRHSTIwTUh6KQogCQl0
Y2JfZGVzYy0+YlVzZVNob3J0R0kgPSB0cnVlOwogfQoKQEAgLTQwNiw3ICszOTYsNyBAQCBzdGF0
aWMgdm9pZCBpZWVlODAyMTFfcXVlcnlfQmFuZHdpZHRoTW9kZShzdHJ1Y3QgaWVlZTgwMjExX2Rl
dmljZSAqaWVlZSwKCiAJdGNiX2Rlc2MtPmJQYWNrZXRCVyA9IGZhbHNlOwoKLQlpZiAoIXBIVElu
Zm8tPmJDdXJyZW50SFRTdXBwb3J0fHwhcEhUSW5mby0+YkVuYWJsZUhUKQorCWlmICghcEhUSW5m
by0+YkN1cnJlbnRIVFN1cHBvcnQgfHwgIXBIVEluZm8tPmJFbmFibGVIVCkKIAkJcmV0dXJuOwoK
IAlpZiAodGNiX2Rlc2MtPmJNdWx0aWNhc3QgfHwgdGNiX2Rlc2MtPmJCcm9hZGNhc3QpCkBAIC00
MTUsNyArNDA1LDcgQEAgc3RhdGljIHZvaWQgaWVlZTgwMjExX3F1ZXJ5X0JhbmR3aWR0aE1vZGUo
c3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsCiAJaWYgKCh0Y2JfZGVzYy0+ZGF0YV9yYXRl
ICYgMHg4MCkgPT0gMCkgLyogSWYgdXNpbmcgbGVnYWN5IHJhdGUsIGl0IHNoYWxsIHVzZSAyME1I
eiBjaGFubmVsLiAqLwogCQlyZXR1cm47CiAJLyogQmFuZFdpZHRoQXV0b1N3aXRjaCBpcyBmb3Ig
YXV0byBzd2l0Y2ggdG8gMjAgb3IgNDAgaW4gbG9uZyBkaXN0YW5jZSAqLwotCWlmKHBIVEluZm8t
PmJDdXJCVzQwTUh6ICYmIHBIVEluZm8tPmJDdXJUeEJXNDBNSHogJiYgIWllZWUtPmJhbmR3aWR0
aF9hdXRvX3N3aXRjaC5iZm9yY2VkX3R4MjBNaHopCisJaWYgKHBIVEluZm8tPmJDdXJCVzQwTUh6
ICYmIHBIVEluZm8tPmJDdXJUeEJXNDBNSHogJiYgIWllZWUtPmJhbmR3aWR0aF9hdXRvX3N3aXRj
aC5iZm9yY2VkX3R4MjBNaHopCiAJCXRjYl9kZXNjLT5iUGFja2V0QlcgPSB0cnVlOwogCXJldHVy
bjsKIH0KQEAgLTQzNCwyNCArNDI0LDIwIEBAIHN0YXRpYyB2b2lkIGllZWU4MDIxMV9xdWVyeV9w
cm90ZWN0aW9ubW9kZShzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSwKIAlpZiAodGNiX2Rl
c2MtPmJCcm9hZGNhc3QgfHwgdGNiX2Rlc2MtPmJNdWx0aWNhc3QpLyogb25seSB1bmljYXN0IGZy
YW1lIHdpbGwgdXNlIHJ0cy9jdHMgKi8KIAkJcmV0dXJuOwoKLQlpZiAoaXNfYnJvYWRjYXN0X2V0
aGVyX2FkZHIoc2tiLT5kYXRhKzE2KSkgIC8qIGNoZWNrIGFkZHIzIGFzIGluZnJhc3RydWN0dXJl
IGFkZDMgaXMgREEuICovCisJaWYgKGlzX2Jyb2FkY2FzdF9ldGhlcl9hZGRyKHNrYi0+ZGF0YSAr
IDE2KSkgIC8qIGNoZWNrIGFkZHIzIGFzIGluZnJhc3RydWN0dXJlIGFkZDMgaXMgREEuICovCiAJ
CXJldHVybjsKCi0JaWYgKGllZWUtPm1vZGUgPCBJRUVFX05fMjRHKSAvKiBiLCBnIG1vZGUgKi8K
LQl7Ci0JCQkvKgotCQkJICogKDEpIFJUU19UaHJlc2hvbGQgaXMgY29tcGFyZWQgdG8gdGhlIE1Q
RFUsIG5vdCBNU0RVLgotCQkJICogKDIpIElmIHRoZXJlIGFyZSBtb3JlIHRoYW4gb25lIGZyYWcg
aW4gIHRoaXMgTVNEVSwgb25seSB0aGUgZmlyc3QgZnJhZyB1c2VzIHByb3RlY3Rpb24gZnJhbWUu
Ci0JCQkgKiAJT3RoZXIgZnJhZ21lbnRzIGFyZSBwcm90ZWN0ZWQgYnkgcHJldmlvdXMgZnJhZ21l
bnQuCi0JCQkgKiAJU28gd2Ugb25seSBuZWVkIHRvIGNoZWNrIHRoZSBsZW5ndGggb2YgZmlyc3Qg
ZnJhZ21lbnQuCi0JCQkgKi8KLQkJaWYgKHNrYi0+bGVuID4gaWVlZS0+cnRzKQotCQl7CisJaWYg
KGllZWUtPm1vZGUgPCBJRUVFX05fMjRHKSB7LyogYiwgZyBtb2RlICovCisJCS8qCisJCSAqICgx
KSBSVFNfVGhyZXNob2xkIGlzIGNvbXBhcmVkIHRvIHRoZSBNUERVLCBub3QgTVNEVS4KKwkJICog
KDIpIElmIHRoZXJlIGFyZSBtb3JlIHRoYW4gb25lIGZyYWcgaW4gIHRoaXMgTVNEVSwgb25seSB0
aGUgZmlyc3QgZnJhZyB1c2VzIHByb3RlY3Rpb24gZnJhbWUuCisJCSAqIAlPdGhlciBmcmFnbWVu
dHMgYXJlIHByb3RlY3RlZCBieSBwcmV2aW91cyBmcmFnbWVudC4KKwkJICogCVNvIHdlIG9ubHkg
bmVlZCB0byBjaGVjayB0aGUgbGVuZ3RoIG9mIGZpcnN0IGZyYWdtZW50LgorCQkgKi8KKwkJaWYg
KHNrYi0+bGVuID4gaWVlZS0+cnRzKSB7CiAJCQl0Y2JfZGVzYy0+YlJUU0VuYWJsZSA9IHRydWU7
CiAJCQl0Y2JfZGVzYy0+cnRzX3JhdGUgPSBNR05fMjRNOwotCQl9Ci0JCWVsc2UgaWYgKGllZWUt
PmN1cnJlbnRfbmV0d29yay5idXNlcHJvdGVjdGlvbikKLQkJeworCQl9IGVsc2UgaWYgKGllZWUt
PmN1cnJlbnRfbmV0d29yay5idXNlcHJvdGVjdGlvbikgewogCQkJLyogVXNlIENUUy10by1TRUxG
IGluIHByb3RlY3Rpb24gbW9kZS4gKi8KIAkJCXRjYl9kZXNjLT5iUlRTRW5hYmxlID0gdHJ1ZTsK
IAkJCXRjYl9kZXNjLT5iQ1RTRW5hYmxlID0gdHJ1ZTsKQEAgLTQ2MSw4ICs0NDcsNyBAQCBzdGF0
aWMgdm9pZCBpZWVlODAyMTFfcXVlcnlfcHJvdGVjdGlvbm1vZGUoc3RydWN0IGllZWU4MDIxMV9k
ZXZpY2UgKmllZWUsCiAJCXJldHVybjsKIAl9IGVsc2Ugey8qIDExbiBIaWdoIHRocm91Z2hwdXQg
Y2FzZS4gKi8KIAkJUFJUX0hJR0hfVEhST1VHSFBVVCBwSFRJbmZvID0gaWVlZS0+cEhUSW5mbzsK
LQkJd2hpbGUgKHRydWUpCi0JCXsKKwkJd2hpbGUgKHRydWUpIHsKIAkJCS8qIGNoZWNrIEVSUCBw
cm90ZWN0aW9uICovCiAJCQlpZiAoaWVlZS0+Y3VycmVudF9uZXR3b3JrLmJ1c2Vwcm90ZWN0aW9u
KSB7LyogQ1RTLXRvLVNFTEYgKi8KIAkJCQl0Y2JfZGVzYy0+YlJUU0VuYWJsZSA9IHRydWU7CkBA
IC00NzEsMjggKzQ1NiwyNCBAQCBzdGF0aWMgdm9pZCBpZWVlODAyMTFfcXVlcnlfcHJvdGVjdGlv
bm1vZGUoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsCiAJCQkJYnJlYWs7CiAJCQl9CiAJ
CQkvKiBjaGVjayBIVCBvcCBtb2RlICovCi0JCQlpZihwSFRJbmZvLT5iQ3VycmVudEhUU3VwcG9y
dCAgJiYgcEhUSW5mby0+YkVuYWJsZUhUKQotCQkJeworCQkJaWYgKHBIVEluZm8tPmJDdXJyZW50
SFRTdXBwb3J0ICYmIHBIVEluZm8tPmJFbmFibGVIVCkgewogCQkJCXU4IEhUT3BNb2RlID0gcEhU
SW5mby0+Q3VycmVudE9wTW9kZTsKLQkJCQlpZigocEhUSW5mby0+YkN1ckJXNDBNSHogJiYgKEhU
T3BNb2RlID09IDIgfHwgSFRPcE1vZGUgPT0gMykpIHx8Ci0JCQkJCQkJKCFwSFRJbmZvLT5iQ3Vy
Qlc0ME1IeiAmJiBIVE9wTW9kZSA9PSAzKSApCi0JCQkJeworCQkJCWlmICgocEhUSW5mby0+YkN1
ckJXNDBNSHogJiYgKEhUT3BNb2RlID09IDIgfHwgSFRPcE1vZGUgPT0gMykpIHx8CisJCQkJCQkJ
KCFwSFRJbmZvLT5iQ3VyQlc0ME1IeiAmJiBIVE9wTW9kZSA9PSAzKSkgewogCQkJCQl0Y2JfZGVz
Yy0+cnRzX3JhdGUgPSBNR05fMjRNOyAvKiBSYXRlIGlzIDI0TWJwcy4gKi8KIAkJCQkJdGNiX2Rl
c2MtPmJSVFNFbmFibGUgPSB0cnVlOwogCQkJCQlicmVhazsKIAkJCQl9CiAJCQl9CiAJCQkvKiBj
aGVjayBydHMgKi8KLQkJCWlmIChza2ItPmxlbiA+IGllZWUtPnJ0cykKLQkJCXsKKwkJCWlmIChz
a2ItPmxlbiA+IGllZWUtPnJ0cykgewogCQkJCXRjYl9kZXNjLT5ydHNfcmF0ZSA9IE1HTl8yNE07
IC8qIFJhdGUgaXMgMjRNYnBzLiAqLwogCQkJCXRjYl9kZXNjLT5iUlRTRW5hYmxlID0gdHJ1ZTsK
IAkJCQlicmVhazsKIAkJCX0KIAkJCS8qIHRvIGRvIGxpc3Q6IGNoZWNrIE1JTU8gcG93ZXIgc2F2
ZSBjb25kaXRpb24uICovCiAJCQkvKiBjaGVjayBBTVBEVSBhZ2dyZWdhdGlvbiBmb3IgVFhPUCAq
LwotCQkJaWYodGNiX2Rlc2MtPmJBTVBEVUVuYWJsZSkKLQkJCXsKKwkJCWlmICh0Y2JfZGVzYy0+
YkFNUERVRW5hYmxlKSB7CiAJCQkJdGNiX2Rlc2MtPnJ0c19yYXRlID0gTUdOXzI0TTsgLyogUmF0
ZSBpcyAyNE1icHMuICovCiAJCQkJLyogQWNjb3JkaW5nIHRvIDgxOTAgZGVzaWduLCBmaXJtd2Fy
ZSBzZW5kcyBDRi1FbmQgb25seSBpZiBSVFMvQ1RTIGlzIGVuYWJsZWQuIEhvd2V2ZXIsIGl0IGRl
Z3JhZHMgKi8KIAkJCQkvKiB0aHJvdWdocHV0IGFyb3VuZCAxME0sIHNvIHdlIGRpc2FibGUgb2Yg
dGhpcyBtZWNoYW5pc20uIDIwMDcuMDguMDMgYnkgRW1pbHkgKi8KQEAgLTUwMCw4ICs0ODEsNyBA
QCBzdGF0aWMgdm9pZCBpZWVlODAyMTFfcXVlcnlfcHJvdGVjdGlvbm1vZGUoc3RydWN0IGllZWU4
MDIxMV9kZXZpY2UgKmllZWUsCiAJCQkJYnJlYWs7CiAJCQl9CiAJCQkvKiBjaGVjayBJT1QgYWN0
aW9uICovCi0JCQlpZihwSFRJbmZvLT5JT1RBY3Rpb24gJiBIVF9JT1RfQUNUX0ZPUkNFRF9DVFMy
U0VMRikKLQkJCXsKKwkJCWlmIChwSFRJbmZvLT5JT1RBY3Rpb24gJiBIVF9JT1RfQUNUX0ZPUkNF
RF9DVFMyU0VMRikgewogCQkJCXRjYl9kZXNjLT5iQ1RTRW5hYmxlCT0gdHJ1ZTsKIAkJCQl0Y2Jf
ZGVzYy0+cnRzX3JhdGUgID0JTUdOXzI0TTsKIAkJCQl0Y2JfZGVzYy0+YlJUU0VuYWJsZSA9IHRy
dWU7CkBAIC01MjAsNyArNTAwLDcgQEAgc3RhdGljIHZvaWQgaWVlZTgwMjExX3F1ZXJ5X3Byb3Rl
Y3Rpb25tb2RlKHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLAogCWlmIChpZWVlLT5jdXJy
ZW50X25ldHdvcmsuY2FwYWJpbGl0eSAmIFdMQU5fQ0FQQUJJTElUWV9TSE9SVF9QUkVBTUJMRSkK
IAkJdGNiX2Rlc2MtPmJVc2VTaG9ydFByZWFtYmxlID0gdHJ1ZTsKIAlpZiAoaWVlZS0+bW9kZSA9
PSBJV19NT0RFX01BU1RFUikKLQkJCWdvdG8gTk9fUFJPVEVDVElPTjsKKwkJZ290byBOT19QUk9U
RUNUSU9OOwogCXJldHVybjsKIE5PX1BST1RFQ1RJT046CiAJdGNiX2Rlc2MtPmJSVFNFbmFibGUJ
PSBmYWxzZTsKQEAgLTUzNSwyOCArNTE1LDI1IEBAIHN0YXRpYyB2b2lkIGllZWU4MDIxMV90eHJh
dGVfc2VsZWN0bW9kZShzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSwKIAkJCQkJc3RydWN0
IGNiX2Rlc2MgKnRjYl9kZXNjKQogewogI2lmZGVmIFRPX0RPX0xJU1QKLQlpZighSXNEYXRhRnJh
bWUocEZyYW1lKSkKLQl7CisJaWYgKCFJc0RhdGFGcmFtZShwRnJhbWUpKSB7CiAJCXBUY2ItPmJU
eERpc2FibGVSYXRlRmFsbEJhY2sgPSB0cnVlOwogCQlwVGNiLT5iVHhVc2VEcml2ZXJBc3Npbmdl
ZFJhdGUgPSB0cnVlOwogCQlwVGNiLT5SQVRSSW5kZXggPSA3OwogCQlyZXR1cm47CiAJfQoKLQlp
ZihwTWdudEluZm8tPkZvcmNlZERhdGFSYXRlIT0gMCkKLQl7CisJaWYgKHBNZ250SW5mby0+Rm9y
Y2VkRGF0YVJhdGUgIT0gMCkgewogCQlwVGNiLT5iVHhEaXNhYmxlUmF0ZUZhbGxCYWNrID0gdHJ1
ZTsKIAkJcFRjYi0+YlR4VXNlRHJpdmVyQXNzaW5nZWRSYXRlID0gdHJ1ZTsKIAkJcmV0dXJuOwog
CX0KICNlbmRpZgotCWlmKGllZWUtPmJUeERpc2FibGVSYXRlRmFsbEJhY2spCisJaWYgKGllZWUt
PmJUeERpc2FibGVSYXRlRmFsbEJhY2spCiAJCXRjYl9kZXNjLT5iVHhEaXNhYmxlUmF0ZUZhbGxC
YWNrID0gdHJ1ZTsKCi0JaWYoaWVlZS0+YlR4VXNlRHJpdmVyQXNzaW5nZWRSYXRlKQorCWlmIChp
ZWVlLT5iVHhVc2VEcml2ZXJBc3NpbmdlZFJhdGUpCiAJCXRjYl9kZXNjLT5iVHhVc2VEcml2ZXJB
c3NpbmdlZFJhdGUgPSB0cnVlOwotCWlmKCF0Y2JfZGVzYy0+YlR4RGlzYWJsZVJhdGVGYWxsQmFj
ayB8fCAhdGNiX2Rlc2MtPmJUeFVzZURyaXZlckFzc2luZ2VkUmF0ZSkKLQl7CisJaWYgKCF0Y2Jf
ZGVzYy0+YlR4RGlzYWJsZVJhdGVGYWxsQmFjayB8fCAhdGNiX2Rlc2MtPmJUeFVzZURyaXZlckFz
c2luZ2VkUmF0ZSkgewogCQlpZiAoaWVlZS0+aXdfbW9kZSA9PSBJV19NT0RFX0lORlJBIHx8IGll
ZWUtPml3X21vZGUgPT0gSVdfTU9ERV9BREhPQykKIAkJCXRjYl9kZXNjLT5SQVRSSW5kZXggPSAw
OwogCX0KQEAgLTU2NywxMSArNTQ0LDEwIEBAIHN0YXRpYyB2b2lkIGllZWU4MDIxMV9xdWVyeV9z
ZXFudW0oc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsCiB7CiAJaWYgKGlzX211bHRpY2Fz
dF9ldGhlcl9hZGRyKGRzdCkpCiAJCXJldHVybjsKLQlpZiAoSXNRb1NEYXRhRnJhbWUoc2tiLT5k
YXRhKSkgLyogd2UgZGVhbCBxb3MgZGF0YSBvbmx5ICovCi0JeworCWlmIChJc1FvU0RhdGFGcmFt
ZShza2ItPmRhdGEpKSB7Lyogd2UgZGVhbCBxb3MgZGF0YSBvbmx5ICovCiAJCXN0cnVjdCB0eF90
c19yZWNvcmQgKnBUUyA9IE5VTEw7Ci0JCWlmICghR2V0VHMoaWVlZSwgKHN0cnVjdCB0c19jb21t
b25faW5mbyAqKikoJnBUUyksIGRzdCwgc2tiLT5wcmlvcml0eSwgVFhfRElSLCB0cnVlKSkKLQkJ
eworCisJCWlmICghR2V0VHMoaWVlZSwgKHN0cnVjdCB0c19jb21tb25faW5mbyAqKikoJnBUUyks
IGRzdCwgc2tiLT5wcmlvcml0eSwgVFhfRElSLCB0cnVlKSkgewogCQkJcmV0dXJuOwogCQl9CiAJ
CXBUUy0+dHhfY3VyX3NlcSA9IChwVFMtPnR4X2N1cl9zZXEgKyAxKSAlIDQwOTY7CkBAIC02MDcs
MTUgKzU4MywxNCBAQCBpbnQgaWVlZTgwMjExX3htaXQoc3RydWN0IHNrX2J1ZmYgKnNrYiwgc3Ry
dWN0IG5ldF9kZXZpY2UgKmRldikKIAkgKiBJZiB0aGVyZSBpcyBubyBkcml2ZXIgaGFuZGxlciB0
byB0YWtlIHRoZSBUWEIsIGRvbnQnIGJvdGhlcgogCSAqIGNyZWF0aW5nIGl0Li4uCiAJICovCi0J
aWYgKCghaWVlZS0+aGFyZF9zdGFydF94bWl0ICYmICEoaWVlZS0+c29mdG1hY19mZWF0dXJlcyAm
IElFRUVfU09GVE1BQ19UWF9RVUVVRSkpfHwKKwlpZiAoKCFpZWVlLT5oYXJkX3N0YXJ0X3htaXQg
JiYgIShpZWVlLT5zb2Z0bWFjX2ZlYXR1cmVzICYgSUVFRV9TT0ZUTUFDX1RYX1FVRVVFKSkgfHwK
IAkgICAoKCFpZWVlLT5zb2Z0bWFjX2RhdGFfaGFyZF9zdGFydF94bWl0ICYmIChpZWVlLT5zb2Z0
bWFjX2ZlYXR1cmVzICYgSUVFRV9TT0ZUTUFDX1RYX1FVRVVFKSkpKSB7Ci0JCXByaW50ayhLRVJO
X1dBUk5JTkcgIiVzOiBObyB4bWl0IGhhbmRsZXIuXG4iLAotCQkgICAgICAgaWVlZS0+ZGV2LT5u
YW1lKTsKKwkJcHJpbnRrKEtFUk5fV0FSTklORyAiJXM6IE5vIHhtaXQgaGFuZGxlci5cbiIsIGll
ZWUtPmRldi0+bmFtZSk7CiAJCWdvdG8gc3VjY2VzczsKIAl9CgoKLQlpZihsaWtlbHkoaWVlZS0+
cmF3X3R4ID09IDApKXsKKwlpZiAobGlrZWx5KGllZWUtPnJhd190eCA9PSAwKSkgewogCQlpZiAo
dW5saWtlbHkoc2tiLT5sZW4gPCBTTkFQX1NJWkUgKyBzaXplb2YodTE2KSkpIHsKIAkJCXByaW50
ayhLRVJOX1dBUk5JTkcgIiVzOiBza2IgdG9vIHNtYWxsICglZCkuXG4iLAogCQkJaWVlZS0+ZGV2
LT5uYW1lLCBza2ItPmxlbik7CkBAIC02NjEsNyArNjM2LDcgQEAgaW50IGllZWU4MDIxMV94bWl0
KHN0cnVjdCBza19idWZmICpza2IsIHN0cnVjdCBuZXRfZGV2aWNlICpkZXYpCiAJCQlmYyA9IElF
RUU4MDIxMV9GVFlQRV9EQVRBOwoKIAkJLy9pZihpZWVlLT5jdXJyZW50X25ldHdvcmsuUW9TX0Vu
YWJsZSkKLQkJaWYocW9zX2FjdGl2ZWQpCisJCWlmIChxb3NfYWN0aXZlZCkKIAkJCWZjIHw9IElF
RUU4MDIxMV9TVFlQRV9RT1NfREFUQTsKIAkJZWxzZQogCQkJZmMgfD0gSUVFRTgwMjExX1NUWVBF
X0RBVEE7CkBAIC02OTQsMTUgKzY2OSwxMyBAQCBpbnQgaWVlZTgwMjExX3htaXQoc3RydWN0IHNr
X2J1ZmYgKnNrYiwgc3RydWN0IG5ldF9kZXZpY2UgKmRldikKIAkJaWYgKGlzX211bHRpY2FzdF9l
dGhlcl9hZGRyKGhlYWRlci5hZGRyMSkpIHsKIAkJCWZyYWdfc2l6ZSA9IE1BWF9GUkFHX1RIUkVT
SE9MRDsKIAkJCXFvc19jdGwgfD0gUU9TX0NUTF9OT1RDT05UQUlOX0FDSzsKLQkJfQotCQllbHNl
IHsKKwkJfSBlbHNlIHsKIAkJCWZyYWdfc2l6ZSA9IGllZWUtPmZ0czsvKiBkZWZhdWx0OjM5MiAq
LwogCQkJcW9zX2N0bCA9IDA7CiAJCX0KCiAJCS8vaWYgKGllZWUtPmN1cnJlbnRfbmV0d29yay5R
b1NfRW5hYmxlKQotCQlpZihxb3NfYWN0aXZlZCkKLQkJeworCQlpZiAocW9zX2FjdGl2ZWQpIHsK
IAkJCWhkcl9sZW4gPSBJRUVFODAyMTFfM0FERFJfTEVOICsgMjsKCiAJCQlza2ItPnByaW9yaXR5
ID0gaWVlZTgwMjExX2NsYXNzaWZ5KHNrYiwgJmllZWUtPmN1cnJlbnRfbmV0d29yayk7CkBAIC03
NTMsOCArNzI2LDcgQEAgaW50IGllZWU4MDIxMV94bWl0KHN0cnVjdCBza19idWZmICpza2IsIHN0
cnVjdCBuZXRfZGV2aWNlICpkZXYpCiAJCXR4Yi0+cGF5bG9hZF9zaXplID0gX19jcHVfdG9fbGUx
NihieXRlcyk7CgogCQkvL2lmIChpZWVlLT5jdXJyZW50X25ldHdvcmsuUW9TX0VuYWJsZSkKLQkJ
aWYocW9zX2FjdGl2ZWQpCi0JCXsKKwkJaWYgKHFvc19hY3RpdmVkKSB7CiAJCQl0eGItPnF1ZXVl
X2luZGV4ID0gVVAyQUMoc2tiLT5wcmlvcml0eSk7CiAJCX0gZWxzZSB7CiAJCQl0eGItPnF1ZXVl
X2luZGV4ID0gV01FX0FDX0JLOwpAQCAtNzY1LDcgKzczNyw3IEBAIGludCBpZWVlODAyMTFfeG1p
dChzdHJ1Y3Qgc2tfYnVmZiAqc2tiLCBzdHJ1Y3QgbmV0X2RldmljZSAqZGV2KQogCQlmb3IgKGkg
PSAwOyBpIDwgbnJfZnJhZ3M7IGkrKykgewogCQkJc2tiX2ZyYWcgPSB0eGItPmZyYWdtZW50c1tp
XTsKIAkJCXRjYl9kZXNjID0gKHN0cnVjdCBjYl9kZXNjICopKHNrYl9mcmFnLT5jYiArIE1BWF9E
RVZfQUREUl9TSVpFKTsKLQkJCWlmKHFvc19hY3RpdmVkKXsKKwkJCWlmIChxb3NfYWN0aXZlZCkg
ewogCQkJCXNrYl9mcmFnLT5wcmlvcml0eSA9IHNrYi0+cHJpb3JpdHk7CiAJCQkJdGNiX2Rlc2Mt
PnF1ZXVlX2luZGV4ID0gIFVQMkFDKHNrYi0+cHJpb3JpdHkpOwogCQkJfSBlbHNlIHsKQEAgLTc3
NCwxNSArNzQ2LDEzIEBAIGludCBpZWVlODAyMTFfeG1pdChzdHJ1Y3Qgc2tfYnVmZiAqc2tiLCBz
dHJ1Y3QgbmV0X2RldmljZSAqZGV2KQogCQkJfQogCQkJc2tiX3Jlc2VydmUoc2tiX2ZyYWcsIGll
ZWUtPnR4X2hlYWRyb29tKTsKCi0JCQlpZiAoZW5jcnlwdCl7CisJCQlpZiAoZW5jcnlwdCkgewog
CQkJCWlmIChpZWVlLT5od3NlY19hY3RpdmUpCiAJCQkJCXRjYl9kZXNjLT5iSHdTZWMgPSAxOwog
CQkJCWVsc2UKIAkJCQkJdGNiX2Rlc2MtPmJId1NlYyA9IDA7CiAJCQkJc2tiX3Jlc2VydmUoc2ti
X2ZyYWcsIGNyeXB0LT5vcHMtPmV4dHJhX3ByZWZpeF9sZW4pOwotCQkJfQotCQkJZWxzZQotCQkJ
eworCQkJfSBlbHNlIHsKIAkJCQl0Y2JfZGVzYy0+Ykh3U2VjID0gMDsKIAkJCX0KIAkJCWZyYWdf
aGRyID0gc2tiX3B1dF9kYXRhKHNrYl9mcmFnLCAmaGVhZGVyLCBoZHJfbGVuKTsKQEAgLTgwMSw4
ICs3NzEsNyBAQCBpbnQgaWVlZTgwMjExX3htaXQoc3RydWN0IHNrX2J1ZmYgKnNrYiwgc3RydWN0
IG5ldF9kZXZpY2UgKmRldikKIAkJCQlieXRlcyA9IGJ5dGVzX2xhc3RfZnJhZzsKIAkJCX0KIAkJ
CS8vaWYoaWVlZS0+Y3VycmVudF9uZXR3b3JrLlFvU19FbmFibGUpCi0JCQlpZihxb3NfYWN0aXZl
ZCkKLQkJCXsKKwkJCWlmIChxb3NfYWN0aXZlZCkgewogCQkJCS8qIGFkZCAxIG9ubHkgaW5kaWNh
dGUgdG8gY29ycmVzcG9uZGluZyBzZXEgbnVtYmVyIGNvbnRyb2wgMjAwNi83LzEyICovCiAJCQkJ
ZnJhZ19oZHItPnNlcV9jdGwgPSBjcHVfdG9fbGUxNihpZWVlLT5zZXFfY3RybFtVUDJBQyhza2It
PnByaW9yaXR5KSsxXTw8NCB8IGkpOwogCQkJfSBlbHNlIHsKQEAgLTgzMywxNyArODAyLDE2IEBA
IGludCBpZWVlODAyMTFfeG1pdChzdHJ1Y3Qgc2tfYnVmZiAqc2tiLCBzdHJ1Y3QgbmV0X2Rldmlj
ZSAqZGV2KQogCQkJCXNrYl9wdXQoc2tiX2ZyYWcsIDQpOwogCQl9CgotCQlpZihxb3NfYWN0aXZl
ZCkKLQkJewotCQkgIGlmIChpZWVlLT5zZXFfY3RybFtVUDJBQyhza2ItPnByaW9yaXR5KSArIDFd
ID09IDB4RkZGKQotCQkJaWVlZS0+c2VxX2N0cmxbVVAyQUMoc2tiLT5wcmlvcml0eSkgKyAxXSA9
IDA7Ci0JCSAgZWxzZQotCQkJaWVlZS0+c2VxX2N0cmxbVVAyQUMoc2tiLT5wcmlvcml0eSkgKyAx
XSsrOworCQlpZiAocW9zX2FjdGl2ZWQpIHsKKwkJCWlmIChpZWVlLT5zZXFfY3RybFtVUDJBQyhz
a2ItPnByaW9yaXR5KSArIDFdID09IDB4RkZGKQorCQkJCWllZWUtPnNlcV9jdHJsW1VQMkFDKHNr
Yi0+cHJpb3JpdHkpICsgMV0gPSAwOworCQkJZWxzZQorCQkJCWllZWUtPnNlcV9jdHJsW1VQMkFD
KHNrYi0+cHJpb3JpdHkpICsgMV0rKzsKIAkJfSBlbHNlIHsKLQkJICBpZiAoaWVlZS0+c2VxX2N0
cmxbMF0gPT0gMHhGRkYpCi0JCQlpZWVlLT5zZXFfY3RybFswXSA9IDA7Ci0JCSAgZWxzZQotCQkJ
aWVlZS0+c2VxX2N0cmxbMF0rKzsKKwkJCWlmIChpZWVlLT5zZXFfY3RybFswXSA9PSAweEZGRikK
KwkJCQlpZWVlLT5zZXFfY3RybFswXSA9IDA7CisJCQllbHNlCisJCQkJaWVlZS0+c2VxX2N0cmxb
MF0rKzsKIAkJfQogCX0gZWxzZSB7CiAJCWlmICh1bmxpa2VseShza2ItPmxlbiA8IHNpemVvZihz
dHJ1Y3QgcnRsXzgwMjExX2hkcl8zYWRkcikpKSB7CkBAIC04NTMsNyArODIxLDcgQEAgaW50IGll
ZWU4MDIxMV94bWl0KHN0cnVjdCBza19idWZmICpza2IsIHN0cnVjdCBuZXRfZGV2aWNlICpkZXYp
CiAJCX0KCiAJCXR4YiA9IGllZWU4MDIxMV9hbGxvY190eGIoMSwgc2tiLT5sZW4sIEdGUF9BVE9N
SUMpOwotCQlpZighdHhiKXsKKwkJaWYgKCF0eGIpIHsKIAkJCXByaW50ayhLRVJOX1dBUk5JTkcg
IiVzOiBDb3VsZCBub3QgYWxsb2NhdGUgVFhCXG4iLAogCQkJaWVlZS0+ZGV2LT5uYW1lKTsKIAkJ
CWdvdG8gZmFpbGVkOwpAQCAtODY2LDkgKzgzNCw5IEBAIGludCBpZWVlODAyMTFfeG1pdChzdHJ1
Y3Qgc2tfYnVmZiAqc2tiLCBzdHJ1Y3QgbmV0X2RldmljZSAqZGV2KQoKICBzdWNjZXNzOgogLyog
V0IgYWRkIHRvIGZpbGwgZGF0YSB0Y2JfZGVzYyBoZXJlLiBvbmx5IGZpcnN0IGZyYWdtZW50IGlz
IGNvbnNpZGVyZWQsIG5lZWQgdG8gY2hhbmdlLCBhbmQgeW91IG1heSByZW1vdmUgdG8gb3RoZXIg
cGxhY2UuICovCi0JaWYgKHR4YikKLQl7CisJaWYgKHR4YikgewogCQlzdHJ1Y3QgY2JfZGVzYyAq
dGNiX2Rlc2MgPSAoc3RydWN0IGNiX2Rlc2MgKikodHhiLT5mcmFnbWVudHNbMF0tPmNiICsgTUFY
X0RFVl9BRERSX1NJWkUpOworCiAJCXRjYl9kZXNjLT5iVHhFbmFibGVGd0NhbGNEdXIgPSAxOwog
CQlpZiAoaXNfbXVsdGljYXN0X2V0aGVyX2FkZHIoaGVhZGVyLmFkZHIxKSkKIAkJCXRjYl9kZXNj
LT5iTXVsdGljYXN0ID0gMTsKQEAgLTg4OSw5ICs4NTcsOSBAQCBpbnQgaWVlZTgwMjExX3htaXQo
c3RydWN0IHNrX2J1ZmYgKnNrYiwgc3RydWN0IG5ldF9kZXZpY2UgKmRldikKIAlzcGluX3VubG9j
a19pcnFyZXN0b3JlKCZpZWVlLT5sb2NrLCBmbGFncyk7CiAJZGV2X2tmcmVlX3NrYl9hbnkoc2ti
KTsKIAlpZiAodHhiKSB7Ci0JCWlmIChpZWVlLT5zb2Z0bWFjX2ZlYXR1cmVzICYgSUVFRV9TT0ZU
TUFDX1RYX1FVRVVFKXsKKwkJaWYgKGllZWUtPnNvZnRtYWNfZmVhdHVyZXMgJiBJRUVFX1NPRlRN
QUNfVFhfUVVFVUUpIHsKIAkJCWllZWU4MDIxMV9zb2Z0bWFjX3htaXQodHhiLCBpZWVlKTsKLQkJ
fWVsc2V7CisJCX0gZWxzZSB7CiAJCQlpZiAoKCppZWVlLT5oYXJkX3N0YXJ0X3htaXQpKHR4Yiwg
ZGV2KSA9PSAwKSB7CiAJCQkJc3RhdHMtPnR4X3BhY2tldHMrKzsKIAkJCQlzdGF0cy0+dHhfYnl0
ZXMgKz0gX19sZTE2X3RvX2NwdSh0eGItPnBheWxvYWRfc2l6ZSk7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL3N0YWdpbmcvcnRsODE5MnUvaWVlZTgwMjExL2llZWU4MDIxMV93eC5jIGIvZHJpdmVycy9z
dGFnaW5nL3J0bDgxOTJ1L2llZWU4MDIxMS9pZWVlODAyMTFfd3guYwppbmRleCBiMDlmZDcxN2I3
NjAuLmExZWY3NTJhOTYzNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L2ll
ZWU4MDIxMS9pZWVlODAyMTFfd3guYworKysgYi9kcml2ZXJzL3N0YWdpbmcvcnRsODE5MnUvaWVl
ZTgwMjExL2llZWU4MDIxMV93eC5jCkBAIC02OSwxMCArNjksMTAgQEAgc3RhdGljIGlubGluZSBj
aGFyICpydGw4MTl4X3RyYW5zbGF0ZV9zY2FuKHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVl
LAogCX0KIAkvKiBBZGQgdGhlIHByb3RvY29sIG5hbWUgKi8KIAlpd2UuY21kID0gU0lPQ0dJV05B
TUU7Ci0JZm9yKGk9MDsgaTxBUlJBWV9TSVpFKGllZWU4MDIxMV9tb2Rlcyk7IGkrKykgeworCWZv
ciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGllZWU4MDIxMV9tb2Rlcyk7IGkrKykgewogCQlpZiAo
bmV0d29yay0+bW9kZSAmIEJJVChpKSkgewotCQkJc3ByaW50ZihwbmFtZSxpZWVlODAyMTFfbW9k
ZXNbaV0ubW9kZV9zdHJpbmcsaWVlZTgwMjExX21vZGVzW2ldLm1vZGVfc2l6ZSk7Ci0JCQlwbmFt
ZSArPWllZWU4MDIxMV9tb2Rlc1tpXS5tb2RlX3NpemU7CisJCQlzcHJpbnRmKHBuYW1lLCBpZWVl
ODAyMTFfbW9kZXNbaV0ubW9kZV9zdHJpbmcsIGllZWU4MDIxMV9tb2Rlc1tpXS5tb2RlX3NpemUp
OworCQkJcG5hbWUgKz0gaWVlZTgwMjExX21vZGVzW2ldLm1vZGVfc2l6ZTsKIAkJfQogCX0KIAkq
cG5hbWUgPSAnXDAnOwpAQCAtMTI3LDE5ICsxMjcsMTkgQEAgc3RhdGljIGlubGluZSBjaGFyICpy
dGw4MTl4X3RyYW5zbGF0ZV9zY2FuKHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLAogCQkJ
bWF4X3JhdGUgPSByYXRlOwogCX0KCi0JaWYgKG5ldHdvcmstPm1vZGUgPj0gSUVFRV9OXzI0Rykv
KiBhZGQgTiByYXRlIGhlcmU7ICovCi0JeworCWlmIChuZXR3b3JrLT5tb2RlID49IElFRUVfTl8y
NEcpIHsvKiBhZGQgTiByYXRlIGhlcmU7ICovCiAJCXN0cnVjdCBodF9jYXBhYmlsaXR5X2VsZSAq
aHRfY2FwID0gTlVMTDsKIAkJYm9vbCBpczQwTSA9IGZhbHNlLCBpc1Nob3J0R0kgPSBmYWxzZTsK
IAkJdTggbWF4X21jcyA9IDA7CisKIAkJaWYgKCFtZW1jbXAobmV0d29yay0+YnNzaHQuYmRIVENh
cEJ1ZiwgRVdDMTFOSFRDYXAsIDQpKQogCQkJaHRfY2FwID0gKHN0cnVjdCBodF9jYXBhYmlsaXR5
X2VsZSAqKSZuZXR3b3JrLT5ic3NodC5iZEhUQ2FwQnVmWzRdOwogCQllbHNlCiAJCQlodF9jYXAg
PSAoc3RydWN0IGh0X2NhcGFiaWxpdHlfZWxlICopJm5ldHdvcmstPmJzc2h0LmJkSFRDYXBCdWZb
MF07CiAJCWlzNDBNID0gKGh0X2NhcC0+Q2hsV2lkdGgpPzE6MDsKLQkJaXNTaG9ydEdJID0gKGh0
X2NhcC0+Q2hsV2lkdGgpPwotCQkJCQkJKChodF9jYXAtPlNob3J0R0k0ME1oeik/MTowKToKLQkJ
CQkJCSgoaHRfY2FwLT5TaG9ydEdJMjBNaHopPzE6MCk7CisJCWlzU2hvcnRHSSA9IChodF9jYXAt
PkNobFdpZHRoKSA/CisJCQkJCQkoKGh0X2NhcC0+U2hvcnRHSTQwTWh6KSA/IDEgOiAwKSA6CisJ
CQkJCQkoKGh0X2NhcC0+U2hvcnRHSTIwTWh6KSA/IDEgOiAwKTsKCiAJCW1heF9tY3MgPSBIVEdl
dEhpZ2hlc3RNQ1NSYXRlKGllZWUsIGh0X2NhcC0+TUNTLCBNQ1NfRklMVEVSX0FMTCk7CiAJCXJh
dGUgPSBNQ1NfREFUQV9SQVRFW2lzNDBNXVtpc1Nob3J0R0ldW21heF9tY3MmMHg3Zl07CkBAIC0x
NzUsMTEgKzE3NSwxMiBAQCBzdGF0aWMgaW5saW5lIGNoYXIgKnJ0bDgxOXhfdHJhbnNsYXRlX3Nj
YW4oc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsCgogCWl3ZS51LmRhdGEubGVuZ3RoID0g
cCAtIGN1c3RvbTsKIAlpZiAoaXdlLnUuZGF0YS5sZW5ndGgpCi0JICAgIHN0YXJ0ID0gaXdlX3N0
cmVhbV9hZGRfcG9pbnQoaW5mbywgc3RhcnQsIHN0b3AsICZpd2UsIGN1c3RvbSk7CisJCXN0YXJ0
ID0gaXdlX3N0cmVhbV9hZGRfcG9pbnQoaW5mbywgc3RhcnQsIHN0b3AsICZpd2UsIGN1c3RvbSk7
CgogCWlmIChpZWVlLT53cGFfZW5hYmxlZCAmJiBuZXR3b3JrLT53cGFfaWVfbGVuKSB7CiAJCWNo
YXIgYnVmW01BWF9XUEFfSUVfTEVOICogMiArIDMwXTsKIAkJdTggKnAgPSBidWY7CisKIAkJcCAr
PSBzcHJpbnRmKHAsICJ3cGFfaWU9Iik7CiAJCWZvciAoaSA9IDA7IGkgPCBuZXR3b3JrLT53cGFf
aWVfbGVuOyBpKyspIHsKIAkJCXAgKz0gc3ByaW50ZihwLCAiJTAyeCIsIG5ldHdvcmstPndwYV9p
ZVtpXSk7CkBAIC0xOTMsOCArMTk0LDggQEAgc3RhdGljIGlubGluZSBjaGFyICpydGw4MTl4X3Ry
YW5zbGF0ZV9zY2FuKHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLAoKIAlpZiAoaWVlZS0+
d3BhX2VuYWJsZWQgJiYgbmV0d29yay0+cnNuX2llX2xlbikgewogCQljaGFyIGJ1ZltNQVhfV1BB
X0lFX0xFTiAqIDIgKyAzMF07Ci0KIAkJdTggKnAgPSBidWY7CisKIAkJcCArPSBzcHJpbnRmKHAs
ICJyc25faWU9Iik7CiAJCWZvciAoaSA9IDA7IGkgPCBuZXR3b3JrLT5yc25faWVfbGVuOyBpKysp
IHsKIAkJCXAgKz0gc3ByaW50ZihwLCAiJTAyeCIsIG5ldHdvcmstPnJzbl9pZVtpXSk7CkBAIC0y
MTcsNyArMjE4LDcgQEAgc3RhdGljIGlubGluZSBjaGFyICpydGw4MTl4X3RyYW5zbGF0ZV9zY2Fu
KHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLAogCQkgICAgICAiIExhc3QgYmVhY29uOiAl
bHVtcyBhZ28iLCAoamlmZmllcyAtIG5ldHdvcmstPmxhc3Rfc2Nhbm5lZCkgLyAoSFogLyAxMDAp
KTsKIAlpd2UudS5kYXRhLmxlbmd0aCA9IHAgLSBjdXN0b207CiAJaWYgKGl3ZS51LmRhdGEubGVu
Z3RoKQotCSAgICBzdGFydCA9IGl3ZV9zdHJlYW1fYWRkX3BvaW50KGluZm8sIHN0YXJ0LCBzdG9w
LCAmaXdlLCBjdXN0b20pOworCQlzdGFydCA9IGl3ZV9zdHJlYW1fYWRkX3BvaW50KGluZm8sIHN0
YXJ0LCBzdG9wLCAmaXdlLCBjdXN0b20pOwoKIAlyZXR1cm4gc3RhcnQ7CiB9CkBAIC0yMzMsMTQg
KzIzNCwxNCBAQCBpbnQgaWVlZTgwMjExX3d4X2dldF9zY2FuKHN0cnVjdCBpZWVlODAyMTFfZGV2
aWNlICppZWVlLAogCWNoYXIgKnN0b3AgPSBldiArIHdycXUtPmRhdGEubGVuZ3RoOy8qIElXX1ND
QU5fTUFYX0RBVEE7ICovCiAJaW50IGkgPSAwOwogCWludCBlcnIgPSAwOworCiAJSUVFRTgwMjEx
X0RFQlVHX1dYKCJHZXR0aW5nIHNjYW5cbiIpOwogCW11dGV4X2xvY2soJmllZWUtPnd4X211dGV4
KTsKIAlzcGluX2xvY2tfaXJxc2F2ZSgmaWVlZS0+bG9jaywgZmxhZ3MpOwoKIAlsaXN0X2Zvcl9l
YWNoX2VudHJ5KG5ldHdvcmssICZpZWVlLT5uZXR3b3JrX2xpc3QsIGxpc3QpIHsKIAkJaSsrOwot
CQlpZigoc3RvcC1ldik8MjAwKQotCQl7CisJCWlmICgoc3RvcC1ldikgPCAyMDApIHsKIAkJCWVy
ciA9IC1FMkJJRzsKIAkJCWJyZWFrOwogCQl9CkBAIC00NjAsNyArNDYxLDcgQEAgaW50IGllZWU4
MDIxMV93eF9nZXRfZW5jb2RlKHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLAoKIAlJRUVF
ODAyMTFfREVCVUdfV1goIkdFVF9FTkNPREVcbiIpOwoKLQlpZihpZWVlLT5pd19tb2RlID09IElX
X01PREVfTU9OSVRPUikKKwlpZiAoaWVlZS0+aXdfbW9kZSA9PSBJV19NT0RFX01PTklUT1IpCiAJ
CXJldHVybiAtMTsKCiAJa2V5ID0gZXJxLT5mbGFncyAmIElXX0VOQ09ERV9JTkRFWDsKQEAgLTU3
NSw3ICs1NzYsNyBAQCBpbnQgaWVlZTgwMjExX3d4X3NldF9lbmNvZGVfZXh0KHN0cnVjdCBpZWVl
ODAyMTFfZGV2aWNlICppZWVlLAogCQlyZXQgPSAtRUlOVkFMOwogCQlnb3RvIGRvbmU7CiAJfQot
CXByaW50aygiYWxnIG5hbWU6JXNcbiIsYWxnKTsKKwlwcmludGsoImFsZyBuYW1lOiVzXG4iLCBh
bGcpOwoKIAlvcHMgPSB0cnlfdGhlbl9yZXF1ZXN0X21vZHVsZShpZWVlODAyMTFfZ2V0X2NyeXB0
b19vcHMoYWxnKSwgbW9kdWxlKTsKIAlpZiAoIW9wcykgewpAQCAtNjgzLDEyICs2ODQsMTIgQEAg
aW50IGllZWU4MDIxMV93eF9nZXRfZW5jb2RlX2V4dChzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAq
aWVlZSwKIAllbmNvZGluZy0+ZmxhZ3MgPSBpZHggKyAxOwogCW1lbXNldChleHQsIDAsIHNpemVv
ZigqZXh0KSk7CgotCWlmIChjcnlwdCA9PSBOVUxMIHx8IGNyeXB0LT5vcHMgPT0gTlVMTCApIHsK
KwlpZiAoY3J5cHQgPT0gTlVMTCB8fCBjcnlwdC0+b3BzID09IE5VTEwpIHsKIAkJZXh0LT5hbGcg
PSBJV19FTkNPREVfQUxHX05PTkU7CiAJCWV4dC0+a2V5X2xlbiA9IDA7CiAJCWVuY29kaW5nLT5m
bGFncyB8PSBJV19FTkNPREVfRElTQUJMRUQ7CiAJfSBlbHNlIHsKLQkJaWYgKHN0cmNtcChjcnlw
dC0+b3BzLT5uYW1lLCAiV0VQIikgPT0gMCApCisJCWlmIChzdHJjbXAoY3J5cHQtPm9wcy0+bmFt
ZSwgIldFUCIpID09IDApCiAJCQlleHQtPmFsZyA9IElXX0VOQ09ERV9BTEdfV0VQOwogCQllbHNl
IGlmIChzdHJjbXAoY3J5cHQtPm9wcy0+bmFtZSwgIlRLSVAiKSkKIAkJCWV4dC0+YWxnID0gSVdf
RU5DT0RFX0FMR19US0lQOwpAQCAtNzEzLDYgKzcxNCw3IEBAIGludCBpZWVlODAyMTFfd3hfc2V0
X21sbWUoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsCiAJCQkgICAgICAgdW5pb24gaXdy
ZXFfZGF0YSAqd3JxdSwgY2hhciAqZXh0cmEpCiB7CiAJc3RydWN0IGl3X21sbWUgKm1sbWUgPSAo
c3RydWN0IGl3X21sbWUgKikgZXh0cmE7CisKIAlzd2l0Y2ggKG1sbWUtPmNtZCkgewogCWNhc2Ug
SVdfTUxNRV9ERUFVVEg6CiAJY2FzZSBJV19NTE1FX0RJU0FTU09DOgpAQCAtNzMxLDE1ICs3MzMs
MTUgQEAgaW50IGllZWU4MDIxMV93eF9zZXRfYXV0aChzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAq
aWVlZSwKIHsKIAlzd2l0Y2ggKGRhdGEtPmZsYWdzICYgSVdfQVVUSF9JTkRFWCkgewogCWNhc2Ug
SVdfQVVUSF9XUEFfVkVSU0lPTjoKLQkgICAgIC8qbmVlZCB0byBzdXBwb3J0IHdwYTIgaGVyZSov
CisJLypuZWVkIHRvIHN1cHBvcnQgd3BhMiBoZXJlKi8KIAkJYnJlYWs7CiAJY2FzZSBJV19BVVRI
X0NJUEhFUl9QQUlSV0lTRToKIAljYXNlIElXX0FVVEhfQ0lQSEVSX0dST1VQOgogCWNhc2UgSVdf
QVVUSF9LRVlfTUdNVDoKIAkJLyoKLQkJKiBIb3N0IEFQIGRyaXZlciBkb2VzIG5vdCB1c2UgdGhl
c2UgcGFyYW1ldGVycyBhbmQgYWxsb3dzCi0JCSogd3BhX3N1cHBsaWNhbnQgdG8gY29udHJvbCB0
aGVtIGludGVybmFsbHkuCi0JCSovCisJCSAqIEhvc3QgQVAgZHJpdmVyIGRvZXMgbm90IHVzZSB0
aGVzZSBwYXJhbWV0ZXJzIGFuZCBhbGxvd3MKKwkJICogd3BhX3N1cHBsaWNhbnQgdG8gY29udHJv
bCB0aGVtIGludGVybmFsbHkuCisJCSAqLwogCQlicmVhazsKIAljYXNlIElXX0FVVEhfVEtJUF9D
T1VOVEVSTUVBU1VSRVM6CiAJCWllZWUtPnRraXBfY291bnRlcm1lYXN1cmVzID0gZGF0YS0+dmFs
dWU7CkBAIC03NTgsOCArNzYwLDcgQEAgaW50IGllZWU4MDIxMV93eF9zZXRfYXV0aChzdHJ1Y3Qg
aWVlZTgwMjExX2RldmljZSAqaWVlZSwKIAkJfSBlbHNlIGlmIChkYXRhLT52YWx1ZSAmIElXX0FV
VEhfQUxHX0xFQVApIHsKIAkJCWllZWUtPm9wZW5fd2VwID0gMTsKIAkJCWllZWUtPmF1dGhfbW9k
ZSA9IDI7Ci0JCX0KLQkJZWxzZQorCQl9IGVsc2UKIAkJCXJldHVybiAtRUlOVkFMOwogCQlicmVh
azsKCkBAIC03ODQsMTYgKzc4NSwxMyBAQCBpbnQgaWVlZTgwMjExX3d4X3NldF9nZW5faWUoc3Ry
dWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIHU4ICppZSwgc2l6ZV90IGxlbikKIHsKIAl1OCAq
YnVmOwoKLQlpZiAobGVuPk1BWF9XUEFfSUVfTEVOIHx8IChsZW4gJiYgaWUgPT0gTlVMTCkpCi0J
eworCWlmIChsZW4gPiBNQVhfV1BBX0lFX0xFTiB8fCAobGVuICYmIGllID09IE5VTEwpKSB7CiAJ
CXJldHVybiAtRUlOVkFMOwogCX0KCgotCWlmIChsZW4pCi0JewotCQlpZiAobGVuICE9IGllWzFd
KzIpCi0JCXsKKwlpZiAobGVuKSB7CisJCWlmIChsZW4gIT0gaWVbMV0gKyAyKSB7CiAJCQlwcmlu
dGsoImxlbjolenUsIGllOiVkXG4iLCBsZW4sIGllWzFdKTsKIAkJCXJldHVybiAtRUlOVkFMOwog
CQl9CkBAIC04MDMsOCArODAxLDcgQEAgaW50IGllZWU4MDIxMV93eF9zZXRfZ2VuX2llKHN0cnVj
dCBpZWVlODAyMTFfZGV2aWNlICppZWVlLCB1OCAqaWUsIHNpemVfdCBsZW4pCiAJCWtmcmVlKGll
ZWUtPndwYV9pZSk7CiAJCWllZWUtPndwYV9pZSA9IGJ1ZjsKIAkJaWVlZS0+d3BhX2llX2xlbiA9
IGxlbjsKLQl9Ci0JZWxzZXsKKwl9IGVsc2UgewogCQlrZnJlZShpZWVlLT53cGFfaWUpOwogCQlp
ZWVlLT53cGFfaWUgPSBOVUxMOwogCQlpZWVlLT53cGFfaWVfbGVuID0gMDsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9pZWVlODAyMTEvcnRsODE5eF9CQVByb2MuYyBiL2Ry
aXZlcnMvc3RhZ2luZy9ydGw4MTkydS9pZWVlODAyMTEvcnRsODE5eF9CQVByb2MuYwppbmRleCBh
ZWQxMTQ1NzNlZGIuLjVmYWYxOTM4MWMwOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9zdGFnaW5nL3J0
bDgxOTJ1L2llZWU4MDIxMS9ydGw4MTl4X0JBUHJvYy5jCisrKyBiL2RyaXZlcnMvc3RhZ2luZy9y
dGw4MTkydS9pZWVlODAyMTEvcnRsODE5eF9CQVByb2MuYwpAQCAtMTQwLDcgKzE0MCw3IEBAIHN0
YXRpYyBzdHJ1Y3Qgc2tfYnVmZiAqaWVlZTgwMjExX0FEREJBKHN0cnVjdCBpZWVlODAyMTFfZGV2
aWNlICppZWVlLCB1OCAqRHN0LCBzCiAJLyogRGlhbG9nIFRva2VuICovCiAJKnRhZysrID0gcEJB
LT5kaWFsb2dfdG9rZW47CgotCWlmIChBQ1RfQUREQkFSU1AgPT0gdHlwZSkgeworCWlmICh0eXBl
ID09IEFDVF9BRERCQVJTUCkgewogCQkvKiBTdGF0dXMgQ29kZSAqLwogCQluZXRkZXZfaW5mbyhp
ZWVlLT5kZXYsICI9PT09PT50byBzZW5kIEFEREJBUlNQXG4iKTsKCkBAIC0xNTYsNyArMTU2LDcg
QEAgc3RhdGljIHN0cnVjdCBza19idWZmICppZWVlODAyMTFfQUREQkEoc3RydWN0IGllZWU4MDIx
MV9kZXZpY2UgKmllZWUsIHU4ICpEc3QsIHMKIAlwdXRfdW5hbGlnbmVkX2xlMTYocEJBLT50aW1l
b3V0X3ZhbHVlLCB0YWcpOwogCXRhZyArPSAyOwoKLQlpZiAoQUNUX0FEREJBUkVRID09IHR5cGUp
IHsKKwlpZiAodHlwZSA9PSBBQ1RfQUREQkFSRVEpIHsKIAkvKiBCQSBTdGFydCBTZXFDdHJsICov
CiAJCW1lbWNweSh0YWcsICh1OCAqKSYocEJBLT5zdGFydF9zZXFfY3RybCksIDIpOwogCQl0YWcg
Kz0gMjsKQEAgLTI0NSw2ICsyNDUsNyBAQCBzdGF0aWMgdm9pZCBpZWVlODAyMTFfc2VuZF9BRERC
QVJlcShzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSwKIAkJCQkgICAgdTggKmRzdCwgc3Ry
dWN0IGJhX3JlY29yZCAqcEJBKQogewogCXN0cnVjdCBza19idWZmICpza2I7CisKIAlza2IgPSBp
ZWVlODAyMTFfQUREQkEoaWVlZSwgZHN0LCBwQkEsIDAsIEFDVF9BRERCQVJFUSk7IC8qIGNvbnN0
cnVjdCBBQ1RfQUREQkFSRVEgZnJhbWVzIHNvIHNldCBzdGF0dXNjb2RlIHplcm8uICovCgogCWlm
IChza2IpIHsKQEAgLTI3MSw2ICsyNzIsNyBAQCBzdGF0aWMgdm9pZCBpZWVlODAyMTFfc2VuZF9B
RERCQVJzcChzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSwgdTggKmRzdCwKIAkJCQkgICAg
c3RydWN0IGJhX3JlY29yZCAqcEJBLCB1MTYgU3RhdHVzQ29kZSkKIHsKIAlzdHJ1Y3Qgc2tfYnVm
ZiAqc2tiOworCiAJc2tiID0gaWVlZTgwMjExX0FEREJBKGllZWUsIGRzdCwgcEJBLCBTdGF0dXND
b2RlLCBBQ1RfQUREQkFSU1ApOyAvKiBjb25zdHJ1Y3QgQUNUX0FEREJBUlNQIGZyYW1lcyAqLwog
CWlmIChza2IpIHsKIAkJc29mdG1hY19tZ210X3htaXQoc2tiLCBpZWVlKTsKQEAgLTI5Nyw2ICsy
OTksNyBAQCBzdGF0aWMgdm9pZCBpZWVlODAyMTFfc2VuZF9ERUxCQShzdHJ1Y3QgaWVlZTgwMjEx
X2RldmljZSAqaWVlZSwgdTggKmRzdCwKIAkJCQkgdTE2IFJlYXNvbkNvZGUpCiB7CiAJc3RydWN0
IHNrX2J1ZmYgKnNrYjsKKwogCXNrYiA9IGllZWU4MDIxMV9ERUxCQShpZWVlLCBkc3QsIHBCQSwg
VHhSeFNlbGVjdCwgUmVhc29uQ29kZSk7IC8qIGNvbnN0cnVjdCBBQ1RfQUREQkFSU1AgZnJhbWVz
ICovCiAJaWYgKHNrYikgewogCQlzb2Z0bWFjX21nbXRfeG1pdChza2IsIGllZWUpOwpAQCAtMzk2
LDYgKzM5OSw3IEBAIGludCBpZWVlODAyMTFfcnhfQUREQkFSZXEoc3RydWN0IGllZWU4MDIxMV9k
ZXZpY2UgKmllZWUsIHN0cnVjdCBza19idWZmICpza2IpCiBPbkFEREJBUmVxX0ZhaWw6CiAJewog
CQlzdHJ1Y3QgYmFfcmVjb3JkCUJBOworCiAJCUJBLnBhcmFtX3NldCA9ICpwQmFQYXJhbVNldDsK
IAkJQkEudGltZW91dF92YWx1ZSA9ICpwQmFUaW1lb3V0VmFsOwogCQlCQS5kaWFsb2dfdG9rZW4g
PSAqcERpYWxvZ1Rva2VuOwpAQCAtNDQ1LDcgKzQ0OSw4IEBAIGludCBpZWVlODAyMTFfcnhfQURE
QkFSc3Aoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIHN0cnVjdCBza19idWZmICpza2Ip
CiAJaWYgKGllZWUtPmN1cnJlbnRfbmV0d29yay5xb3NfZGF0YS5hY3RpdmUgPT0gMCAgfHwKIAkg
ICAgIWllZWUtPnBIVEluZm8tPmJDdXJyZW50SFRTdXBwb3J0IHx8CiAJICAgICFpZWVlLT5wSFRJ
bmZvLT5iQ3VycmVudEFNUERVRW5hYmxlKSB7Ci0JCUlFRUU4MDIxMV9ERUJVRyhJRUVFODAyMTFf
RExfRVJSLCAicmVqZWN0IHRvIEFEREJBX1JTUCBhcyBzb21lIGNhcGFiaWxpdHkgaXMgbm90IHJl
YWR5KCVkLCAlZCwgJWQpXG4iLCBpZWVlLT5jdXJyZW50X25ldHdvcmsucW9zX2RhdGEuYWN0aXZl
LCBpZWVlLT5wSFRJbmZvLT5iQ3VycmVudEhUU3VwcG9ydCwgaWVlZS0+cEhUSW5mby0+YkN1cnJl
bnRBTVBEVUVuYWJsZSk7CisJCUlFRUU4MDIxMV9ERUJVRyhJRUVFODAyMTFfRExfRVJSLCAicmVq
ZWN0IHRvIEFEREJBX1JTUCBhcyBzb21lIGNhcGFiaWxpdHkgaXMgbm90IHJlYWR5KCVkLCAlZCwg
JWQpXG4iLAorCQkJaWVlZS0+Y3VycmVudF9uZXR3b3JrLnFvc19kYXRhLmFjdGl2ZSwgaWVlZS0+
cEhUSW5mby0+YkN1cnJlbnRIVFN1cHBvcnQsIGllZWUtPnBIVEluZm8tPmJDdXJyZW50QU1QRFVF
bmFibGUpOwogCQlSZWFzb25Db2RlID0gREVMQkFfUkVBU09OX1VOS05PV05fQkE7CiAJCWdvdG8g
T25BRERCQVJzcF9SZWplY3Q7CiAJfQpAQCAtNDc4LDEwICs0ODMsMTAgQEAgaW50IGllZWU4MDIx
MV9yeF9BRERCQVJzcChzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSwgc3RydWN0IHNrX2J1
ZmYgKnNrYikKIAkgKi8KIAlpZiAocEFkbWl0dGVkQkEtPnZhbGlkKSB7CiAJCS8qIFNpbmNlIEJB
IGlzIGFscmVhZHkgc2V0dXAsIHdlIGlnbm9yZSBhbGwgb3RoZXIgQUREQkEgUmVzcG9uc2UuICov
Ci0JCUlFRUU4MDIxMV9ERUJVRyhJRUVFODAyMTFfRExfQkEsICJPbkFEREJBUnNwKCk6IFJlY3Yg
QUREQkEgUnNwLiBEcm9wIGJlY2F1c2UgYWxyZWFkeSBhZG1pdCBpdCEgXG4iKTsKKwkJSUVFRTgw
MjExX0RFQlVHKElFRUU4MDIxMV9ETF9CQSwgIk9uQUREQkFSc3AoKTogUmVjdiBBRERCQSBSc3Au
IERyb3AgYmVjYXVzZSBhbHJlYWR5IGFkbWl0IGl0IVxuIik7CiAJCXJldHVybiAtMTsKIAl9IGVs
c2UgaWYgKCghcFBlbmRpbmdCQS0+dmFsaWQpIHx8ICgqcERpYWxvZ1Rva2VuICE9IHBQZW5kaW5n
QkEtPmRpYWxvZ190b2tlbikpIHsKLQkJSUVFRTgwMjExX0RFQlVHKElFRUU4MDIxMV9ETF9FUlIs
ICAiT25BRERCQVJzcCgpOiBSZWN2IEFEREJBIFJzcC4gQkEgaW52YWxpZCwgREVMQkEhIFxuIik7
CisJCUlFRUU4MDIxMV9ERUJVRyhJRUVFODAyMTFfRExfRVJSLCAgIk9uQUREQkFSc3AoKTogUmVj
diBBRERCQSBSc3AuIEJBIGludmFsaWQsIERFTEJBIVxuIik7CiAJCVJlYXNvbkNvZGUgPSBERUxC
QV9SRUFTT05fVU5LTk9XTl9CQTsKIAkJZ290byBPbkFEREJBUnNwX1JlamVjdDsKIAl9IGVsc2Ug
ewpAQCAtNTI1LDYgKzUzMCw3IEBAIGludCBpZWVlODAyMTFfcnhfQUREQkFSc3Aoc3RydWN0IGll
ZWU4MDIxMV9kZXZpY2UgKmllZWUsIHN0cnVjdCBza19idWZmICpza2IpCiBPbkFEREJBUnNwX1Jl
amVjdDoKIAl7CiAJCXN0cnVjdCBiYV9yZWNvcmQJQkE7CisKIAkJQkEucGFyYW1fc2V0ID0gKnBC
YVBhcmFtU2V0OwogCQlpZWVlODAyMTFfc2VuZF9ERUxCQShpZWVlLCBkc3QsICZCQSwgVFhfRElS
LCBSZWFzb25Db2RlKTsKIAkJcmV0dXJuIDA7CkBAIC02NDksNiArNjU1LDcgQEAgVHNJbml0RGVs
QkEoc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIHN0cnVjdCB0c19jb21tb25faW5mbyAq
cFRzQ29tbW9uSW5mbywKIAkJCQlERUxCQV9SRUFTT05fRU5EX0JBKTsKIAl9IGVsc2UgaWYgKFR4
UnhTZWxlY3QgPT0gUlhfRElSKSB7CiAJCXN0cnVjdCByeF90c19yZWNvcmQgKnBSeFRzID0gKHN0
cnVjdCByeF90c19yZWNvcmQgKilwVHNDb21tb25JbmZvOworCiAJCWlmIChSeFRzRGVsZXRlQkEo
aWVlZSwgcFJ4VHMpKQogCQkJaWVlZTgwMjExX3NlbmRfREVMQkEoCiAJCQkJaWVlZSwKQEAgLTY3
Nyw2ICs2ODQsNyBAQCB2b2lkIFR4QmFJbmFjdFRpbWVvdXQoc3RydWN0IHRpbWVyX2xpc3QgKnQp
CiB7CiAJc3RydWN0IHR4X3RzX3JlY29yZCAqcFR4VHMgPSBmcm9tX3RpbWVyKHBUeFRzLCB0LCB0
eF9hZG1pdHRlZF9iYV9yZWNvcmQudGltZXIpOwogCXN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICpp
ZWVlID0gY29udGFpbmVyX29mKHBUeFRzLCBzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSwgVHhUc1Jl
Y29yZFtwVHhUcy0+bnVtXSk7CisKIAlUeFRzRGVsZXRlQkEoaWVlZSwgcFR4VHMpOwogCWllZWU4
MDIxMV9zZW5kX0RFTEJBKAogCQlpZWVlLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9zdGFnaW5nL3J0
bDgxOTJ1L2llZWU4MDIxMS9ydGw4MTl4X0hULmggYi9kcml2ZXJzL3N0YWdpbmcvcnRsODE5MnUv
aWVlZTgwMjExL3J0bDgxOXhfSFQuaAppbmRleCA3MTY2NWIzZGE2MTcuLjE3NzUxM2M4ZDYzYiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L2llZWU4MDIxMS9ydGw4MTl4X0hU
LmgKKysrIGIvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L2llZWU4MDIxMS9ydGw4MTl4X0hULmgK
QEAgLTI0NywxNCArMjQ3LDE0IEBAIGV4dGVybiB1OCBNQ1NfRklMVEVSXzFTU1sxNl07CiAgKiB0
byBhZGQgYSBtYWNybyB0byBqdWRnZSB3aXJlbGVzcyBtb2RlLgogICovCiAjZGVmaW5lIFBJQ0tf
UkFURShfbkxlZ2FjeVJhdGUsIF9uTWNzUmF0ZSkJXAotCQkoX25NY3NSYXRlID09IDApID8gKF9u
TGVnYWN5UmF0ZSAmIDB4N2YpIDogKF9uTWNzUmF0ZSkKKwkJKChfbk1jc1JhdGUgPT0gMCkgPyAo
X25MZWdhY3lSYXRlICYgMHg3ZikgOiAoX25NY3NSYXRlKSkKIC8qIDIwMDcvMDcvMTIgTUggV2Ug
b25seSBkZWZpbmUgbGVnYWN5IGFuZCBIVCB3aXJlbGVzcyBtb2RlIG5vdy4gKi8KICNkZWZpbmUJ
TEVHQUNZX1dJUkVMRVNTX01PREUJSUVFRV9NT0RFX01BU0sKCiAjZGVmaW5lIENVUlJFTlRfUkFU
RShXaXJlbGVzc01vZGUsIExlZ2FjeVJhdGUsIEhUUmF0ZSkJXAotCQkJCQkoKFdpcmVsZXNzTW9k
ZSAmIChMRUdBQ1lfV0lSRUxFU1NfTU9ERSkpICE9IDApID9cCisJCQkJCSgoKFdpcmVsZXNzTW9k
ZSAmIChMRUdBQ1lfV0lSRUxFU1NfTU9ERSkpICE9IDApID9cCiAJCQkJCQkoTGVnYWN5UmF0ZSkg
OlwKLQkJCQkJCShQSUNLX1JBVEUoTGVnYWN5UmF0ZSwgSFRSYXRlKSkKKwkJCQkJCShQSUNLX1JB
VEUoTGVnYWN5UmF0ZSwgSFRSYXRlKSkpCgogLyogTUNTIEJ3IDQwIHsxfjcsIDEyfjE1LDMyfSAq
LwogI2RlZmluZQlSQVRFX0FEUFRfMVNTX01BU0sJCTB4RkYKQEAgLTI2OCwxMSArMjY4LDEwIEBA
IHR5cGVkZWYgZW51bSBfSFRfQUdHUkVfU0laRSB7CiAJSFRfQUdHX1NJWkVfMTZLID0gMSwKIAlI
VF9BR0dfU0laRV8zMksgPSAyLAogCUhUX0FHR19TSVpFXzY0SyA9IDMsCi19SFRfQUdHUkVfU0la
RV9FLCAqUEhUX0FHR1JFX1NJWkVfRTsKK30gSFRfQUdHUkVfU0laRV9FLCAqUEhUX0FHR1JFX1NJ
WkVfRTsKCiAvKiBJbmRpY2F0ZSBkaWZmZXJlbnQgQVAgdmVuZG9yIGZvciBJT1QgaXNzdWUgKi8K
LXR5cGVkZWYgZW51bSBfSFRfSU9UX1BFRVIKLXsKK3R5cGVkZWYgZW51bSBfSFRfSU9UX1BFRVIg
ewogCUhUX0lPVF9QRUVSX1VOS05PV04gPSAwLAogCUhUX0lPVF9QRUVSX1JFQUxURUsgPSAxLAog
CUhUX0lPVF9QRUVSX0JST0FEQ09NID0gMiwKQEAgLTI4MCw3ICsyNzksNyBAQCB0eXBlZGVmIGVu
dW0gX0hUX0lPVF9QRUVSCiAJSFRfSU9UX1BFRVJfQVRIRVJPUyA9IDQsCiAJSFRfSU9UX1BFRVJf
Q0lTQ08gPSA1LAogCUhUX0lPVF9QRUVSX01BWCA9IDYKLX1IVF9JT1RfUEVFUl9FLCAqUEhUSU9U
X1BFRVJfRTsKK30gSFRfSU9UX1BFRVJfRSwgKlBIVElPVF9QRUVSX0U7CgogLyoKICAqIElPVCBB
Y3Rpb24gZm9yIGRpZmZlcmVudCBBUApAQCAtMjk2LDYgKzI5NSw2IEBAIHR5cGVkZWYgZW51bSBf
SFRfSU9UX0FDVElPTiB7CiAJSFRfSU9UX0FDVF9DRERfRlNZTkMgPSAweDAwMDAwMDgwLAogCUhU
X0lPVF9BQ1RfUFVSRV9OX01PREUgPSAweDAwMDAwMTAwLAogCUhUX0lPVF9BQ1RfRk9SQ0VEX0NU
UzJTRUxGID0gMHgwMDAwMDIwMCwKLX1IVF9JT1RfQUNUSU9OX0UsICpQSFRfSU9UX0FDVElPTl9F
OworfSBIVF9JT1RfQUNUSU9OX0UsICpQSFRfSU9UX0FDVElPTl9FOwoKICNlbmRpZiAvKiBfUlRM
ODE5WFVfSFRUWVBFX0hfICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL3N0YWdpbmcvcnRsODE5MnUv
aWVlZTgwMjExL3J0bDgxOXhfSFRQcm9jLmMgYi9kcml2ZXJzL3N0YWdpbmcvcnRsODE5MnUvaWVl
ZTgwMjExL3J0bDgxOXhfSFRQcm9jLmMKaW5kZXggYzNiNjY4NzAyNGNkLi44NDc2YmFhZWRmN2Yg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9pZWVlODAyMTEvcnRsODE5eF9I
VFByb2MuYworKysgYi9kcml2ZXJzL3N0YWdpbmcvcnRsODE5MnUvaWVlZTgwMjExL3J0bDgxOXhf
SFRQcm9jLmMKQEAgLTE0Niw3ICsxNDYsNyBAQCB2b2lkIEhURGVidWdIVENhcGFiaWxpdHkodTgg
KkNhcElFLCB1OCAqVGl0bGVTdHJpbmcpCiAJSUVFRTgwMjExX0RFQlVHKElFRUU4MDIxMV9ETF9I
VCwgICJcdFN1cHBvcnQgQ0NLIGluIDIwLzQwIG1vZGUgPSAlc1xuIiwgKHBDYXBFTEUtPkRzc0ND
aykgPyAiWUVTIiA6ICJOTyIpOwogCUlFRUU4MDIxMV9ERUJVRyhJRUVFODAyMTFfRExfSFQsICAi
XHRNYXggQU1QRFUgRmFjdG9yID0gJWRcbiIsIHBDYXBFTEUtPk1heFJ4QU1QRFVGYWN0b3IpOwog
CUlFRUU4MDIxMV9ERUJVRyhJRUVFODAyMTFfRExfSFQsICAiXHRNUERVIERlbnNpdHkgPSAlZFxu
IiwgcENhcEVMRS0+TVBEVURlbnNpdHkpOwotCUlFRUU4MDIxMV9ERUJVRyhJRUVFODAyMTFfRExf
SFQsICAiXHRNQ1MgUmF0ZSBTZXQgPSBbJXhdWyV4XVsleF1bJXhdWyV4XVxuIiwgcENhcEVMRS0+
TUNTWzBdLFwKKwlJRUVFODAyMTFfREVCVUcoSUVFRTgwMjExX0RMX0hULCAgIlx0TUNTIFJhdGUg
U2V0ID0gWyV4XVsleF1bJXhdWyV4XVsleF1cbiIsIHBDYXBFTEUtPk1DU1swXSwKIAkJCQlwQ2Fw
RUxFLT5NQ1NbMV0sIHBDYXBFTEUtPk1DU1syXSwgcENhcEVMRS0+TUNTWzNdLCBwQ2FwRUxFLT5N
Q1NbNF0pOwogfQoKQEAgLTIwOCw3ICsyMDgsNyBAQCB2b2lkIEhURGVidWdIVEluZm8odTggKklu
Zm9JRSwgdTggKlRpdGxlU3RyaW5nKQogCQlicmVhazsKIAl9CgotCUlFRUU4MDIxMV9ERUJVRyhJ
RUVFODAyMTFfRExfSFQsICJcdEJhc2ljIE1DUyBSYXRlIFNldCA9IFsleF1bJXhdWyV4XVsleF1b
JXhdXG4iLCBwSFRJbmZvRWxlLT5CYXNpY01TQ1swXSxcCisJSUVFRTgwMjExX0RFQlVHKElFRUU4
MDIxMV9ETF9IVCwgIlx0QmFzaWMgTUNTIFJhdGUgU2V0ID0gWyV4XVsleF1bJXhdWyV4XVsleF1c
biIsIHBIVEluZm9FbGUtPkJhc2ljTVNDWzBdLAogCQkJCXBIVEluZm9FbGUtPkJhc2ljTVNDWzFd
LCBwSFRJbmZvRWxlLT5CYXNpY01TQ1syXSwgcEhUSW5mb0VsZS0+QmFzaWNNU0NbM10sIHBIVElu
Zm9FbGUtPkJhc2ljTVNDWzRdKTsKIH0KCkBAIC02NTQsMTMgKzY1NCwxMyBAQCB2b2lkIEhUQ29u
c3RydWN0UlQyUlRBZ2dFbGVtZW50KHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLCB1OCAq
cG9zUlQyUlRBZ2csCiAjaWZkZWYgVE9ETwogI2lmIChIQUxfQ09ERV9CQVNFID09IFJUTDgxOTIg
JiYgREVWX0JVU19UWVBFID09IFVTQl9JTlRFUkZBQ0UpCiAJLyoKLQkvL0VtaWx5LiBJZiBpdCBp
cyByZXF1aXJlZCB0byBBc2sgUmVhbHRlayBBUCB0byBzZW5kIEFNUERVIGR1cmluZyBBRVMgbW9k
ZSwgZW5hYmxlIHRoaXMKLQkgICBzZWN0aW9uIG9mIGNvZGUuCi0JaWYoSVNfVU5ERVJfMTFOX0FF
U19NT0RFKEFkYXB0ZXIpKQotCXsKKwkgKiBFbWlseS4gSWYgaXQgaXMgcmVxdWlyZWQgdG8gQXNr
IFJlYWx0ZWsgQVAgdG8gc2VuZCBBTVBEVSBkdXJpbmcgQUVTIG1vZGUsIGVuYWJsZSB0aGlzCisJ
ICogc2VjdGlvbiBvZiBjb2RlLgorCSAqLworCS8qCisJaWYoSVNfVU5ERVJfMTFOX0FFU19NT0RF
KEFkYXB0ZXIpKSB7CiAJCXBvc1JUMlJUQWdnLT5vY3RldFs1XSB8PSBSVF9IVF9DQVBfVVNFX0FN
UERVOwotCX1lbHNlCi0JeworCX0gZWxzZSB7CiAJCXBvc1JUMlJUQWdnLT5vY3RldFs1XSAmPSAw
eGZiOwogCX0KIAkqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L2llZWU4
MDIxMS9ydGw4MTl4X1RTUHJvYy5jIGIvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L2llZWU4MDIx
MS9ydGw4MTl4X1RTUHJvYy5jCmluZGV4IDkwMzM3Mzc2OTQ2NC4uYjI2MTQ2NjlmMmQyIDEwMDY0
NAotLS0gYS9kcml2ZXJzL3N0YWdpbmcvcnRsODE5MnUvaWVlZTgwMjExL3J0bDgxOXhfVFNQcm9j
LmMKKysrIGIvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L2llZWU4MDIxMS9ydGw4MTl4X1RTUHJv
Yy5jCkBAIC02OCw3ICs2OCw3IEBAIHN0YXRpYyB2b2lkIFJ4UGt0UGVuZGluZ1RpbWVvdXQoc3Ry
dWN0IHRpbWVyX2xpc3QgKnQpCgogCQkvKiBJbmRpY2F0ZSBwYWNrZXRzICovCiAJCWlmIChpbmRl
eCA+IFJFT1JERVJfV0lOX1NJWkUpIHsKLQkJCUlFRUU4MDIxMV9ERUJVRyhJRUVFODAyMTFfRExf
RVJSLCAiUnhSZW9yZGVySW5kaWNhdGVQYWNrZXQoKTogUnggUmVvcmRlciBidWZmZXIgZnVsbCEh
IFxuIik7CisJCQlJRUVFODAyMTFfREVCVUcoSUVFRTgwMjExX0RMX0VSUiwgIlJ4UmVvcmRlcklu
ZGljYXRlUGFja2V0KCk6IFJ4IFJlb3JkZXIgYnVmZmVyIGZ1bGwhIVxuIik7CiAJCQlzcGluX3Vu
bG9ja19pcnFyZXN0b3JlKCYoaWVlZS0+cmVvcmRlcl9zcGlubG9jayksIGZsYWdzKTsKIAkJCXJl
dHVybjsKIAkJfQpAQCAtOTYsNyArOTYsNyBAQCBzdGF0aWMgdm9pZCBUc0FkZEJhUHJvY2Vzcyhz
dHJ1Y3QgdGltZXJfbGlzdCAqdCkKIAlzdHJ1Y3QgaWVlZTgwMjExX2RldmljZSAqaWVlZSA9IGNv
bnRhaW5lcl9vZihwVHhUcywgc3RydWN0IGllZWU4MDIxMV9kZXZpY2UsIFR4VHNSZWNvcmRbbnVt
XSk7CgogCVRzSW5pdEFkZEJBKGllZWUsIHBUeFRzLCBCQV9QT0xJQ1lfSU1NRURJQVRFLCBmYWxz
ZSk7Ci0JSUVFRTgwMjExX0RFQlVHKElFRUU4MDIxMV9ETF9CQSwgIlRzQWRkQmFQcm9jZXNzKCk6
IEFEREJBIFJlcSBpcyBzdGFydGVkISEgXG4iKTsKKwlJRUVFODAyMTFfREVCVUcoSUVFRTgwMjEx
X0RMX0JBLCAiVHNBZGRCYVByb2Nlc3MoKTogQUREQkEgUmVxIGlzIHN0YXJ0ZWQhIVxuIik7CiB9
CgoKQEAgLTEzNCw2ICsxMzQsNyBAQCB2b2lkIFRTSW5pdGlhbGl6ZShzdHJ1Y3QgaWVlZTgwMjEx
X2RldmljZSAqaWVlZSkKIAlzdHJ1Y3QgcnhfdHNfcmVjb3JkICAgICAqcFJ4VFMgID0gaWVlZS0+
UnhUc1JlY29yZDsKIAlzdHJ1Y3QgcnhfcmVvcmRlcl9lbnRyeQkqcFJ4UmVvcmRlckVudHJ5ID0g
aWVlZS0+UnhSZW9yZGVyRW50cnk7CiAJdTgJCQkJY291bnQgPSAwOworCiAJSUVFRTgwMjExX0RF
QlVHKElFRUU4MDIxMV9ETF9UUywgIj09PT09PT09PT0+JXMoKVxuIiwgX19mdW5jX18pOwogCS8q
IEluaXRpYWxpemUgVHggVFMgcmVsYXRlZCBpbmZvLiAqLwogCUlOSVRfTElTVF9IRUFEKCZpZWVl
LT5UeF9UU19BZG1pdF9MaXN0KTsKQEAgLTIwNiw2ICsyMDcsNyBAQCBzdGF0aWMgc3RydWN0IHRz
X2NvbW1vbl9pbmZvICpTZWFyY2hBZG1pdFRSU3RyZWFtKHN0cnVjdCBpZWVlODAyMTFfZGV2aWNl
ICppZWVlLAogCWJvb2wJCQkJc2VhcmNoX2Rpcls0XSA9IHswfTsKIAlzdHJ1Y3QgbGlzdF9oZWFk
CQkqcHNlYXJjaF9saXN0OyAvKiBGSVhNRSAqLwogCXN0cnVjdCB0c19jb21tb25faW5mbwkqcFJl
dCA9IE5VTEw7CisKIAlpZiAoaWVlZS0+aXdfbW9kZSA9PSBJV19NT0RFX01BU1RFUikgeyAvKiBh
cCBtb2RlICovCiAJCWlmIChUeFJ4U2VsZWN0ID09IFRYX0RJUikgewogCQkJc2VhcmNoX2RpcltE
SVJfRE9XTl0gPSB0cnVlOwpAQCAtMjUxLDcgKzI1Myw3IEBAIHN0YXRpYyBzdHJ1Y3QgdHNfY29t
bW9uX2luZm8gKlNlYXJjaEFkbWl0VFJTdHJlYW0oc3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmll
ZWUsCiAJfQoKIAlpZiAoJnBSZXQtPmxpc3QgICE9IHBzZWFyY2hfbGlzdCkKLQkJcmV0dXJuIHBS
ZXQgOworCQlyZXR1cm4gcFJldDsKIAllbHNlCiAJCXJldHVybiBOVUxMOwogfQpAQCAtMzY3LDkg
KzM2OSwxMSBAQCBib29sIEdldFRzKAogCQkJCWxpc3RfZGVsX2luaXQoJigqcHBUUyktPmxpc3Qp
OwogCQkJCWlmIChUeFJ4U2VsZWN0ID09IFRYX0RJUikgewogCQkJCQlzdHJ1Y3QgdHhfdHNfcmVj
b3JkICp0bXAgPSBjb250YWluZXJfb2YoKnBwVFMsIHN0cnVjdCB0eF90c19yZWNvcmQsIHRzX2Nv
bW1vbl9pbmZvKTsKKwogCQkJCQlSZXNldFR4VHNFbnRyeSh0bXApOwogCQkJCX0gZWxzZSB7CiAJ
CQkJCXN0cnVjdCByeF90c19yZWNvcmQgKnRtcCA9IGNvbnRhaW5lcl9vZigqcHBUUywgc3RydWN0
IHJ4X3RzX3JlY29yZCwgdHNfY29tbW9uX2luZm8pOworCiAJCQkJCVJlc2V0UnhUc0VudHJ5KHRt
cCk7CiAJCQkJfQoKQEAgLTQwMyw2ICs0MDcsNyBAQCBzdGF0aWMgdm9pZCBSZW1vdmVUc0VudHJ5
KHN0cnVjdCBpZWVlODAyMTFfZGV2aWNlICppZWVlLCBzdHJ1Y3QgdHNfY29tbW9uX2luZm8gKgog
CQkJICBlbnVtIHRyX3NlbGVjdCBUeFJ4U2VsZWN0KQogewogCXVuc2lnbmVkIGxvbmcgZmxhZ3Mg
PSAwOworCiAJZGVsX3RpbWVyX3N5bmMoJnBUcy0+c2V0dXBfdGltZXIpOwogCWRlbF90aW1lcl9z
eW5jKCZwVHMtPmluYWN0X3RpbWVyKTsKIAlUc0luaXREZWxCQShpZWVlLCBwVHMsIFR4UnhTZWxl
Y3QpOwpAQCAtNDEwLDYgKzQxNSw3IEBAIHN0YXRpYyB2b2lkIFJlbW92ZVRzRW50cnkoc3RydWN0
IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIHN0cnVjdCB0c19jb21tb25faW5mbyAqCiAJaWYgKFR4
UnhTZWxlY3QgPT0gUlhfRElSKSB7CiAJCXN0cnVjdCByeF9yZW9yZGVyX2VudHJ5CSpwUnhSZW9y
ZGVyRW50cnk7CiAJCXN0cnVjdCByeF90c19yZWNvcmQgICAgICpwUnhUUyA9IChzdHJ1Y3Qgcnhf
dHNfcmVjb3JkICopcFRzOworCiAJCWlmICh0aW1lcl9wZW5kaW5nKCZwUnhUUy0+cnhfcGt0X3Bl
bmRpbmdfdGltZXIpKQogCQkJZGVsX3RpbWVyX3N5bmMoJnBSeFRTLT5yeF9wa3RfcGVuZGluZ190
aW1lcik7CgpAQCAtNDIwLDYgKzQyNiw3IEBAIHN0YXRpYyB2b2lkIFJlbW92ZVRzRW50cnkoc3Ry
dWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIHN0cnVjdCB0c19jb21tb25faW5mbyAqCiAJCQl7
CiAJCQkJaW50IGkgPSAwOwogCQkJCXN0cnVjdCBpZWVlODAyMTFfcnhiICpwcnhiID0gcFJ4UmVv
cmRlckVudHJ5LT5wcnhiOworCiAJCQkJaWYgKHVubGlrZWx5KCFwcnhiKSkgewogCQkJCQlzcGlu
X3VubG9ja19pcnFyZXN0b3JlKCYoaWVlZS0+cmVvcmRlcl9zcGlubG9jayksIGZsYWdzKTsKIAkJ
CQkJcmV0dXJuOwpAQCAtNDM2LDYgKzQ0Myw3IEBAIHN0YXRpYyB2b2lkIFJlbW92ZVRzRW50cnko
c3RydWN0IGllZWU4MDIxMV9kZXZpY2UgKmllZWUsIHN0cnVjdCB0c19jb21tb25faW5mbyAqCgog
CX0gZWxzZSB7CiAJCXN0cnVjdCB0eF90c19yZWNvcmQgKnBUeFRTID0gKHN0cnVjdCB0eF90c19y
ZWNvcmQgKilwVHM7CisKIAkJZGVsX3RpbWVyX3N5bmMoJnBUeFRTLT50c19hZGRfYmFfdGltZXIp
OwogCX0KIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9yODE5MlVfZG0u
YyBiL2RyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9yODE5MlVfZG0uYwppbmRleCA1MWRhYjA4NjNi
ODYuLjJjZTU4N2UyN2YzYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L3I4
MTkyVV9kbS5jCisrKyBiL2RyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9yODE5MlVfZG0uYwpAQCAt
MTQyLDIxICsxNDIsNiBAQCB2b2lkIGRtX0NoZWNrUnhBZ2dyZWdhdGlvbihzdHJ1Y3QgbmV0X2Rl
dmljZSAqZGV2KQogCXVuc2lnbmVkIGxvbmcJCWN1clR4T2tDbnQgPSAwOwogCXVuc2lnbmVkIGxv
bmcJCWN1clJ4T2tDbnQgPSAwOwoKLS8qCi0JaWYgKHBIYWxEYXRhLT5iRm9yY2VkVXNiUnhBZ2dy
KSB7Ci0JCWlmIChwSGFsRGF0YS0+Rm9yY2VkVXNiUnhBZ2dySW5mbyA9PSAwKSB7Ci0JCQlpZiAo
cEhhbERhdGEtPmJDdXJyZW50UnhBZ2dyRW5hYmxlKSB7Ci0JCQkJQWRhcHRlci0+SGFsRnVuYy5I
YWxVc2JSeEFnZ3JIYW5kbGVyKEFkYXB0ZXIsIEZBTFNFKTsKLQkJCX0KLQkJfSBlbHNlIHsKLQkJ
CWlmICghcEhhbERhdGEtPmJDdXJyZW50UnhBZ2dyRW5hYmxlIHx8IChwSGFsRGF0YS0+Rm9yY2Vk
VXNiUnhBZ2dySW5mbyAhPSBwSGFsRGF0YS0+TGFzdFVzYlJ4QWdnckluZm9TZXR0aW5nKSkgewot
CQkJCUFkYXB0ZXItPkhhbEZ1bmMuSGFsVXNiUnhBZ2dySGFuZGxlcihBZGFwdGVyLCBUUlVFKTsK
LQkJCX0KLQkJfQotCQlyZXR1cm47Ci0JfQotCi0qLwogCWN1clR4T2tDbnQgPSBwcml2LT5zdGF0
cy50eGJ5dGVzdW5pY2FzdCAtIGxhc3RUeE9rQ250OwogCWN1clJ4T2tDbnQgPSBwcml2LT5zdGF0
cy5yeGJ5dGVzdW5pY2FzdCAtIGxhc3RSeE9rQ250OwoKQEAgLTMzMyw3ICszMTgsNiBAQCBzdGF0
aWMgdm9pZCBkbV9jaGVja19yYXRlX2FkYXB0aXZlKHN0cnVjdCBuZXRfZGV2aWNlICpkZXYpCiAJ
CSAqIHRpbWUgdG8gbGluayB3aXRoIEFQLiBXZSB3aWxsIG5vdCBjaGFuZ2UgdXBwZXIvbG93ZXIg
dGhyZXNob2xkLiBJZgogCQkgKiBTVEEgc3RheSBpbiBoaWdoIG9yIGxvdyBsZXZlbCwgd2UgbXVz
dCBjaGFuZ2UgdHdvIGRpZmZlcmVudCB0aHJlc2hvbGQKIAkJICogdG8gcHJldmVudCBqdW1waW5n
IGZyZXF1ZW50bHkuCi0JCSAqCiAJCSAqLwogCQlpZiAocHJhLT5yYXRyX3N0YXRlID09IERNX1JB
VFJfU1RBX0hJR0gpIHsKIAkJCUhpZ2hSU1NJVGhyZXNoRm9yUkEJPSBwcmEtPmhpZ2gybG93X3Jz
c2lfdGhyZXNoX2Zvcl9yYTsKQEAgLTcwOCw5ICs2OTIsNiBAQCBzdGF0aWMgdm9pZCBkbV9UWFBv
d2VyVHJhY2tpbmdDYWxsYmFja19UaGVybWFsTWV0ZXIoc3RydWN0IG5ldF9kZXZpY2UgKmRldikK
IAkJfQogCQl0bXBDQ0s0ME1pbmRleCA9IDA7CiAJfQotCS8qRGJnUHJpbnQoIiVkZGIsIHRtcE9G
RE1pbmRleCA9ICVkLCB0bXBDQ0syME1pbmRleCA9ICVkLCB0bXBDQ0s0ME1pbmRleCA9ICVkIiwK
LQkJKCh1MUJ5dGUpdG1wUmVnQSAtIHBIYWxEYXRhLT5UaGVybWFsTWV0ZXJbMF0pLAotCQl0bXBP
RkRNaW5kZXgsIHRtcENDSzIwTWluZGV4LCB0bXBDQ0s0ME1pbmRleCk7Ki8KIAlpZiAocHJpdi0+
Q3VycmVudENoYW5uZWxCVyAhPSBIVF9DSEFOTkVMX1dJRFRIXzIwKQkvKiA0ME0gKi8KIAkJdG1w
Q0NLaW5kZXggPSB0bXBDQ0s0ME1pbmRleDsKIAllbHNlCkBAIC0xMzA0LDYgKzEyODUsNyBAQCBz
dGF0aWMgdm9pZCBkbV9DaGVja1RYUG93ZXJUcmFja2luZ19UaGVybWFsTWV0ZXIoc3RydWN0IG5l
dF9kZXZpY2UgKmRldikKIHsKIAlzdHJ1Y3QgcjgxOTJfcHJpdiAqcHJpdiA9IGllZWU4MDIxMV9w
cml2KGRldik7CiAJc3RhdGljIHU4CVRNX1RyaWdnZXI7CisKIAlpZiAoIXByaXYtPmJ0eHBvd2Vy
X3RyYWNraW5nKQogCQlyZXR1cm47CiAJaWYgKHByaXYtPnR4cG93ZXJfY291bnQgIDw9IDIpIHsK
QEAgLTE2ODAsOSArMTY2Miw2IEBAIHN0YXRpYyB2b2lkIGRtX2N0cmxfaW5pdGdhaW5fYnlyc3Np
X2J5X2RyaXZlcnJzc2koCiAJZWxzZQogCQlkbV9kaWd0YWJsZS5jdXJfY29ubmVjdF9zdGF0ZSA9
IERJR19ESVNDT05ORUNUOwoKLQkvKkRiZ1ByaW50KCJETV9EaWdUYWJsZS5QcmVDb25uZWN0U3Rh
dGUgPSAlZCwgRE1fRGlnVGFibGUuQ3VyQ29ubmVjdFN0YXRlID0gJWRcbiIsCi0JCURNX0RpZ1Rh
YmxlLlByZUNvbm5lY3RTdGF0ZSwgRE1fRGlnVGFibGUuQ3VyQ29ubmVjdFN0YXRlKTsqLwotCiAJ
ZG1fZGlndGFibGUucnNzaV92YWwgPSBwcml2LT51bmRlY29yYXRlZF9zbW9vdGhlZF9wd2RiOwog
CWRtX2luaXRpYWxfZ2FpbihkZXYpOwogCWRtX3BkX3RoKGRldik7CkBAIC0xNzU0LDEyICsxNzMz
LDYgQEAgc3RhdGljIHZvaWQgZG1fY3RybF9pbml0Z2Fpbl9ieXJzc2lfYnlfZndmYWxzZV9hbGFy
bSgKIAkJCSAqIDIwMDgvMDIvMDUgTUggU0QzLUplcnJ5IDkyVS85MkUgUERfVEggYXJlIHRoZSBz
YW1lLgogCQkJICovCiAJCQl3cml0ZV9uaWNfYnl0ZShkZXYsIChyT0ZETTBfWEFUeEFGRSszKSwg
MHgwMCk7Ci0JCQkvKmVsc2UgaWYgKHByaXYtPmNhcmRfODE5MiA9PSBIQVJEV0FSRV9UWVBFX1JU
TDgxOTBQKQotCQkJCXdyaXRlX25pY19ieXRlKHBBZGFwdGVyLCByT0ZETTBfUnhEZXRlY3RvcjEs
IDB4NDApOwotCQkJZWxzZSBpZiAocEFkYXB0ZXItPkhhcmR3YXJlVHlwZSA9PSBIQVJEV0FSRV9U
WVBFX1JUTDgxOTJFKQotCQkJZWxzZQotCQkJCVBsYXRmb3JtRUZJT1dyaXRlMUJ5dGUocEFkYXB0
ZXIsIHJPRkRNMF9SeERldGVjdG9yMSwgMHg0MCk7Ci0JCQkqLwogCQl9IGVsc2UKIAkJCXdyaXRl
X25pY19ieXRlKGRldiwgck9GRE0wX1J4RGV0ZWN0b3IxLCAweDQyKTsKCkBAIC0xODE0LDEzICsx
Nzg3LDYgQEAgc3RhdGljIHZvaWQgZG1fY3RybF9pbml0Z2Fpbl9ieXJzc2lfYnlfZndmYWxzZV9h
bGFybSgKIAkJCSAqIDIwMDgvMDIvMDUgTUggU0QzLUplcnJ5IDkyVS85MkUgUERfVEggYXJlIHRo
ZSBzYW1lLgogCQkJICovCiAJCQl3cml0ZV9uaWNfYnl0ZShkZXYsIChyT0ZETTBfWEFUeEFGRSsz
KSwgMHgyMCk7Ci0JCQkvKgotCQkJZWxzZSBpZiAocHJpdi0+Y2FyZF84MTkyID09IEhBUkRXQVJF
X1RZUEVfUlRMODE5MFApCi0JCQkJd3JpdGVfbmljX2J5dGUoZGV2LCByT0ZETTBfUnhEZXRlY3Rv
cjEsIDB4NDIpOwotCQkJZWxzZSBpZiAocEFkYXB0ZXItPkhhcmR3YXJlVHlwZSA9PSBIQVJEV0FS
RV9UWVBFX1JUTDgxOTJFKQotCQkJZWxzZQotCQkJCVBsYXRmb3JtRUZJT1dyaXRlMUJ5dGUocEFk
YXB0ZXIsIHJPRkRNMF9SeERldGVjdG9yMSwgMHg0Mik7Ci0JCQkqLwogCQl9IGVsc2UKIAkJCXdy
aXRlX25pY19ieXRlKGRldiwgck9GRE0wX1J4RGV0ZWN0b3IxLCAweDQ0KTsKCkBAIC0xODg3LDEw
ICsxODUzLDYgQEAgc3RhdGljIHZvaWQgZG1fY3RybF9pbml0Z2Fpbl9ieXJzc2lfaGlnaHB3cigK
IAkJaWYgKHByaXYtPkN1cnJlbnRDaGFubmVsQlcgIT0gSFRfQ0hBTk5FTF9XSURUSF8yMCkgewog
CQkJd3JpdGVfbmljX2J5dGUoZGV2LCAock9GRE0wX1hBVHhBRkUrMyksIDB4MTApOwoKLQkJCS8q
ZWxzZSBpZiAocHJpdi0+Y2FyZF84MTkyID09IEhBUkRXQVJFX1RZUEVfUlRMODE5MFApCi0JCQkJ
d3JpdGVfbmljX2J5dGUoZGV2LCByT0ZETTBfUnhEZXRlY3RvcjEsIDB4NDEpOwotCQkJKi8KLQog
CQl9IGVsc2UKIAkJCXdyaXRlX25pY19ieXRlKGRldiwgck9GRE0wX1J4RGV0ZWN0b3IxLCAweDQz
KTsKIAl9IGVsc2UgewpAQCAtMTkwNCwxMCArMTg2Niw2IEBAIHN0YXRpYyB2b2lkIGRtX2N0cmxf
aW5pdGdhaW5fYnlyc3NpX2hpZ2hwd3IoCiAJCQkvKiAgMy4yIFJlY292ZXIgUERfVEggZm9yIE9G
RE0gZm9yIG5vcm1hbCBwb3dlciByZWdpb24uICovCiAJCQlpZiAocHJpdi0+Q3VycmVudENoYW5u
ZWxCVyAhPSBIVF9DSEFOTkVMX1dJRFRIXzIwKSB7CiAJCQkJd3JpdGVfbmljX2J5dGUoZGV2LCAo
ck9GRE0wX1hBVHhBRkUrMyksIDB4MjApOwotCQkJCS8qZWxzZSBpZiAocHJpdi0+Y2FyZF84MTky
ID09IEhBUkRXQVJFX1RZUEVfUlRMODE5MFApCi0JCQkJCXdyaXRlX25pY19ieXRlKGRldiwgck9G
RE0wX1J4RGV0ZWN0b3IxLCAweDQyKTsKLQkJCQkqLwotCiAJCQl9IGVsc2UKIAkJCQl3cml0ZV9u
aWNfYnl0ZShkZXYsIHJPRkRNMF9SeERldGVjdG9yMSwgMHg0NCk7CiAJCX0KQEAgLTIwMjMsOSAr
MTk4MSw2IEBAIHN0YXRpYyB2b2lkIGRtX3BkX3RoKAogCQkJCQkgKiAyMDA4LzAyLzA1IE1IIFNE
My1KZXJyeSA5MlUvOTJFIFBEX1RIIGFyZSB0aGUgc2FtZS4KIAkJCQkJICovCiAJCQkJCXdyaXRl
X25pY19ieXRlKGRldiwgKHJPRkRNMF9YQVR4QUZFKzMpLCAweDAwKTsKLQkJCQkJLyplbHNlIGlm
IChwcml2LT5jYXJkXzgxOTIgPT0gSEFSRFdBUkVfVFlQRV9SVEw4MTkwUCkKLQkJCQkJCXdyaXRl
X25pY19ieXRlKGRldiwgck9GRE0wX1J4RGV0ZWN0b3IxLCAweDQwKTsKLQkJCQkJKi8KIAkJCQl9
IGVsc2UKIAkJCQkJd3JpdGVfbmljX2J5dGUoZGV2LCByT0ZETTBfUnhEZXRlY3RvcjEsIDB4NDIp
OwogCQkJfSBlbHNlIGlmIChkbV9kaWd0YWJsZS5jdXJwZF90aHN0YXRlID09IERJR19QRF9BVF9O
T1JNQUxfUE9XRVIpIHsKQEAgLTIwMzYsMTggKzE5OTEsMTIgQEAgc3RhdGljIHZvaWQgZG1fcGRf
dGgoCiAJCQkJCSAqIDIwMDgvMDIvMDUgTUggU0QzLUplcnJ5IDkyVS85MkUgUERfVEggYXJlIHRo
ZSBzYW1lLgogCQkJCQkgKi8KIAkJCQkJd3JpdGVfbmljX2J5dGUoZGV2LCAock9GRE0wX1hBVHhB
RkUrMyksIDB4MjApOwotCQkJCQkvKmVsc2UgaWYgKHByaXYtPmNhcmRfODE5MiA9PSBIQVJEV0FS
RV9UWVBFX1JUTDgxOTBQKQotCQkJCQkJd3JpdGVfbmljX2J5dGUoZGV2LCByT0ZETTBfUnhEZXRl
Y3RvcjEsIDB4NDIpOwotCQkJCQkqLwogCQkJCX0gZWxzZQogCQkJCQl3cml0ZV9uaWNfYnl0ZShk
ZXYsIHJPRkRNMF9SeERldGVjdG9yMSwgMHg0NCk7CiAJCQl9IGVsc2UgaWYgKGRtX2RpZ3RhYmxl
LmN1cnBkX3Roc3RhdGUgPT0gRElHX1BEX0FUX0hJR0hfUE9XRVIpIHsKIAkJCQkvKiBIaWdoZXIg
UERfVEggZm9yIE9GRE0gZm9yIGhpZ2ggcG93ZXIgc3RhdGUuICovCiAJCQkJaWYgKHByaXYtPkN1
cnJlbnRDaGFubmVsQlcgIT0gSFRfQ0hBTk5FTF9XSURUSF8yMCkgewogCQkJCQl3cml0ZV9uaWNf
Ynl0ZShkZXYsIChyT0ZETTBfWEFUeEFGRSszKSwgMHgxMCk7Ci0JCQkJCS8qZWxzZSBpZiAocHJp
di0+Y2FyZF84MTkyID09IEhBUkRXQVJFX1RZUEVfUlRMODE5MFApCi0JCQkJCQl3cml0ZV9uaWNf
Ynl0ZShkZXYsIHJPRkRNMF9SeERldGVjdG9yMSwgMHg0MSk7Ci0JCQkJCSovCiAJCQkJfSBlbHNl
CiAJCQkJCXdyaXRlX25pY19ieXRlKGRldiwgck9GRE0wX1J4RGV0ZWN0b3IxLCAweDQzKTsKIAkJ
CX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9yODE5MlVfaHcuaCBiL2Ry
aXZlcnMvc3RhZ2luZy9ydGw4MTkydS9yODE5MlVfaHcuaAppbmRleCA3OWQ0NjI4OTRmMWQuLjFl
NWE5YzgxNzg4YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L3I4MTkyVV9o
dy5oCisrKyBiL2RyaXZlcnMvc3RhZ2luZy9ydGw4MTkydS9yODE5MlVfaHcuaApAQCAtODcsNyAr
ODcsNyBAQCBlbnVtIF9SVEw4MTkyVXNiX0hXIHsKICNkZWZpbmUgUlhfRklGT19USFJFU0hPTERf
TUFTSyAoQklUKDEzKSB8IEJJVCgxNCkgfCBCSVQoMTUpKQogI2RlZmluZSBSWF9GSUZPX1RIUkVT
SE9MRF9TSElGVCAxMwogI2RlZmluZSBSWF9GSUZPX1RIUkVTSE9MRF9OT05FIDcKLSNkZWZpbmUg
TUFYX1JYX0RNQV9NQVNLIAkoQklUKDgpIHwgQklUKDkpIHwgQklUKDEwKSkKKyNkZWZpbmUgTUFY
X1JYX0RNQV9NQVNLCQkoQklUKDgpIHwgQklUKDkpIHwgQklUKDEwKSkKICNkZWZpbmUgUkNSX01Y
RE1BX09GRlNFVAk4CiAjZGVmaW5lIFJDUl9GSUZPX09GRlNFVAkJMTMKICNkZWZpbmUgUkNSX09O
TFlFUkxQS1QJCUJJVCgzMSkJCQkvKiBFYXJseSBSZWNlaXZpbmcgYmFzZWQgb24gUGFja2V0IFNp
emUuICovCkBAIC0yMjUsMTMgKzIyNSwxMyBAQCBlbnVtIF9SVEw4MTkyVXNiX0hXIHsKICNkZWZp
bmUJUkFUUl9NQ1MxNAkJMHgwNDAwMDAwMAogI2RlZmluZQlSQVRSX01DUzE1CQkweDA4MDAwMDAw
CiAvKiBBTEwgQ0NLIFJhdGUgKi8KLSNkZWZpbmUgUkFURV9BTExfQ0NLCQlSQVRSXzFNfFJBVFJf
Mk18UkFUUl81NU18UkFUUl8xMU0KLSNkZWZpbmUgUkFURV9BTExfT0ZETV9BRwlSQVRSXzZNfFJB
VFJfOU18UkFUUl8xMk18UkFUUl8xOE18UkFUUl8yNE1cCi0JCQkJCQkJfFJBVFJfMzZNfFJBVFJf
NDhNfFJBVFJfNTRNCi0jZGVmaW5lIFJBVEVfQUxMX09GRE1fMVNTCVJBVFJfTUNTMHxSQVRSX01D
UzF8UkFUUl9NQ1MyfFJBVFJfTUNTMyB8IFwKLQkJCQkJCQlSQVRSX01DUzR8UkFUUl9NQ1M1fFJB
VFJfTUNTNnxSQVRSX01DUzcKLSNkZWZpbmUgUkFURV9BTExfT0ZETV8yU1MJUkFUUl9NQ1M4fFJB
VFJfTUNTOQl8UkFUUl9NQ1MxMHxSQVRSX01DUzExfCBcCi0JCQkJCQkJUkFUUl9NQ1MxMnxSQVRS
X01DUzEzfFJBVFJfTUNTMTR8UkFUUl9NQ1MxNQorI2RlZmluZSBSQVRFX0FMTF9DQ0sJCShSQVRS
XzFNfFJBVFJfMk18UkFUUl81NU18UkFUUl8xMU0pCisjZGVmaW5lIFJBVEVfQUxMX09GRE1fQUcJ
KFJBVFJfNk18UkFUUl85TXxSQVRSXzEyTXxSQVRSXzE4TXxSQVRSXzI0TVwKKwkJCQkJCXxSQVRS
XzM2TXxSQVRSXzQ4TXxSQVRSXzU0TSkKKyNkZWZpbmUgUkFURV9BTExfT0ZETV8xU1MJKFJBVFJf
TUNTMHxSQVRSX01DUzF8UkFUUl9NQ1MyfFJBVFJfTUNTM1wKKwkJCQkJCXxSQVRSX01DUzR8UkFU
Ul9NQ1M1fFJBVFJfTUNTNnxSQVRSX01DUzcpCisjZGVmaW5lIFJBVEVfQUxMX09GRE1fMlNTCShS
QVRSX01DUzh8UkFUUl9NQ1M5fFJBVFJfTUNTMTB8UkFUUl9NQ1MxMVwKKwkJCQkJCXxSQVRSX01D
UzEyfFJBVFJfTUNTMTN8UkFUUl9NQ1MxNHxSQVRSX01DUzE1KQoKIAlFUFJPTV9DTUQJCT0gMHhm
ZTU4LAogI2RlZmluZSBDbWQ5MzQ2Q1JfOTM1NlNFTAlCSVQoNCkKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvc3RhZ2luZy9ydGw4MTkydS9yODE5MlVfd3guYyBiL2RyaXZlcnMvc3RhZ2luZy9ydGw4MTky
dS9yODE5MlVfd3guYwppbmRleCA4Mzk2NzFjYzdmOTYuLjI0YzExOTc2ZWE2MSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L3I4MTkyVV93eC5jCisrKyBiL2RyaXZlcnMvc3Rh
Z2luZy9ydGw4MTkydS9yODE5MlVfd3guYwpAQCAtNDcwLDYgKzQ3MCw3IEBAIHN0YXRpYyBpbnQg
cjgxOTJfd3hfc2V0X3dhcChzdHJ1Y3QgbmV0X2RldmljZSAqZGV2LAoKIAlpbnQgcmV0OwogCXN0
cnVjdCByODE5Ml9wcml2ICpwcml2ID0gaWVlZTgwMjExX3ByaXYoZGV2KTsKKwogCW11dGV4X2xv
Y2soJnByaXYtPnd4X211dGV4KTsKCiAJcmV0ID0gaWVlZTgwMjExX3d4X3NldF93YXAocHJpdi0+
aWVlZTgwMjExLCBpbmZvLCBhd3JxLCBleHRyYSk7CkBAIC03NTEsNyArNzUyLDcgQEAgc3RhdGlj
IGludCByODE5Ml93eF9zZXRfZW5jX2V4dChzdHJ1Y3QgbmV0X2RldmljZSAqZGV2LAogCQkJaWR4
LS07CiAJCWdyb3VwID0gZXh0LT5leHRfZmxhZ3MgJiBJV19FTkNPREVfRVhUX0dST1VQX0tFWTsK
Ci0JCWlmICgoIWdyb3VwKSB8fCAoSVdfTU9ERV9BREhPQyA9PSBpZWVlLT5pd19tb2RlKSB8fCAo
YWxnID09ICBLRVlfVFlQRV9XRVA0MCkpIHsKKwkJaWYgKCghZ3JvdXApIHx8IChpZWVlLT5pd19t
b2RlID09IElXX01PREVfQURIT0MpIHx8IChhbGcgPT0gIEtFWV9UWVBFX1dFUDQwKSkgewogCQkJ
aWYgKChleHQtPmtleV9sZW4gPT0gMTMpICYmIChhbGcgPT0gS0VZX1RZUEVfV0VQNDApKQogCQkJ
CWFsZyA9IEtFWV9UWVBFX1dFUDEwNDsKIAkJCWllZWUtPnBhaXJ3aXNlX2tleV90eXBlID0gYWxn
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L3I4MTl4VV9maXJtd2FyZS5j
IGIvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L3I4MTl4VV9maXJtd2FyZS5jCmluZGV4IDBlNDdi
NWY3NTY5NS4uYjE2ZjFhMTAyYzg5IDEwMDY0NAotLS0gYS9kcml2ZXJzL3N0YWdpbmcvcnRsODE5
MnUvcjgxOXhVX2Zpcm13YXJlLmMKKysrIGIvZHJpdmVycy9zdGFnaW5nL3J0bDgxOTJ1L3I4MTl4
VV9maXJtd2FyZS5jCkBAIC0yMzIsNyArMjMyLDcgQEAgYm9vbCBpbml0X2Zpcm13YXJlKHN0cnVj
dCBuZXRfZGV2aWNlICpkZXYpCiAJCXJzdF9vcHQgPSBPUFRfRklSTVdBUkVfUkVTRVQ7CiAJCXN0
YXJ0aW5nX3N0YXRlID0gRldfSU5JVF9TVEVQMl9EQVRBOwogCX0gZWxzZSB7Ci0JCSBSVF9UUkFD
RShDT01QX0ZJUk1XQVJFLCAiUGxhdGZvcm1Jbml0RmlybXdhcmU6IHVuZGVmaW5lZCBmaXJtd2Fy
ZSBzdGF0ZVxuIik7CisJCVJUX1RSQUNFKENPTVBfRklSTVdBUkUsICJQbGF0Zm9ybUluaXRGaXJt
d2FyZTogdW5kZWZpbmVkIGZpcm13YXJlIHN0YXRlXG4iKTsKIAl9CgogCS8qCi0tCjIuMTcuMQoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZGV2ZWwgbWFp
bGluZyBsaXN0CmRldmVsQGxpbnV4ZHJpdmVycHJvamVjdC5vcmcKaHR0cDovL2RyaXZlcmRldi5s
aW51eGRyaXZlcnByb2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8vZHJpdmVyZGV2LWRldmVsCg==

