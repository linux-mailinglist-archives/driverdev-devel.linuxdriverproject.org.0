Return-Path: <driverdev-devel-bounces@linuxdriverproject.org>
X-Original-To: lists+driverdev-devel@lfdr.de
Delivered-To: lists+driverdev-devel@lfdr.de
Received: from hemlock.osuosl.org (smtp2.osuosl.org [140.211.166.133])
	by mail.lfdr.de (Postfix) with ESMTPS id 1BABC158CC3
	for <lists+driverdev-devel@lfdr.de>; Tue, 11 Feb 2020 11:35:15 +0100 (CET)
Received: from localhost (localhost [127.0.0.1])
	by hemlock.osuosl.org (Postfix) with ESMTP id 3DBDA8778F;
	Tue, 11 Feb 2020 10:35:13 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from hemlock.osuosl.org ([127.0.0.1])
	by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id E6TWq865S-x8; Tue, 11 Feb 2020 10:35:13 +0000 (UTC)
Received: from ash.osuosl.org (ash.osuosl.org [140.211.166.34])
	by hemlock.osuosl.org (Postfix) with ESMTP id 14F108768B;
	Tue, 11 Feb 2020 10:35:12 +0000 (UTC)
X-Original-To: devel@linuxdriverproject.org
Delivered-To: driverdev-devel@osuosl.org
Received: from fraxinus.osuosl.org (smtp4.osuosl.org [140.211.166.137])
 by ash.osuosl.org (Postfix) with ESMTP id 7D2AC1BF831
 for <devel@linuxdriverproject.org>; Tue, 11 Feb 2020 10:35:07 +0000 (UTC)
Received: from localhost (localhost [127.0.0.1])
 by fraxinus.osuosl.org (Postfix) with ESMTP id 7A46585552
 for <devel@linuxdriverproject.org>; Tue, 11 Feb 2020 10:35:07 +0000 (UTC)
X-Virus-Scanned: amavisd-new at osuosl.org
Received: from fraxinus.osuosl.org ([127.0.0.1])
 by localhost (.osuosl.org [127.0.0.1]) (amavisd-new, port 10024)
 with ESMTP id HP-3UW9HxHVT for <devel@linuxdriverproject.org>;
 Tue, 11 Feb 2020 10:35:06 +0000 (UTC)
X-Greylist: from auto-whitelisted by SQLgrey-1.7.6
Received: from rere.qmqm.pl (rere.qmqm.pl [91.227.64.183])
 by fraxinus.osuosl.org (Postfix) with ESMTPS id AEE1A85566
 for <devel@driverdev.osuosl.org>; Tue, 11 Feb 2020 10:35:05 +0000 (UTC)
Received: from remote.user (localhost [127.0.0.1])
 by rere.qmqm.pl (Postfix) with ESMTPSA id 48Gzg94jdqzC7;
 Tue, 11 Feb 2020 11:35:01 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=rere.qmqm.pl; s=1;
 t=1581417301; bh=gsI64DD1kNeK+TXxunWfPL4x93Hi8VLx1d+WlAIlPgE=;
 h=Date:In-Reply-To:References:From:Subject:To:Cc:From;
 b=GX/TfeW0mldC+XmYLfwocJWvzPuONFxy6JTFHHhauhWhlMHI2lK5bZxM6h0+zcA4N
 whoGDhAgD9ECfey8Ui/9fWsOUhxU2DJvExM9YZBm9/k5XM3CFK7skhClvGJ2GTAtC9
 8rWdTKnxqpLXZs1fLDiuFQpsoRP/qXt8gXieu6izZjXtosl43Htk1OvUiiqcCcmKrM
 tDVSvBNG78SBC0cIUSgoq5CJ+8ISfpDJoj8NJlAkFMP7cAs82K42As5BjGQ91VqDwp
 m3Ij5p2Ek9m3CfIlNo6iBjp2p8I2Vpt7zcl0oCvZXwF4hUReeQg+KV4uS6l9iCBcQY
 ZR8sw4VsNdt+w==
X-Virus-Status: Clean
X-Virus-Scanned: clamav-milter 0.102.1 at mail
Date: Tue, 11 Feb 2020 11:35:01 +0100
Message-Id: <f0c66cbb3110c2736cd4357c753fba8c14ee3aee.1581416843.git.mirq-linux@rere.qmqm.pl>
In-Reply-To: <cover.1581416843.git.mirq-linux@rere.qmqm.pl>
References: <cover.1581416843.git.mirq-linux@rere.qmqm.pl>
From: =?UTF-8?q?Micha=C5=82=20Miros=C5=82aw?= <mirq-linux@rere.qmqm.pl>
Subject: [PATCH v2 1/6] staging: wfx: fix init/remove vs IRQ race
MIME-Version: 1.0
To: =?UTF-8?B?SsOpcsO0bWU=?= Pouiller <jerome.pouiller@silabs.com>,
 Greg Kroah-Hartman <gregkh@linuxfoundation.org>
X-BeenThere: driverdev-devel@linuxdriverproject.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Linux Driver Project Developer List
 <driverdev-devel.linuxdriverproject.org>
List-Unsubscribe: <http://driverdev.linuxdriverproject.org/mailman/options/driverdev-devel>, 
 <mailto:driverdev-devel-request@linuxdriverproject.org?subject=unsubscribe>
List-Archive: <http://driverdev.linuxdriverproject.org/pipermail/driverdev-devel/>
List-Post: <mailto:driverdev-devel@linuxdriverproject.org>
List-Help: <mailto:driverdev-devel-request@linuxdriverproject.org?subject=help>
List-Subscribe: <http://driverdev.linuxdriverproject.org/mailman/listinfo/driverdev-devel>, 
 <mailto:driverdev-devel-request@linuxdriverproject.org?subject=subscribe>
Cc: devel@driverdev.osuosl.org, linux-kernel@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: driverdev-devel-bounces@linuxdriverproject.org
Sender: "devel" <driverdev-devel-bounces@linuxdriverproject.org>

Q3VycmVudCBjb2RlIHJhY2VzIGluIGluaXQvZXhpdCB3aXRoIGludGVycnVwdCBoYW5kbGVycy4g
VGhpcyBpcyBub3RpY2VkCmJ5IHRoZSB3YXJuaW5nIGJlbG93LiBGaXggaXQgYnkgdXNpbmcgZGV2
cmVzIGZvciBvcmRlcmluZyBhbGxvY2F0aW9ucyBhbmQKSVJRIGRlL3JlZ2lzdHJhdGlvbi4KCldB
Uk5JTkc6IENQVTogMCBQSUQ6IDgyNyBhdCBkcml2ZXJzL3N0YWdpbmcvd2Z4L2J1c19zcGkuYzox
NDIgd2Z4X3NwaV9pcnFfaGFuZGxlcisweDVjLzB4NjQgW3dmeF0KcmFjZSBjb25kaXRpb24gaW4g
ZHJpdmVyIGluaXQvZGVpbml0CgpDYzogc3RhYmxlQHZnZXIua2VybmVsLm9yZwpGaXhlczogMDA5
NjIxNGE1OWE3ICgic3RhZ2luZzogd2Z4OiBhZGQgc3VwcG9ydCBmb3IgSS9PIGFjY2VzcyIpClNp
Z25lZC1vZmYtYnk6IE1pY2hhxYIgTWlyb3PFgmF3IDxtaXJxLWxpbnV4QHJlcmUucW1xbS5wbD4K
LS0tCnYyOiB1c2UgZGV2cmVzIHRvIGZpeCB0aGUgcmFjZXMKLS0tCiBkcml2ZXJzL3N0YWdpbmcv
d2Z4L2J1c19zZGlvLmMgfCAxNSArKysrKystLS0tLS0tLS0KIGRyaXZlcnMvc3RhZ2luZy93Zngv
YnVzX3NwaS5jICB8IDI3ICsrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLQogZHJpdmVycy9zdGFn
aW5nL3dmeC9tYWluLmMgICAgIHwgMjEgKysrKysrKysrKysrKy0tLS0tLS0tCiBkcml2ZXJzL3N0
YWdpbmcvd2Z4L21haW4uaCAgICAgfCAgMSAtCiA0IGZpbGVzIGNoYW5nZWQsIDMzIGluc2VydGlv
bnMoKyksIDMxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvc3RhZ2luZy93Zngv
YnVzX3NkaW8uYyBiL2RyaXZlcnMvc3RhZ2luZy93ZngvYnVzX3NkaW8uYwppbmRleCBmODkwMTE2
NGMyMDYuLjU0NTBiZDVlMWI1ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9zdGFnaW5nL3dmeC9idXNf
c2Rpby5jCisrKyBiL2RyaXZlcnMvc3RhZ2luZy93ZngvYnVzX3NkaW8uYwpAQCAtMjAwLDI1ICsy
MDAsMjMgQEAgc3RhdGljIGludCB3Znhfc2Rpb19wcm9iZShzdHJ1Y3Qgc2Rpb19mdW5jICpmdW5j
LAogCWlmIChyZXQpCiAJCWdvdG8gZXJyMDsKIAotCXJldCA9IHdmeF9zZGlvX2lycV9zdWJzY3Jp
YmUoYnVzKTsKLQlpZiAocmV0KQotCQlnb3RvIGVycjE7Ci0KIAlidXMtPmNvcmUgPSB3ZnhfaW5p
dF9jb21tb24oJmZ1bmMtPmRldiwgJndmeF9zZGlvX3BkYXRhLAogCQkJCSAgICAmd2Z4X3NkaW9f
aHdidXNfb3BzLCBidXMpOwogCWlmICghYnVzLT5jb3JlKSB7CiAJCXJldCA9IC1FSU87Ci0JCWdv
dG8gZXJyMjsKKwkJZ290byBlcnIxOwogCX0KIAorCXJldCA9IHdmeF9zZGlvX2lycV9zdWJzY3Jp
YmUoYnVzKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycjE7CisKIAlyZXQgPSB3ZnhfcHJvYmUoYnVz
LT5jb3JlKTsKIAlpZiAocmV0KQotCQlnb3RvIGVycjM7CisJCWdvdG8gZXJyMjsKIAogCXJldHVy
biAwOwogCi1lcnIzOgotCXdmeF9mcmVlX2NvbW1vbihidXMtPmNvcmUpOwogZXJyMjoKIAl3Znhf
c2Rpb19pcnFfdW5zdWJzY3JpYmUoYnVzKTsKIGVycjE6CkBAIC0yMzQsNyArMjMyLDYgQEAgc3Rh
dGljIHZvaWQgd2Z4X3NkaW9fcmVtb3ZlKHN0cnVjdCBzZGlvX2Z1bmMgKmZ1bmMpCiAJc3RydWN0
IHdmeF9zZGlvX3ByaXYgKmJ1cyA9IHNkaW9fZ2V0X2RydmRhdGEoZnVuYyk7CiAKIAl3ZnhfcmVs
ZWFzZShidXMtPmNvcmUpOwotCXdmeF9mcmVlX2NvbW1vbihidXMtPmNvcmUpOwogCXdmeF9zZGlv
X2lycV91bnN1YnNjcmliZShidXMpOwogCXNkaW9fY2xhaW1faG9zdChmdW5jKTsKIAlzZGlvX2Rp
c2FibGVfZnVuYyhmdW5jKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvc3RhZ2luZy93ZngvYnVzX3Nw
aS5jIGIvZHJpdmVycy9zdGFnaW5nL3dmeC9idXNfc3BpLmMKaW5kZXggNDBiYzMzMDM1ZGUyLi42
MDVhZDc0MDY4YjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvc3RhZ2luZy93ZngvYnVzX3NwaS5jCisr
KyBiL2RyaXZlcnMvc3RhZ2luZy93ZngvYnVzX3NwaS5jCkBAIC0xNTQsNiArMTU0LDExIEBAIHN0
YXRpYyB2b2lkIHdmeF9zcGlfcmVxdWVzdF9yeChzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJ
d2Z4X2JoX3JlcXVlc3RfcngoYnVzLT5jb3JlKTsKIH0KIAorc3RhdGljIHZvaWQgd2Z4X2ZsdXNo
X2lycV93b3JrKHZvaWQgKncpCit7CisJZmx1c2hfd29yayh3KTsKK30KKwogc3RhdGljIHNpemVf
dCB3Znhfc3BpX2FsaWduX3NpemUodm9pZCAqcHJpdiwgc2l6ZV90IHNpemUpCiB7CiAJLy8gTW9z
dCBvZiBTUEkgY29udHJvbGxlcnMgYXZvaWQgRE1BIGlmIGJ1ZmZlciBzaXplIGlzIG5vdCAzMmJp
dCBhbGlnbmVkCkBAIC0yMDcsMjIgKzIxMiwyMyBAQCBzdGF0aWMgaW50IHdmeF9zcGlfcHJvYmUo
c3RydWN0IHNwaV9kZXZpY2UgKmZ1bmMpCiAJCXVkZWxheSgyMDAwKTsKIAl9CiAKLQlyZXQgPSBk
ZXZtX3JlcXVlc3RfaXJxKCZmdW5jLT5kZXYsIGZ1bmMtPmlycSwgd2Z4X3NwaV9pcnFfaGFuZGxl
ciwKLQkJCSAgICAgICBJUlFGX1RSSUdHRVJfUklTSU5HLCAid2Z4IiwgYnVzKTsKLQlpZiAocmV0
KQotCQlyZXR1cm4gcmV0OwotCiAJSU5JVF9XT1JLKCZidXMtPnJlcXVlc3RfcngsIHdmeF9zcGlf
cmVxdWVzdF9yeCk7CiAJYnVzLT5jb3JlID0gd2Z4X2luaXRfY29tbW9uKCZmdW5jLT5kZXYsICZ3
Znhfc3BpX3BkYXRhLAogCQkJCSAgICAmd2Z4X3NwaV9od2J1c19vcHMsIGJ1cyk7CiAJaWYgKCFi
dXMtPmNvcmUpCiAJCXJldHVybiAtRUlPOwogCi0JcmV0ID0gd2Z4X3Byb2JlKGJ1cy0+Y29yZSk7
CisJcmV0ID0gZGV2bV9hZGRfYWN0aW9uX29yX3Jlc2V0KCZmdW5jLT5kZXYsIHdmeF9mbHVzaF9p
cnFfd29yaywKKwkJCQkgICAgICAgJmJ1cy0+cmVxdWVzdF9yeCk7CiAJaWYgKHJldCkKLQkJd2Z4
X2ZyZWVfY29tbW9uKGJ1cy0+Y29yZSk7CisJCXJldHVybiByZXQ7CiAKLQlyZXR1cm4gcmV0Owor
CXJldCA9IGRldm1fcmVxdWVzdF9pcnEoJmZ1bmMtPmRldiwgZnVuYy0+aXJxLCB3Znhfc3BpX2ly
cV9oYW5kbGVyLAorCQkJICAgICAgIElSUUZfVFJJR0dFUl9SSVNJTkcsICJ3ZngiLCBidXMpOwor
CWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlyZXR1cm4gd2Z4X3Byb2JlKGJ1cy0+Y29yZSk7
CiB9CiAKIHN0YXRpYyBpbnQgd2Z4X3NwaV9yZW1vdmUoc3RydWN0IHNwaV9kZXZpY2UgKmZ1bmMp
CkBAIC0yMzAsMTEgKzIzNiw2IEBAIHN0YXRpYyBpbnQgd2Z4X3NwaV9yZW1vdmUoc3RydWN0IHNw
aV9kZXZpY2UgKmZ1bmMpCiAJc3RydWN0IHdmeF9zcGlfcHJpdiAqYnVzID0gc3BpX2dldF9kcnZk
YXRhKGZ1bmMpOwogCiAJd2Z4X3JlbGVhc2UoYnVzLT5jb3JlKTsKLQl3ZnhfZnJlZV9jb21tb24o
YnVzLT5jb3JlKTsKLQkvLyBBIGZldyBJUlEgd2lsbCBiZSBzZW50IGR1cmluZyBkZXZpY2UgcmVs
ZWFzZS4gSG9wZWZ1bGx5LCBubyBJUlEKLQkvLyBzaG91bGQgaGFwcGVuIGFmdGVyIHdkZXYvd3Zp
ZiBhcmUgcmVsZWFzZWQuCi0JZGV2bV9mcmVlX2lycSgmZnVuYy0+ZGV2LCBmdW5jLT5pcnEsIGJ1
cyk7Ci0JZmx1c2hfd29yaygmYnVzLT5yZXF1ZXN0X3J4KTsKIAlyZXR1cm4gMDsKIH0KIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9zdGFnaW5nL3dmeC9tYWluLmMgYi9kcml2ZXJzL3N0YWdpbmcvd2Z4
L21haW4uYwppbmRleCA4NGFkYWQ2NGZjMzAuLjc2YjJmZjdmYzdmZSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9zdGFnaW5nL3dmeC9tYWluLmMKKysrIGIvZHJpdmVycy9zdGFnaW5nL3dmeC9tYWluLmMK
QEAgLTI2Miw2ICsyNjIsMTYgQEAgc3RhdGljIGludCB3Znhfc2VuZF9wZGF0YV9wZHMoc3RydWN0
IHdmeF9kZXYgKndkZXYpCiAJcmV0dXJuIHJldDsKIH0KIAorc3RhdGljIHZvaWQgd2Z4X2ZyZWVf
Y29tbW9uKHZvaWQgKmRhdGEpCit7CisJc3RydWN0IHdmeF9kZXYgKndkZXYgPSBkYXRhOworCisJ
bXV0ZXhfZGVzdHJveSgmd2Rldi0+cnhfc3RhdHNfbG9jayk7CisJbXV0ZXhfZGVzdHJveSgmd2Rl
di0+Y29uZl9tdXRleCk7CisJd2Z4X3R4X3F1ZXVlc19kZWluaXQod2Rldik7CisJaWVlZTgwMjEx
X2ZyZWVfaHcod2Rldi0+aHcpOworfQorCiBzdHJ1Y3Qgd2Z4X2RldiAqd2Z4X2luaXRfY29tbW9u
KHN0cnVjdCBkZXZpY2UgKmRldiwKIAkJCQljb25zdCBzdHJ1Y3Qgd2Z4X3BsYXRmb3JtX2RhdGEg
KnBkYXRhLAogCQkJCWNvbnN0IHN0cnVjdCBod2J1c19vcHMgKmh3YnVzX29wcywKQEAgLTMzMiwx
NyArMzQyLDEyIEBAIHN0cnVjdCB3ZnhfZGV2ICp3ZnhfaW5pdF9jb21tb24oc3RydWN0IGRldmlj
ZSAqZGV2LAogCXdmeF9pbml0X2hpZl9jbWQoJndkZXYtPmhpZl9jbWQpOwogCXdmeF90eF9xdWV1
ZXNfaW5pdCh3ZGV2KTsKIAorCWlmIChkZXZtX2FkZF9hY3Rpb25fb3JfcmVzZXQoZGV2LCB3Znhf
ZnJlZV9jb21tb24sIHdkZXYpKQorCQlyZXR1cm4gTlVMTDsKKwogCXJldHVybiB3ZGV2OwogfQog
Ci12b2lkIHdmeF9mcmVlX2NvbW1vbihzdHJ1Y3Qgd2Z4X2RldiAqd2RldikKLXsKLQltdXRleF9k
ZXN0cm95KCZ3ZGV2LT5yeF9zdGF0c19sb2NrKTsKLQltdXRleF9kZXN0cm95KCZ3ZGV2LT5jb25m
X211dGV4KTsKLQl3ZnhfdHhfcXVldWVzX2RlaW5pdCh3ZGV2KTsKLQlpZWVlODAyMTFfZnJlZV9o
dyh3ZGV2LT5odyk7Ci19Ci0KIGludCB3ZnhfcHJvYmUoc3RydWN0IHdmeF9kZXYgKndkZXYpCiB7
CiAJaW50IGk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL3N0YWdpbmcvd2Z4L21haW4uaCBiL2RyaXZl
cnMvc3RhZ2luZy93ZngvbWFpbi5oCmluZGV4IDg3NWY4YzIyNzgwMy4uOWM5NDEwMDcyZGVmIDEw
MDY0NAotLS0gYS9kcml2ZXJzL3N0YWdpbmcvd2Z4L21haW4uaAorKysgYi9kcml2ZXJzL3N0YWdp
bmcvd2Z4L21haW4uaApAQCAtMzQsNyArMzQsNiBAQCBzdHJ1Y3Qgd2Z4X2RldiAqd2Z4X2luaXRf
Y29tbW9uKHN0cnVjdCBkZXZpY2UgKmRldiwKIAkJCQljb25zdCBzdHJ1Y3Qgd2Z4X3BsYXRmb3Jt
X2RhdGEgKnBkYXRhLAogCQkJCWNvbnN0IHN0cnVjdCBod2J1c19vcHMgKmh3YnVzX29wcywKIAkJ
CQl2b2lkICpod2J1c19wcml2KTsKLXZvaWQgd2Z4X2ZyZWVfY29tbW9uKHN0cnVjdCB3ZnhfZGV2
ICp3ZGV2KTsKIAogaW50IHdmeF9wcm9iZShzdHJ1Y3Qgd2Z4X2RldiAqd2Rldik7CiB2b2lkIHdm
eF9yZWxlYXNlKHN0cnVjdCB3ZnhfZGV2ICp3ZGV2KTsKLS0gCjIuMjAuMQoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KZGV2ZWwgbWFpbGluZyBsaXN0CmRl
dmVsQGxpbnV4ZHJpdmVycHJvamVjdC5vcmcKaHR0cDovL2RyaXZlcmRldi5saW51eGRyaXZlcnBy
b2plY3Qub3JnL21haWxtYW4vbGlzdGluZm8vZHJpdmVyZGV2LWRldmVsCg==
